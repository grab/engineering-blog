<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>The Data and Science Behind GrabShare Part I: Verifying Potential and Developing the Algorithm</title>
    <meta name="description" content="Launching GrabShare was no easy feat. After reviewing the academic literature, we decided to take a different approach and build a new matching algorithm from the ground up.">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- Open Graph -->
    <meta property="og:url" content="https://engineering.grab.com/the-data-and-science-behind-grabshare-part-i">
    <meta property="og:title" content="The Data and Science Behind GrabShare Part I: Verifying Potential and Developing the Algorithm">
    <meta property="og:description" content="Launching GrabShare was no easy feat. After reviewing the academic literature, we decided to take a different approach and build a new matching algorithm from the ground up.">
    <meta property="og:site_name" content="Grab Tech">
    <meta property="og:type" content="article">
    <meta property="og:image" content="https://engineering.grab.com/img/the-data-and-science-behind-grabshare-part-i/cover.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">

    <!-- Favicons -->
    <link rel="icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">

    <!-- CSS -->
    <link href="//fonts.googleapis.com/css?family=Droid+Serif:400,400i,700,700i" rel="stylesheet">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap-theme.min.css">
    <script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="https://engineering.grab.com/the-data-and-science-behind-grabshare-part-i">

    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title="RSS for Official Grab Tech Blog" href="/feed.xml">
</head>

  <body>
    <header class="site-header">
  <div class="wrapper-navbar">
    <div class="site-title-wrapper">
      <div class="row site-title-wrapper-inner">
        <div class="col-xs-1 visible-xs hamburger-nav" id="mobile-menu-btn">
          <div class="menu-btn"></div>
        </div>
        <div class="col-sm-3 col-xs-3">
          <div>
            <a class="site-title" href="/"></a>
            <span class="site-subtitle hidden-sm hidden-xs">&nbsp;Tech Blog</span>
          </div>
        </div>
        <div class="col-sm-9 col-xs-8 text-right">
          <ul class="nav-category hidden-xs">
            
              
              <li>
                <a href="/categories/engineering/">Engineering</a>
              </li>
            
              
              <li>
                <a href="/categories/data-science/">Data Science</a>
              </li>
            
              
              <li>
                <a href="/categories/design/">Design</a>
              </li>
            
              
              <li>
                <a href="/categories/product/">Product</a>
              </li>
            
              
              <li>
                <a href="/categories/security/">Security</a>
              </li>
            
          </ul>
          <div class="site-search text-right">
            <form action="/search.html" role="search" class="search-form">
  <input type="submit" value="" class="search-submit"> 
  <input type="search" name="q" class="search-text" placeholder="Search...">
  <button class="search-button"><i class="fa fa-chevron-right"></i></button>
</form>
    

          </div>
        </div>
      </div>
      <!--  Only visible on mobile view -->
      <div class="mobile-menu-container">
        <ul class="mobile-menu">
          
            
            <li>
              <a href="/categories/engineering/">Engineering</a>
            </li>
          
            
            <li>
              <a href="/categories/data-science/">Data Science</a>
            </li>
          
            
            <li>
              <a href="/categories/design/">Design</a>
            </li>
          
            
            <li>
              <a href="/categories/product/">Product</a>
            </li>
          
            
            <li>
              <a href="/categories/security/">Security</a>
            </li>
          
        </ul>
      </div>
    </div>
  </div>
</header>
<script src="/js/main.js"></script>

    <div class="page-content">
      
<div class="wrapper">
  <div class="post">
    <header class="post-header">
      <img src="/img/the-data-and-science-behind-grabshare-part-i/cover.png" class="post-cover-photo" alt="The Data and Science Behind GrabShare Part I: Verifying Potential and Developing the Algorithm cover photo">
      <a class="post-categories" href="/categories/Data Science">Data Science</a>
      <h1 class="post-title">The Data and Science Behind GrabShare Part I: Verifying Potential and Developing the Algorithm</h1>
      
      <div class="post-meta">
        <div class="row">
          <div class="col-xs-12">
            
              
              
                <img class="post-author-thumbnail-large img-circle" src="/img/authors/tang-muchen.jpg">
              
            
            <div class="post-meta-text-container">
              <span class="post-author-large">
                
                  
                  
                    
                    <a href="/authors#tang-muchen">Tang Muchen</a>
                  
                
              </span>
              <span class="post-date-large">20 Oct 2017 | 10 min read</span>
            </div>
          </div>
        </div>
      </div>
      
    </header>
    <article class="post-content">
      <p>Launching GrabShare was no easy feat. After reviewing the academic literature, we decided to take a different approach and build a new matching algorithm from the ground up. Not only did this really test our knowledge of fundamental data science principles, but it challenged our team to work together to develop something we had never seen before!</p>

<p>Because we had so much fun learning and developing GrabShare, we wanted to write a two part blog post to share with you what we did and how we did it. After reading this, we hope that you might be more prepared to build your very own optimised [practical, effective and efficient] matching algorithm.</p>

<p>We hope you enjoy the ride!</p>

<h3 id="i-a-little-history">I. A Little History</h3>

<p>By matching different travellers with similar itineraries in both time and their geographic locations, ride-sharing can improve driver utilisation and reduce traffic congestion. This concept of pooling (or called ride-sharing), has been a popular concept for decades due to its significant societal and environmental benefits. Tremendous interest in the real-time or dynamic pooling system has grown in recent years, either from a pooling matching algorithm (e.g., <a href="#2">[2]</a>, <a href="#3">[3]</a>) or a system efficiency perspective <a href="#4">[4]</a>. We refer interested readers to <a href="#5">[5]</a>–<a href="#8">[8]</a> as a comprehensive overview on how optimisation and operations research models in academic literature can support the development of real-time pooling systems and innovative thinking on possible future ride-sharing modes.</p>

<p>Leveraging on an internet-based platform that integrates passengers’ smart-phone data in real-time, we are able to provide a ride-sharing service that allows passengers to spend less while enabling drivers to earn more. Companies such as Didi, Grab, Lyft and Uber have managed to transform the concept of a real-time pooling service from imagination into reality. Even though the problem of how to match drivers and riders in real-time has been extensively studied by various optimisation technologies in literature (e.g., Avego’s ride-sharing system <a href="#5">[5]</a> and Lyft match making <a href="#9">[9]</a>), there has been a renewed interest in the problem and how we can solve it in practice.</p>

<p>Let us turn the clock back to late 2015. This was when Grab’s Data Science (Optimisation) team was born. The team decided to eschew the literature and current state of the art, and challenged ourselves to design the GrabShare matching algorithm from the ground up, from basic principles. Indeed, its main task was to make ride matching decisions (which is combinatorial) in order to maximise the overall system efficiency, while satisfying specific constraints to guarantee good user experience (such as detour, overlap, trip angle, and efficiency). A general optimisation problem comprises of three main parts: Objective function, Constraints, and Decision Space. The constrained optimisation problem takes the usual form:</p>

<p><img src="/img/the-data-and-science-behind-grabshare-part-i/optimization-problem.png" alt="optimization problem" /></p>

<p>Here X denotes a set of decision variables that correspond to real-world decisions we can adjust or control. The objective function f(X) is either a cost function that we want to minimise, or a value function that we want to maximise. The constraints are mathematical expressions of physical restrictions to decision variables on the possible solutions, which could have either inequality form: g(X) or equality form: h(X) or both.</p>

<p>In this article, we discuss how the GrabShare matching algorithm is tackled as an optimisation problem and how its various formulations can have a different impact to Grab, passengers, and drivers. Differing from previous studies in literature, which mainly focus on improving overall system efficiency using conventional operations research methods, we approached the problem from a more data-driven perspective. Our key focus was on extracting critical insights from data to improve the GrabShare user experience, from the point of design and development of the matching algorithm and throughout subsequent continual efforts of product improvement.</p>

<h3 id="ii-from-grabcar-to-grabshare">II. From GrabCar to GrabShare</h3>

<p>From 2012 onwards, Grab has had a mature product named “GrabCar” that serves millions of individual traveling requests by an integrated dispatching system. The drivers’ locations and other states are maintained in the system such that we can simultaneously find drivers and make assignments for thousands of traveling requests. With a GPS-enabled mobile device, the users (known as passengers) can use Grab’s passenger app to place transportation requests from specified origin to destination. In this article we use the term “booking” to denote a confirmed transportation request placed by a passenger, which contains explicit pickup and drop-off information. At the same time, drivers who have registered with their own or rented vehicles can login to Grab’s system through a driver app to indicate their readiness to take nearby passengers. The GrabCar service is similar to a traditional taxi service in that a completed GrabCar ride consists of three steps:</p>

<ol>
  <li>
    <p>A passenger makes a booking;</p>
  </li>
  <li>
    <p>A GrabCar driver is assigned to the booking;</p>
  </li>
  <li>
    <p>The assigned driver picks up the passenger and ferries him/her to the destination and the ride is completed.</p>
  </li>
</ol>

<p>It is common for people to arrange for manual ride-sharing with our friends traveling in the same direction to save on travel cost as well as to socialize and connect during the trip. By making use of real-time integrated ride information in the Grab system, we aimed to automatically match strangers traveling in similar directions and assign the same vehicle to both their journeys, allowing them to effectively car-pool. Before promoting the concept of GrabShare however, we had to verify its potential from the existing GrabCar bookings. For example, during morning peak hours we mappped every single booking into a four-dimensional vector with the latitudes and longitudes of pickup and drop-off locations. In addition, the latitudes and longitudes were transformed into a Universal Transverse Mercator (UTM) format to map the earth’s surface to an 2-dimensional Cartesian Coordinate System for distance calculation. After applying a DBSCAN cluster method <a href="#10">[10]</a> with parameter “eps=300”, which means that only bookings with distance of less than 300 meters can be considered as neighbourhoods, we observed eight clear clusters of booking with close pickup and drop-off locations in Figure 1.</p>

<div class="post-image-section">
  <img alt="Figure 1. Morning Booking clusters with similar itineraries" src="/img/the-data-and-science-behind-grabshare-part-i/booking-clustering.png" width="80%" />
  <small class="post-image-caption">Figure 1. Morning booking clusters with similar itineraries</small>
</div>

<p>The booking requests within each cluster can be allocated and fulfilled with less vehicles, through pooling. Even though not all of them may be willing to share vehicles with others, at least those with unallocated bookings (around 8%) may benefit. After repeating this analysis for different time periods, we observed that a certain percentage of the bookings could be covered with good performing clusters as seen in Table I. We observed that the coverage rate for different time periods fluctuates from 35% to 45% for most part of the day (coverage during mid-night and early morning hours is much smaller as the amount of bookings is much smaller). Because bookings in the same cluster are “near perfect matches” with very close pickup and drop-off location, the potential for GrabShare was found to be quite promising because we could expect even more opportunities for matching in the middle of a trip.</p>

<table class="table table-bordered">
  <thead>
    <tr>
      <th style="text-align: center">Hours</th>
      <th style="text-align: center">8-10</th>
      <th style="text-align: center">10-13</th>
      <th style="text-align: center">14-16</th>
      <th style="text-align: center">16-18</th>
      <th style="text-align: center">18-22</th>
      <th style="text-align: center">Others</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Coverage</td>
      <td style="text-align: center">46%</td>
      <td style="text-align: center">39%</td>
      <td style="text-align: center">35%</td>
      <td style="text-align: center">38%</td>
      <td style="text-align: center">43%</td>
      <td style="text-align: center">22%</td>
    </tr>
  </tbody>
</table>

<div class="post-image-section">
  <small class="post-image-caption">Table 1. Cluster coverage of different time periods</small>
</div>

<p>The assignment flow of typical GC bookings is stated in Algorithm I. For every newly arrived booking, we search for nearby drivers and check for their availability condition. If no driver is available, we recycle it to the next round of assignment. Otherwise we select the most suitable driver for them. Leveraging the current system structure, we planned to extend the GrabCar service to GrabShare by maintaining more detailed bookings and driver state information along with an additional check on seat reservation.</p>

<div class="post-image-section">
  <img alt="Algorithm I. GrabCar booking assignment flow" src="/img/the-data-and-science-behind-grabshare-part-i/grabcar-booking-assignment-flow.png" width="80%" />
  <small class="post-image-caption">Algorithm I. GrabCar booking assignment flow</small>
</div>

<p>Specifically, Algorithm II gives the assignment flow of Grab- Share bookings. We can see that its overall structure is the same with GrabCar except for two differences. Firstly, the candidate driver set is different. For every new GrabShare booking, we search for in-transit GrabShare drivers who are currently serving at least one GrabShare booking. Therefore, we need to check seat availability condition to ensure that the vehicle has enough remaining seats to serve the new GrabShare booking. Mathematically, the following seat reservation constraint needs to be satisfied for a successful assignment between booking bki and driver drj:</p>

<p><img src="/img/the-data-and-science-behind-grabshare-part-i/constraint.png" alt="constraint" /></p>

<p>where s(drj) denotes the total capacity of the vehicle drj, op(drj) is one of the maintained variable that denotes the current occupied capacity of the vehicle drj and rp (bki) is the required capacity for booking bki. To make it consistent, we also need to update the vehicle occupied capacity variable op (drj) by adding the booking required capacity rp (bki) after every successful assignment or removing it if cancellation occurs.</p>

<div class="post-image-section">
  <img alt="Algorithm II. GrabShare booking assignment flow" src="/img/the-data-and-science-behind-grabshare-part-i/grabshare-booking-assignment-flow.png" width="80%" />
  <small class="post-image-caption">Algorithm II. GrabShare booking assignment flow</small>
</div>

<div class="post-image-section">
  <img alt="Figure 2. GrabShare match case in Singapore" src="/img/the-data-and-science-behind-grabshare-part-i/grabshare-match-case-singapore.png" width="80%" />
  <small class="post-image-caption">Figure 2. GrabShare match case in Singapore</small>
</div>

<p>Secondly, GrabShare’s user experience is different from GrabCar due to the sharing concept. Here we defined some measures to evaluate the GrabShare matching, taking into consideration the trip angle, eta (short for Expected Time of Arrival), detour and efficiency. These measures are used to exclude unacceptable matches and to quantify how good the match is. For example, given a matching route scenario of two bookings (n = 1) as shown in Figure 2. At the first step the driver receives the first GrabShare booking from point A to D (25 minutes direct trip time). After the driver picks up the first passenger and reaches location B on his way to D, he/she is assigned to pickup the second booking from C to E (21 minutes direct trip time). A GrabShare match happens and the final route sequence is generated as A→B→C→D→E. With pooling, it takes 29.5 minutes for the first passenger and 27 minutes for the second passenger to reach their destinations, respectively. Overall it is a good match as the passengers are only delayed a little bit by pooling with a promising driver utilisation rate. In this case the driver only needs to drive 23.72km in total to serve two bookings, instead of a total of 39.13km if they were served separately. Not only does this allow passengers to be allocated rides, but drivers save considerable time and money through this efficiency, while increasing their earning power simultaneously.</p>

<p>This is ultimately deemed a good match, but the details on how we quantify this and its corresponding optimisation model are explained in <strong>Part II</strong>.</p>

<h3 id="references">References</h3>

<p><a name="1" href="#1">[1]</a>  Grab, “Grab extends GrabShare regionally with Malaysia’s first on-demand carpooling service,” 2017. [Online]. Available: <a href="https://www.grab.com/my/press/business/grabsharemalaysia/">https://www.grab.com/my/press/business/grabsharemalaysia/</a></p>

<p><a name="2" href="#2">[2]</a>  J. Alonso-Mora, S. Samaranayake, A. Wallar, E. Frazzoli, and D. Rus, “On-demand high-capacity ride-sharing via dynamic trip-vehicle assignment,” <em>Proceedings of the National Academy of Sciences</em>, vol. 114, no. 3, pp. 462–467, Mar 2017.</p>

<p><a name="3" href="#3">[3]</a>  A. Conner-Simons, “Study: carpooling apps could reduce taxi traffic 75 percent,” 2016. [Online]. Available: <a href="http://www.csail.mit.edu/ridesharing_reduces_traffic_300_percent">http://www.csail.mit.edu/ridesharing_reduces_traffic_300_percent</a></p>

<p><a name="4" href="#4">[4]</a>  D. Dimitrijevic, N. Nedic, and V. Dimitrieski, “Real-time carpooling and ride-sharing: Position paper on design concepts, distribution and cloud computing strategies,” in <em>Computer Science and Information Systems (FedCSIS), 2013 Federated Conference on</em>. IEEE, 2013, pp. 781–786.</p>

<p><a name="5" href="#5">[5]</a>  N. Agatz, A. Erera, M. Savelsbergh, and X. Wang, “Optimization for dynamic ride-sharing: A review,” <em>European Journal of Operational Research</em>, vol. 223, no. 2, pp. 295–303, 2012.</p>

<p><a name="6" href="#6">[6]</a>  A. Amey, J. Attanucci, and R. Mishalani, “Real-time ridesharing: opportunities and challenges in using mobile phone technology to improve rideshare services,” <em>Transportation Research Record: Journal of the Transportation Research Board</em>, no. 2217, pp. 103–110, 2011.</p>

<p><a name="7" href="#7">[7]</a>  N. D. Chan and S. A. Shaheen, “Ridesharing in north america: Past, present, and future,” <em>Transport Reviews</em>, vol. 32, no. 1, pp. 93–112, 2012.</p>

<p><a name="8" href="#8">[8]</a>  M. Furuhata, M. Dessouky, F. Ordonez, M.-E. Brunet, X. Wang, and S. Koenig, “Ridesharing: The state-of-the-art and future directions,” <em>Transportation Research Part B: Methodological</em>, vol. 57, pp. 28–46, 2013.</p>

<p><a name="9" href="#9">[9]</a>  Lyft, “Matchmaking in lyft line—part 1,” 2016. [Online]. Available: <a href="https://eng.lyft.com/matchmaking-in-lyft-line-9c2635fe62c4">https://eng.lyft.com/matchmaking-in-lyft-line-9c2635fe62c4</a></p>

<p><a name="10" href="#10">[10]</a>  M. Ester, H.-P. Kriegel, J. Sander, X. Xu <em>et al.</em>, “A density-based algorithm for discovering clusters in large spatial databases with noise.” in <em>Kdd</em>, vol. 96, no. 34, 1996, pp. 226–231.</p>

    </article>
    <div>
      
        <div class="post-tags">
  
  
    <a href="/tags#data-science" class="label tags-label">Data Science</a>
  
    <a href="/tags#grabshare" class="label tags-label">GrabShare</a>
  
</div>

      
      <br>
    </div>
    <div class="sharing-links text-right">
  Share on &nbsp;
  <a href="https://twitter.com/intent/tweet?text=The Data and Science Behind GrabShare Part I: Verifying Potential and Developing the Algorithm&url=https://engineering.grab.com/the-data-and-science-behind-grabshare-part-i&via=grabengineering&related=grabengineering" class="btn btn-sm btn-share btn-share-twitter" rel="nofollow" target="_new" title="Share on Twitter" onclick="onShareButtonClick(this); return false;"><i class="fa fa-lg fa-twitter"></i>&nbsp; Twitter</a>
  <a href="https://facebook.com/sharer.php?u=https://engineering.grab.com/the-data-and-science-behind-grabshare-part-i" class="btn btn-sm btn-share btn-share-facebook" rel="nofollow" target="_new" title="Share on Facebook" onclick="onShareButtonClick(this); return false;"><i class="fa fa-lg fa-facebook"></i>&nbsp; Facebook</a>
  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://engineering.grab.com/the-data-and-science-behind-grabshare-part-i&title=The Data and Science Behind GrabShare Part I: Verifying Potential and Developing the Algorithm
&summary=Launching GrabShare was no easy feat. After reviewing the academic literature, we decided to take a different approach and build a new matching algorithm from the ground up.&source=Grab Tech" class="btn btn-sm btn-share btn-share-linkedin" rel="nofollow" target="_new" title="Share on LinkedIn" onclick="onShareButtonClick(this); return false;"><i class="fa fa-lg fa-linkedin"></i>&nbsp; LinkedIn</a>
</div>
<script>
  function onShareButtonClick(button) {
    var width = 600;
    var height = 600;
    var left = (window.screen.width / 2) - (width / 2);
    var top = (window.screen.height / 2) - (height / 2);
    window.open(button.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=' + height + ',width=' + width + ',top=' + top + ',left=' + left);
    return false;
  }
</script>

    <hr class="section-divider">
    
    <br/>
    
      <div id="disqus_thread"></div>
<script>
  var disqus_config = function () {
    this.page.url = 'https://engineering.grab.com/the-data-and-science-behind-grabshare-part-i';
    this.page.identifier = '/the-data-and-science-behind-grabshare-part-i';
  };
  (function() {
    var d = document, s = d.createElement('script');
    s.src = '//grabengineering.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

    
  </div>
</div>

    </div>
    <footer class="site-footer">
  <div class="wrapper">
    <div class="row">
      <div class="col-sm-6">
        <h2 class="footer-heading">Grab Tech</h2>
        <ul class="social-media-list">
  
    <li>
      <a href="https://github.com/grab" target="_blank" rel="nofollow noreferrer">
        <i class="fa fa-github fa-lg"></i>
      </a>
    </li>
  
  
    <li>
      <a href="https://facebook.com/grabengineering" target="_blank" rel="nofollow noreferrer">
        <i class="fa fa-facebook-square fa-lg"></i>
      </a>
    </li>
  
  
    <li>
      <a href="https://twitter.com/grabengineering" target="_blank" rel="nofollow noreferrer">
        <i class="fa fa-twitter fa-lg"></i>
      </a>
    </li>
  
  
    <li>
      <a href="https://www.linkedin.com/company/grabapp" target="_blank" rel="nofollow noreferrer">
        <i class="fa fa-linkedin fa-lg"></i>
      </a>
    </li>
  
  <li>
    <a href="https://engineering.grab.com/feed.xml" target="_blank">
      <i class="fa fa-rss fa-lg"></i>
    </a>
  </li>
</ul>

        <script src="//platform.linkedin.com/in.js" type="text/javascript"> lang: en_US</script>
        <script type="IN/FollowCompany" data-id="5382086" data-counter="right"></script>
      </div>
      <div class="col-sm-6 hiring-section">
        <h2 class="footer-heading">Join Us</h2>
        <p class="text">
          Want to join us in our mission to revolutionize transportation?
        </p>
        <a class="btn" href="https://grab.careers" target="_blank">View open positions</a>

      </div>
    </div>
  </div>
</footer>

    
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-73060858-2', 'auto');
    ga('send', 'pageview');
  </script>


  </body>
</html>
