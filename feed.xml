<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Grab Tech</title>
    <description>Grab's Engineering team solves critical transportation challenges and makes transport freedom a reality for 620 million people in Southeast Asia.
</description>
    <link>https://engineering.grab.com/</link>
    <atom:link href="https://engineering.grab.com/feed.xml" rel="self" type="application/rss+xml" />
    <pubDate>Wed, 15 Feb 2023 06:42:46 +0000</pubDate>
    <lastBuildDate>Wed, 15 Feb 2023 06:42:46 +0000</lastBuildDate>
    <generator>Jekyll v4.2.0</generator>
    
      <item>
        <title>Graph service platform</title>
        <description>&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;

&lt;p&gt;In earlier articles of this series, we covered the &lt;a href=&quot;/graph-networks&quot;&gt;importance of graph networks&lt;/a&gt;, &lt;a href=&quot;/graph-concepts&quot;&gt;graph concepts&lt;/a&gt;, &lt;a href=&quot;/graph-visualisation&quot;&gt;how graph visualisation makes fraud investigations easier and more effective&lt;/a&gt;, and &lt;a href=&quot;/graph-for-fraud-detection&quot;&gt;how graphs for fraud detection work&lt;/a&gt;. In this article, we elaborate on the need for a graph service platform and how it works.&lt;/p&gt;

&lt;p&gt;In the present age, data linkages can generate significant business value. Whether we want to learn about the relationships between users in online social networks, between users and products in e-commerce, or understand credit relationships in financial networks, the capability to understand and analyse large amounts of highly interrelated data is becoming more important to businesses.&lt;/p&gt;

&lt;p&gt;As the amount of consumer data grows, the GrabDefence team must continuously enhance fraud detection on mobile devices to proactively identify the presence of fraudulent or malicious users. Even simple financial transactions between users must be monitored for transaction loops and money laundering. To preemptively detect such scenarios, we need a graph service platform to help discover data linkages. &lt;/p&gt;

&lt;h2 id=&quot;background&quot;&gt;Background&lt;/h2&gt;

&lt;p&gt;As mentioned in an &lt;a href=&quot;/graph-concepts&quot;&gt;earlier article&lt;/a&gt;, a graph is a model representation of the association of entities and holds knowledge in a structured way by marginalising entities and relationships. In other words, graphs hold a natural interpretability of linked data and graph technology plays an important role. Since the early days, large tech companies started to create their own graph technology infrastructure, which is used for things like social relationship mining, web search, and sorting and recommendation systems with great commercial success.&lt;/p&gt;

&lt;p&gt;As graph technology was developed, the amount of data gathered from graphs started to grow as well, leading to a need for graph databases. Graph databases&lt;sup id=&quot;fnref:1&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:1&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt; are used to store, manipulate, and access graph data on the basis of graph models. It is similar to the relational database with the feature of Online Transactional Processing (OLTP), which supports transactions, persistence, and other features.&lt;/p&gt;

&lt;p&gt;A key concept of graphs is the edge or relationship between entities. The graph relates the data items in the store to a collection of nodes and edges, the edges representing the relationships between the nodes. These relationships allow data in the store to be linked directly and retrieved with one operation.&lt;/p&gt;

&lt;p&gt;With graph databases, relationships between data can be queried fast as they are perpetually stored in the database. Additionally, relationships can be intuitively visualised using graph databases, making them useful for heavily interconnected data. To have real-time graph search capabilities, we must leverage the graph service platform and graph databases.&lt;/p&gt;

&lt;h2 id=&quot;architecture-details&quot;&gt;Architecture details&lt;/h2&gt;

&lt;p&gt;Graph services with graph databases are Platforms as a Service (PaaS) that encapsulate the underlying implementation of graph technology and support easier discovery of data association relationships with graph technologies.&lt;/p&gt;

&lt;p&gt;They also provide universal graph operation APIs and service management for users. This means that users do not need to build graph runtime environments independently and can explore the value of data with graph service directly.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/graph-service-platform/image5.png&quot; alt=&quot;&quot; style=&quot;width:70%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Fig. 1 Graph service platform system architecture&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;As shown in Fig. 1, the system can be divided into four layers:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;Storage backend&lt;/strong&gt; - Different forms of data (for example, CSV files) are stored in Amazon S3, graph data stores in Neptune and meta configuration stores in DynamoDB.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Driver&lt;/strong&gt; - Contains drivers such as Gremlin, Neptune, S3, and DynamoDB.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Service&lt;/strong&gt; - Manages clusters, instances, databases etc, provides management API, includes schema and data load management, graph operation logic, and other graph algorithms.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;RESTful APIs&lt;/strong&gt; - Currently supports the standard and uniform formats provided by the system, the Management API, Search API for OLTP, and Analysis API for online analytical processing (OLAP).&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;how-it-works&quot;&gt;How it works&lt;/h2&gt;

&lt;h3 id=&quot;graph-flow&quot;&gt;Graph flow&lt;/h3&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/graph-service-platform/image1.png&quot; alt=&quot;&quot; style=&quot;width:70%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Fig. 2 Graph flow&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;CSV files stored in Amazon S3 are processed by extract, transform, and load (ETL) tools to generate graph data. This data is then managed by an Amazon Neptune DB cluster, which can only be accessed by users through graph service. Graph service converts user requests into asynchronous interactions with Neptune Cluster, which returns the results to users.&lt;/p&gt;

&lt;p&gt;When users launch data load tasks, graph service synchronises the entity and attribute information with the CSV file in S3, and the schema stored in DynamoDB. The data is only imported into Neptune if there are no inconsistencies.&lt;/p&gt;

&lt;p&gt;The most important component in the system is the graph service, which provides RESTful APIs for two scenarios: graph search for real-time streams and graph analysis for batch processing. At the same time, the graph service manages clusters, databases, instances, users, tasks, and meta configurations stored in DynamoDB, which implements features of service monitor and data loading offline or stream ingress online.&lt;/p&gt;

&lt;h3 id=&quot;use-casein-fraud-detection&quot;&gt;Use case in fraud detection&lt;/h3&gt;

&lt;p&gt;In Grab’s mobility business, we have come across situations where multiple accounts use shared physical devices to maximise their earning potential. With the graph capabilities provided by the graph service platform, we can clearly see the connections between multiple accounts and shared devices.&lt;/p&gt;

&lt;p&gt;Historical device and account data are stored in the graph service platform via offline data loading or online stream injection. If the device and account data exists in the graph service platform, we can find the adjacent account IDs or the shared device IDs by using the device ID or account ID respectively specified in the user request.&lt;/p&gt;

&lt;p&gt;In our experience, fraudsters tend to share physical resources to maximise their revenue. The following image shows a device that is shared by many users. With our Graph Visualisation platform based on graph service, you can see exactly what this pattern looks like.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/graph-service-platform/image3.png&quot; alt=&quot;&quot; style=&quot;width:70%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Fig 3. Example of a device being shared with many users&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;h3 id=&quot;data-injection&quot;&gt;Data injection&lt;/h3&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/graph-service-platform/image4.png&quot; alt=&quot;&quot; style=&quot;width:70%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Fig. 4 Data injection&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;Graph service also supports data injection features, including data load by request (task with a type of data load) and real-time stream write by Kafka.  &lt;/p&gt;

&lt;p&gt;When connected to GrabDefence’s infrastructure, Confluent with Kafka is used as the streaming engine.  The purpose of using Kafka as a streaming write engine is two-fold: to provide primary user authentication and to relieve the pressure on Neptune.&lt;/p&gt;

&lt;h2 id=&quot;impact&quot;&gt;Impact&lt;/h2&gt;

&lt;p&gt;Graph service supports data management of Labelled Property Graphs and provides the capability to add, delete, update, and get vertices, edges, and properties for some graph models. Graph traversal and searching relationships with RESTful APIs are also more convenient with graph service.&lt;/p&gt;

&lt;p&gt;Businesses usually do not need to focus on the underlying data storage, just designing graph schemas for model definition according to their needs. With the graph service platform, platforms or systems can be built for personalised search, intelligent Q&amp;amp;A, financial fraud, etc.&lt;/p&gt;

&lt;p&gt;For big organisations, extensive graph algorithms provide the power to mine various entity connectivity relationships in massive amounts of data. The growth and expansion of new businesses is driven by discovering the value of data.&lt;/p&gt;

&lt;h2 id=&quot;whats-next&quot;&gt;What’s next?&lt;/h2&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/graph-service-platform/image2.png&quot; alt=&quot;&quot; style=&quot;width:70%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Fig. 5 Graph-centric ecosystems&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;We are building an integrated graph ecosystem inside and outside Grab. The infrastructure and service, or APIs are key components in graph-centric ecosystems; they provide graph arithmetic and basic capabilities of graphs in relation to search, computing, analysis etc. Besides that, we will also consider incorporating applications such as risk prediction and fraud detection in order to serve our current business needs.&lt;/p&gt;

&lt;h2 id=&quot;speak-to-us&quot;&gt;Speak to us&lt;/h2&gt;
&lt;p&gt;GrabDefence is a proprietary fraud prevention platform built by Grab, Southeast Asia’s leading superapp. Since 2019, the GrabDefence team has shared its fraud management capabilities and platform with enterprises and startups to leverage Grab’s advanced AI/ML models, hyper local insights and patented device intelligence technologies.&lt;/p&gt;

&lt;p&gt;To learn more about GrabDefence or to speak to our fraud management experts, contact us at &lt;a href=&quot;mailto:gd.contact@grabtaxi.com&quot;&gt;gd.contact@grabtaxi.com&lt;/a&gt;.&lt;/p&gt;

&lt;h1 id=&quot;join-us&quot;&gt;Join us&lt;/h1&gt;

&lt;p&gt;Grab is the leading superapp platform in Southeast Asia, providing everyday services that matter to consumers. More than just a ride-hailing and food delivery app, Grab offers a wide range of on-demand services in the region, including mobility, food, package and grocery delivery services, mobile payments, and financial services across 428 cities in eight countries.&lt;/p&gt;

&lt;p&gt;Powered by technology and driven by heart, our mission is to drive Southeast Asia forward by creating economic empowerment for everyone. If this mission speaks to you, &lt;a href=&quot;https://grab.careers/&quot;&gt;join our team&lt;/a&gt; today!&lt;/p&gt;

&lt;h2 id=&quot;references&quot;&gt;References&lt;/h2&gt;

&lt;div class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;&lt;a href=&quot;https://neo4j.com/developer/graph-database/&quot;&gt;What is a Graph Database? - Developer Guides&lt;/a&gt; &lt;a href=&quot;#fnref:1&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</description>
        <pubDate>Thu, 05 Jan 2023 01:18:05 +0000</pubDate>
        <link>https://engineering.grab.com/graph-service-platform</link>
        <guid isPermaLink="true">https://engineering.grab.com/graph-service-platform</guid>
        
        <category>Engineering</category>
        
        <category>Graph networks</category>
        
        <category>Graphs</category>
        
        <category>Graph visualisation</category>
        
        <category>Security</category>
        
        <category>Analytics</category>
        
        <category>Fraud detection</category>
        
        
        <category>Engineering</category>
        
        <category>Security</category>
        
        <category>Data Science</category>
        
      </item>
    
      <item>
        <title>Zero trust with Kafka</title>
        <description>&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;
&lt;p&gt;Grab’s real-time data platform team, also known as Coban, has been operating large-scale Kafka clusters for all Grab verticals, with a strong focus on ensuring a best-in-class-performance and 99.99% availability.&lt;/p&gt;

&lt;p&gt;Security has always been one of Grab’s top priorities and as fraudsters continue to evolve, there is an increased need to continue strengthening the security of our data streaming platform. One of the ways of doing this is to move from a pure network-based access control to state-of-the-art security and zero trust by default, such as:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Authentication&lt;/strong&gt;: The identity of any remote systems - clients and servers - is established and ascertained first, prior to any further communications.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Authorisation&lt;/strong&gt;: Access to Kafka is granted based on the principle of least privilege; no access is given by default. Kafka clients are associated with the whitelisted Kafka topics and permissions - consume or produce - they strictly need. Also, granted access is auditable.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Confidentiality&lt;/strong&gt;: All in-transit traffic is encrypted.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;solution&quot;&gt;Solution&lt;/h2&gt;

&lt;p&gt;We decided to use mutual Transport Layer Security (mTLS) for authentication and encryption. mTLS enables clients to authenticate servers, and servers to reciprocally authenticate clients.&lt;/p&gt;

&lt;p&gt;Kafka supports other authentication mechanisms, like OAuth, or Salted Challenge Response Authentication Mechanism (SCRAM), but we chose mTLS because it is able to verify the peer’s identity offline. This verification ability means that systems do not need an active connection to an authentication server to ascertain the identity of a peer. This enables operating in disparate network environments, where all parties do not necessarily have access to such a central authority.&lt;/p&gt;

&lt;p&gt;We opted for &lt;a href=&quot;https://www.vaultproject.io/&quot;&gt;Hashicorp Vault&lt;/a&gt; and its &lt;a href=&quot;https://www.vaultproject.io/docs/secrets/pki&quot;&gt;PKI engine&lt;/a&gt; to dynamically generate clients and servers’ certificates. This enables us to enforce the usage of short-lived certificates for clients, which is a way to mitigate the potential impact of a client certificate being compromised or maliciously shared. We said zero trust, right?&lt;/p&gt;

&lt;p&gt;For authorisation, we chose Policy-Based Access Control (PBAC), a more scalable solution than Role-Based Access Control (RBAC), and the &lt;a href=&quot;https://www.openpolicyagent.org/&quot;&gt;Open Policy Agent&lt;/a&gt; (OPA) as our policy engine, for its wide community support.&lt;/p&gt;

&lt;p&gt;To integrate mTLS and the OPA with Kafka, we leveraged &lt;a href=&quot;https://strimzi.io/&quot;&gt;Strimzi&lt;/a&gt;, the Kafka on Kubernetes operator. In a previous &lt;a href=&quot;/exposing-kafka-cluster&quot;&gt;article&lt;/a&gt;, we have alluded to Strimzi and hinted at how it would help with scalability and cloud agnosticism. Built-in security is undoubtedly an additional driver of our adoption of Strimzi.&lt;/p&gt;

&lt;h3 id=&quot;server-authentication&quot;&gt;Server authentication&lt;/h3&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/zero-trust-with-kafka/image4.png&quot; alt=&quot;&quot; style=&quot;width:70%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Figure 1 - Server authentication process for internal cluster communications&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;We first set up a single Root Certificate Authority (CA) for each environment (staging, production, etc.). This Root CA, in blue on the diagram, is securely managed by the Hashicorp Vault cluster. Note that the color of the certificates, keys, signing arrows and signatures on the diagrams are consistent throughout this article.&lt;/p&gt;

&lt;p&gt;To secure the cluster’s internal communications, like the communications between the Kafka broker and Zookeeper pods, Strimzi sets up a Cluster CA, which is signed by the Root CA (step 1). The Cluster CA is then used to sign the individual Kafka broker and zookeeper certificates (step 2). Lastly, the Root CA’s public certificate is imported into the truststores of both the Kafka broker and Zookeeper (step 3), so that all pods can mutually verify their certificates when authenticating one with the other.&lt;/p&gt;

&lt;p&gt;Strimzi’s embedded Cluster CA dynamically generates valid individual certificates when spinning up new Kafka and Zookeeper pods. The signing operation (step 2) is handled automatically by Strimzi.&lt;/p&gt;

&lt;p&gt;For client access to Kafka brokers, Strimzi creates a different set of intermediate CA and server certificates, as shown in the next diagram.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/zero-trust-with-kafka/image5.png&quot; alt=&quot;&quot; style=&quot;width:70%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Figure 2 - Server authentication process for client access to Kafka brokers&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;The same Root CA from Figure 1 now signs a different intermediate CA, which the Strimzi community calls the Client CA (step 1). This naming is misleading since it does not actually sign any client certificates, but only the server certificates (step 2) that are set up on the external listener of the Kafka brokers. These server certificates are for the Kafka clients to authenticate the servers. This time, the Root CA’s public certificate will be imported into the Kafka Client truststore (step 3).&lt;/p&gt;

&lt;h3 id=&quot;clientauthentication&quot;&gt;Client authentication&lt;/h3&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/zero-trust-with-kafka/image1.png&quot; alt=&quot;&quot; style=&quot;width:70%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Figure 3 - Client authentication process&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;For client authentication, the Kafka client first needs to authenticate to Hashicorp Vault and request an ephemeral certificate from the Vault PKI engine (step 1). Vault then issues a certificate and signs it using its Root CA (step 2). With this certificate, the client can now authenticate to Kafka brokers, who will use the Root CA’s public certificate already in their truststore, as previously described (step 3).&lt;/p&gt;

&lt;h3 id=&quot;ca-tree&quot;&gt;CA tree&lt;/h3&gt;
&lt;p&gt;Putting together the three different authentication processes we have just covered, the CA tree now looks like this. Note that this is a simplified view for a single environment, a single cluster, and two clients only.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/zero-trust-with-kafka/image3.png&quot; alt=&quot;&quot; style=&quot;width:70%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Figure 4 - Complete certificate authority tree&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;As mentioned earlier, each environment (staging, production, etc.) has its own Root CA. Within an environment, each Strimzi cluster has its own pair of intermediate CAs: the Cluster CA and the Client CA. At the leaf level, the Zookeeper and Kafka broker pods each have their own individual certificates.&lt;/p&gt;

&lt;p&gt;On the right side of the diagram, each Kafka client can get an ephemeral certificate from Hashicorp Vault whenever they need to connect to Kafka. Each team or application has a dedicated Vault PKI role in Hashicorp Vault, restricting what can be requested for its certificate (e.g., Subject, TTL, etc.).&lt;/p&gt;

&lt;h3 id=&quot;strimzi-deployment&quot;&gt;Strimzi deployment&lt;/h3&gt;

&lt;p&gt;We heavily use Terraform to manage and provision our Kafka and Kafka-related components. This enables us to quickly and reliably spin up new clusters and perform cluster scaling operations.&lt;/p&gt;

&lt;p&gt;Under the hood, Strimzi Kafka deployment is a Kubernetes deployment. To increase the performance and the reliability of the Kafka cluster, we create dedicated Kubernetes nodes for each Strimzi Kafka broker and each Zookeeper pod, using &lt;a href=&quot;https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/&quot;&gt;Kubernetes taints and tolerations&lt;/a&gt;. This ensures that all resources of a single node are dedicated solely to either a single Kafka broker or a single Zookeeper pod.&lt;/p&gt;

&lt;p&gt;We also decided to go with a single Kafka cluster by Kubernetes cluster to make the management easier.&lt;/p&gt;

&lt;h3 id=&quot;client-setup&quot;&gt;Client setup&lt;/h3&gt;

&lt;p&gt;Coban provides backend microservice teams from all Grab verticals with a popular Kafka SDK in Golang, to standardise how teams utilise Coban Kafka clusters. Adding mTLS support mostly boils down to upgrading our SDK.&lt;/p&gt;

&lt;p&gt;Our enhanced SDK provides a default mTLS configuration that works out of the box for most teams, while still allowing customisation, e.g., for teams that have their own Hashicorp Vault Infrastructure for compliance reasons. Similarly, clients can choose among various Vault auth methods such as &lt;a href=&quot;https://developer.hashicorp.com/vault/docs/auth/aws&quot;&gt;AWS&lt;/a&gt; or &lt;a href=&quot;https://developer.hashicorp.com/vault/docs/auth/kubernetes&quot;&gt;Kubernetes&lt;/a&gt; to authenticate to Hashicorp Vault, or even implement their own logic for getting a valid client certificate.&lt;/p&gt;

&lt;p&gt;To mitigate the potential risk of a user maliciously sharing their application’s certificate with other applications or users, we limit the maximum Time-To-Live (TTL) for any given certificate. This also removes the overhead of maintaining a Certificate Revocation List (CRL). Additionally, our SDK stores the certificate and its associated private key in memory only, never on disk, hence reducing the attack surface.&lt;/p&gt;

&lt;p&gt;In our case, Hashicorp Vault is a dependency. To prevent it from reducing the overall availability of our data streaming platform, we have added two features to our SDK – a configurable retry mechanism and automatic renewal of clients’ short-lived certificates when two thirds of their TTL is reached. The upgraded SDK also produces new metrics around this certificate renewal process, enabling better monitoring and alerting.&lt;/p&gt;

&lt;h3 id=&quot;authorisation&quot;&gt;Authorisation&lt;/h3&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/zero-trust-with-kafka/image2.png&quot; alt=&quot;&quot; style=&quot;width:70%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Figure 5 - Authorisation process before a client can access a Kafka record&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;For authorisation, we set up the Open Policy Agent (OPA) as a standalone deployment in the Kubernetes cluster, and configured Strimzi to integrate the Kafka brokers with that OPA.&lt;/p&gt;

&lt;p&gt;OPA policies - written in the &lt;a href=&quot;https://www.openpolicyagent.org/docs/latest/policy-language/&quot;&gt;Rego&lt;/a&gt; language - describe the authorisation logic. They are created in a GitLab repository along with the authorisation rules, called data sources (step 1). Whenever there is a change, a GitLab CI pipeline automatically creates a bundle of the policies and data sources, and pushes it to an S3 bucket (step 2). From there, it is fetched by the OPA (step 3).&lt;/p&gt;

&lt;p&gt;When a client - identified by its TLS certificate’s Subject - attempts to consume or produce a Kafka record (step 4), the Kafka broker pod first issues an authorisation request to the OPA (step 5) before processing the client’s request. The outcome of the authorisation request is then cached by the Kafka broker pod to improve performance.&lt;/p&gt;

&lt;p&gt;As the core component of the authorisation process, the OPA is deployed with the same high availability as the Kafka cluster itself, i.e. spread across the same number of Availability Zones. Also, we decided to go with one dedicated OPA by Kafka cluster instead of having a unique global OPA shared between multiple clusters. This is to reduce the blast radius of any OPA incidents.&lt;/p&gt;

&lt;p&gt;For monitoring and alerting around authorisation, we submitted an &lt;a href=&quot;https://github.com/StyraInc/opa-kafka-plugin/pull/38&quot;&gt;Open Source contribution&lt;/a&gt; in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;opa-kafka-plugin&lt;/code&gt; project in order to enable the OPA authoriser to expose some metrics. Our contribution to the open source code allows us to monitor various aspects of the OPA, such as the number of authorised and unauthorised requests, as well as the cache hit-and-miss rates. Also, we set up alerts for suspicious activity such as unauthorised requests.&lt;/p&gt;

&lt;p&gt;Finally, as a platform team, we need to make authorisation a scalable, self-service process. Thus, we rely on the Git repository’s permissions to let Kafka topics’ owners approve the data source changes pertaining to their topics.&lt;/p&gt;

&lt;p&gt;Teams who need their applications to access a Kafka topic would write and submit a JSON data source as simple as this:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;{
 &quot;example_topic&quot;: {
   &quot;read&quot;: [
     &quot;clientA.grab&quot;,
     &quot;clientB.grab&quot;
   ],
   &quot;write&quot;: [
     &quot;clientB.grab&quot;
   ]
 }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;GitLab CI unit tests and business logic checks are set up in the Git repository to ensure that the submitted changes are valid. After that, the change would be submitted to the topic’s owner for review and approval.&lt;/p&gt;

&lt;h2 id=&quot;whats-next&quot;&gt;What’s next?&lt;/h2&gt;

&lt;p&gt;The performance impact of this security design is significant compared to unauthenticated, unauthorised, plaintext Kafka. We observed a drop in throughput, mostly due to the low performance of encryption and decryption in Java, and are currently benchmarking different encryption ciphers to mitigate this.&lt;/p&gt;

&lt;p&gt;Also, on authorisation, our current PBAC design is pretty static, with a list of applications granted access for each topic. In the future, we plan to move to Attribute-Based Access Control (ABAC), creating dynamic policies based on teams and topics’ metadata. For example, teams could be granted read and write access to all of their own topics by default. Leveraging a versatile component such as the OPA as our authorisation controller enables this evolution.&lt;/p&gt;

&lt;h1 id=&quot;join-us&quot;&gt;Join us&lt;/h1&gt;

&lt;p&gt;Grab is the leading superapp platform in Southeast Asia, providing everyday services that matter to consumers. More than just a ride-hailing and food delivery app, Grab offers a wide range of on-demand services in the region, including mobility, food, package and grocery delivery services, mobile payments, and financial services across 428 cities in eight countries.&lt;/p&gt;

&lt;p&gt;Powered by technology and driven by heart, our mission is to drive Southeast Asia forward by creating economic empowerment for everyone. If this mission speaks to you, &lt;a href=&quot;https://grab.careers/&quot;&gt;join our team&lt;/a&gt; today!&lt;/p&gt;
</description>
        <pubDate>Wed, 07 Dec 2022 00:23:05 +0000</pubDate>
        <link>https://engineering.grab.com/zero-trust-with-kafka</link>
        <guid isPermaLink="true">https://engineering.grab.com/zero-trust-with-kafka</guid>
        
        <category>Engineering</category>
        
        <category>Kafka</category>
        
        <category>Performance</category>
        
        <category>Zero trust</category>
        
        <category>Access control</category>
        
        
        <category>Engineering</category>
        
        <category>Security</category>
        
      </item>
    
      <item>
        <title>How KartaCam powers GrabMaps</title>
        <description>&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;

&lt;p&gt;The foundation for making any map is in imagery, but due to the complexity and dynamism of the real world, it is difficult for companies to collect high-quality, fresh images in an efficient yet low-cost manner. This is the case for Grab’s Geo team as well.&lt;/p&gt;

&lt;p&gt;Traditional map-making methods rely on professional-grade cameras that provide high resolution images to collect mapping imagery. These images are rich in content and detail, providing a good snapshot of the real world. However, we see two major challenges with this approach.&lt;/p&gt;

&lt;p&gt;The first is high cost. Professional cameras are too expensive to use at scale, especially in an emerging region like Southeast Asia. Apart from high equipment cost, operational cost is also high as local operation teams need professional training before collecting imagery.&lt;/p&gt;

&lt;p&gt;The other major challenge, related to the first, is that imagery will not be refreshed in a timely manner because of the high cost and operational effort required. It typically takes months or years before imagery is refreshed, which means maps get outdated easily.&lt;/p&gt;

&lt;p&gt;Compared to traditional collection methods, there are more affordable alternatives that some emerging map providers are using, such as crowdsourced collection done with smartphones or other consumer-grade action cameras. This allows more timely imagery refresh at a much lower cost.&lt;/p&gt;

&lt;p&gt;That said, there are several challenges with crowdsourcing imagery, such as:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Inconsistent quality in collected images.&lt;/li&gt;
  &lt;li&gt;Low operational efficiency as cameras and smartphones are not optimised for mapping.&lt;/li&gt;
  &lt;li&gt;Unreliable location accuracy.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;In order to solve the challenges above, we started building our own artificial intelligence (AI) camera called KartaCam.&lt;/p&gt;

&lt;h2 id=&quot;what-is-kartacam&quot;&gt;What is KartaCam?&lt;/h2&gt;

&lt;p&gt;Designed specifically for map-making, KartaCam is a lightweight camera that is easy to operate. It is everything you need for accurate and efficient image collection. KartaCam is powered by edge AI, and mainly comprises a camera module, a dual-band Global Navigation Satellite System (GNSS) module, and a built-in 4G Long-Term Evolution (LTE) module.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/kartacam-powers-grabmaps/image1.jpg&quot; alt=&quot;&quot; style=&quot;width:30%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;KartaCam&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;h3 id=&quot;camera-module&quot;&gt;Camera module&lt;/h3&gt;

&lt;p&gt;The camera module or optical design of KartaCam focuses on several key features:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Wide field of vision (FOV)&lt;/strong&gt;: A wide FOV to capture as many scenes and details as possible without requiring additional trips. A single KartaCam has a wide lens FOV of &amp;gt;150° and when we use four KartaCams together, each facing a different direction, we increase the FOV to 360°.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;High image quality&lt;/strong&gt;: A combination of high-definition optical lens and a high-resolution pixel image sensor can help to achieve better image quality. KartaCam uses a high-quality 12MP image sensor.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Ease of use&lt;/strong&gt;: Portable and easy to start using for people with little to no photography training. At Grab, we can easily deploy KartaCam to our fleet of driver-partners to map our region as they regularly travel these roads while ferrying passengers or making deliveries.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;edge-ai-for-smart-capturing-on-edge&quot;&gt;Edge AI for smart capturing on edge&lt;/h3&gt;

&lt;p&gt;Each KartaCam device is also equipped with &lt;a href=&quot;https://blogs.nvidia.com/blog/2022/02/17/what-is-edge-ai/&quot;&gt;edge AI&lt;/a&gt;, which enables AI computations to operate closer to the actual data – in our case, imagery collection. With edge AI, we can make decisions about imagery collection (i.e. upload, delete or recapture) at the device-level.&lt;/p&gt;

&lt;p&gt;To help with these decisions, we use a series of edge AI models and algorithms that are executed immediately after each image capture such as:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Scene recognition model&lt;/strong&gt;: For efficient map-making, we ensure that we make the right screen verdicts, meaning we only upload and process the right scene images. Unqualified images such as indoor, raining, and cloudy images are deleted directly on the KartaCam device. Joint detection algorithms are deployed in some instances to improve the accuracy of scene verdicts. For example, to detect indoor recording we look at a combination of driver moving speed, Inertial Measurement Units (IMU) data and edge AI image detection.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Image quality (IQ) checking AI model&lt;/strong&gt;: The quality of the images collected is paramount for map-making. Only qualified images judged by our IQ classification algorithm will be uploaded while those that are blurry or considered low-quality will be deleted. Once an unqualified image is detected (usually within the next second), a new image is captured, improving the success rate of collection.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Object detection AI model&lt;/strong&gt;: Only roadside images that contain relevant map-making content such as traffic signs, lights, and Point of Interest (POI) text are uploaded.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Privacy information detection&lt;/strong&gt;: Edge AI also helps protect privacy when collecting street images for map-making. It automatically blurs private information such as pedestrians’ faces and car plate numbers before uploading, ensuring adequate privacy protection.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/kartacam-powers-grabmaps/image7.png&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;h3 id=&quot;better-positioning-with-a-dual-band-gnssmodule&quot;&gt;Better positioning with a dual-band GNSS module&lt;/h3&gt;

&lt;p&gt;The Global Positioning System (GPS) mainly uses two frequency bands: L1 and L5. Most traditional phone or GPS modules only support the legacy GPS L1 band, while modern GPS modules support both L1 and L5. KartaCam leverages the L5 band which provides improved signal structure, transmission capabilities, and a wider bandwidth that can reduce multipath error, interference, and noise impacts. In addition, KartaCam uses a fine-tuned high-quality ceramic antenna that, together with the dual frequency band GPS module, greatly improves positioning accuracy.&lt;/p&gt;

&lt;h3 id=&quot;keeping-kartacam-connected&quot;&gt;Keeping KartaCam connected&lt;/h3&gt;

&lt;p&gt;KartaCam has a built-in 4G LTE module that ensures it is always connected and can be remotely managed. The KartaCam management portal can monitor camera settings like resolution and capturing intervals, even in edge AI machine learning models. This makes it easy for Grab’s map ops team and drivers to configure their cameras and upload captured images in a timely manner.&lt;/p&gt;

&lt;h2 id=&quot;enhancing-kartacam&quot;&gt;Enhancing KartaCam&lt;/h2&gt;

&lt;h3 id=&quot;kartacam-360-capturing-a-panorama-view&quot;&gt;KartaCam 360: Capturing a panorama view&lt;/h3&gt;

&lt;p&gt;To improve single collection trip efficiency, we group four KartaCams together to collect 360° images. The four cameras can be synchronised within milliseconds and the collected images are stitched together in a panoramic view.&lt;/p&gt;

&lt;p&gt;With KartaCam 360, we can increase the number of images collected in a single trip. According to Grab’s benchmark testing in Singapore and Jakarta, the POI information collected by KartaCam 360 is comparable to that of professional cameras, which cost about 20x more.&lt;/p&gt;

&lt;div align=&quot;middle&quot;&gt;
&lt;img src=&quot;/img/kartacam-powers-grabmaps/image3.png&quot; alt=&quot;&quot; style=&quot;width:30%&quot; /&gt;&lt;img src=&quot;/img/kartacam-powers-grabmaps/image2.jpg&quot; alt=&quot;&quot; style=&quot;width:30%&quot; /&gt;
&lt;/div&gt;
&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;figcaption align=&quot;middle&quot;&gt;KartaCam 360 &amp;amp; Scooter mount&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/kartacam-powers-grabmaps/image8.png&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Image sample from KartaCam 360&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;h2 id=&quot;kartacam-and-the-image-collection-workflow&quot;&gt;KartaCam and the image collection workflow&lt;/h2&gt;

&lt;p&gt;KartaCam, together with other GrabMaps imagery tools, provides a highly efficient, end-to-end, low-cost, and edge AI-powered smart solution to map the region. KartaCam is fully integrated as part of our map-making workflow.&lt;/p&gt;

&lt;p&gt;Our map-making solution includes the following components:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Collection management tool - Platform that defines map collection tasks for our driver-partners.&lt;/li&gt;
  &lt;li&gt;KartaView application - Mobile application provides map collection tasks and handles crowdsourced imagery collection.&lt;/li&gt;
  &lt;li&gt;KartaCam - Camera device connected to KartaView via Bluetooth and equipped with edge automatic processing for imagery capturing according to the task accepted.&lt;/li&gt;
  &lt;li&gt;Camera management tool - Handles camera parameters and settings for all KartaCam devices and can remotely control the KartaCam.&lt;/li&gt;
  &lt;li&gt;Automatic processing - Collected images are processed for quality check, stitching, and personal identification information (PII) blurring.&lt;/li&gt;
  &lt;li&gt;KartaView imagery platform - Processed images are then uploaded and the driver-partner receives payment.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/kartacam-powers-grabmaps/image4.jpg&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;In a future article, we will dive deeper into the technology behind KartaView and its role in GrabMaps.&lt;/p&gt;

&lt;h2 id=&quot;impact&quot;&gt;Impact&lt;/h2&gt;

&lt;p&gt;At the moment, Grab is rolling out thousands of KartaCams to all locations across Southeast Asia where Grab operates. This saves operational costs while improving the efficiency and quality of our data collection.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/kartacam-powers-grabmaps/image10.png&quot; alt=&quot;&quot; style=&quot;width:60%&quot; /&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;h3 id=&quot;better-data-quality-and-moremap-attributes&quot;&gt;Better data quality and more map attributes&lt;/h3&gt;

&lt;p&gt;Due to the excellent image quality, wide FOV coverage, accurate GPS positioning, and sensor data, the 360° images captured by KartaCam 360 also register detailed map attributes like POIs, traffic signs, and address plates. This will help us build a high quality map with rich and accurate content.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/kartacam-powers-grabmaps/image6.png&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;h3 id=&quot;reducing-operational-costs&quot;&gt;Reducing operational costs&lt;/h3&gt;

&lt;p&gt;Based on our research, the hardware cost for KartaCam 360 is significantly lower compared to similar professional cameras in the market. This makes it a more feasible option to scale up in Southeast Asia as the preferred tool for crowdsourcing imagery collection.&lt;/p&gt;

&lt;p&gt;With image quality checks and detection conducted at the edge, we can avoid re-collections and also ensure that only qualified images are uploaded. These result in saving time as well as operational and upload costs.&lt;/p&gt;

&lt;h3 id=&quot;upholding-privacy-standards&quot;&gt;Upholding privacy standards&lt;/h3&gt;

&lt;p&gt;KartaCam automatically blurs captured images that contain PII, like faces and licence plates directly from the edge devices. This means that all sensitive information is removed at this stage and is never uploaded to Grab servers.&lt;/p&gt;

&lt;div align=&quot;middle&quot;&gt;
&lt;img src=&quot;/img/kartacam-powers-grabmaps/image9.png&quot; alt=&quot;&quot; style=&quot;width:40%&quot; /&gt;&lt;img src=&quot;/img/kartacam-powers-grabmaps/image5.png&quot; alt=&quot;&quot; style=&quot;width:40%&quot; /&gt;
&lt;/div&gt;
&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;figcaption align=&quot;middle&quot;&gt;On-the-edge blurring example&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;h2 id=&quot;whats-next&quot;&gt;What’s next?&lt;/h2&gt;

&lt;p&gt;Moving forward, Grab will continue to enhance KartaCam’s performance in the following aspects:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Further improve image quality with better image sensors, unique optical components, and state-of-art Image Signal Processor (ISP).&lt;/li&gt;
  &lt;li&gt;Make KartaCam compatible with Light Detection And Ranging (LIDAR) for high-definition collection and indoor use cases.&lt;/li&gt;
  &lt;li&gt;Improve GNSS module performance with higher sampling frequency and accuracy, and integrate new technology like Real-Time Kinematic (RTK) and Precise Point Positioning (PPP) solutions to further improve the positioning accuracy. When combined with sensor fusion from IMU sensors, we can improve positioning accuracy for map-making further.&lt;/li&gt;
  &lt;li&gt;Improve usability, integration, and enhance imagery collection and portability for KartaCam so driver-partners can easily capture mapping data. &lt;/li&gt;
  &lt;li&gt;Explore new product concepts for future passive street imagery collection.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;To find out more about how KartaCam delivers comprehensive cost-effective mapping data, check out &lt;a href=&quot;https://www.grab.com/sg/enterprise-blog/kartacam-delivers-comprehensive-cost-effective-mapping-data/&quot;&gt;this article&lt;/a&gt;.&lt;/p&gt;

&lt;h1 id=&quot;join-us&quot;&gt;Join us&lt;/h1&gt;

&lt;p&gt;Grab is the leading superapp platform in Southeast Asia, providing everyday services that matter to consumers. More than just a ride-hailing and food delivery app, Grab offers a wide range of on-demand services in the region, including mobility, food, package and grocery delivery services, mobile payments, and financial services across 428 cities in eight countries.&lt;/p&gt;

&lt;p&gt;Powered by technology and driven by heart, our mission is to drive Southeast Asia forward by creating economic empowerment for everyone. If this mission speaks to you, &lt;a href=&quot;https://grab.careers/&quot;&gt;join our team&lt;/a&gt; today!&lt;/p&gt;

&lt;h1 id=&quot;references&quot;&gt;References&lt;/h1&gt;

</description>
        <pubDate>Thu, 01 Dec 2022 01:08:40 +0000</pubDate>
        <link>https://engineering.grab.com/kartacam-powers-grabmaps</link>
        <guid isPermaLink="true">https://engineering.grab.com/kartacam-powers-grabmaps</guid>
        
        <category>Engineering</category>
        
        <category>GrabMaps</category>
        
        <category>KartaCam</category>
        
        <category>Maps</category>
        
        <category>Edge AI</category>
        
        
        <category>Engineering</category>
        
        <category>Product</category>
        
        <category>Design</category>
        
      </item>
    
      <item>
        <title>Graph for fraud detection</title>
        <description>&lt;p&gt;In earlier articles of this series, we’ve covered the &lt;a href=&quot;/graph-networks&quot;&gt;importance of graph networks&lt;/a&gt;, &lt;a href=&quot;/graph-concepts&quot;&gt;graph concepts&lt;/a&gt; and &lt;a href=&quot;/graph-visualisation&quot;&gt;how graph visualisation makes fraud investigations easier and more effective&lt;/a&gt;. In this article, we will explore how we use graph-based models to tackle fraud detection as fraud patterns increase and diversify.&lt;/p&gt;

&lt;p&gt;Grab has grown rapidly in the past few years. It has expanded its business from ride hailing to food and grocery delivery, financial services, and more. Fraud detection is challenging in Grab, because new fraud patterns always arise whenever we introduce a new business product. We cannot afford to develop a new model whenever a new fraud pattern appears as it is time consuming and introduces a cold start problem, that is no protection at the early stage. We need a general fraud detection framework to better protect Grab from various unknown fraud risks.&lt;/p&gt;

&lt;p&gt;Our key observation is that although Grab has many different business verticals, the entities within those businesses are connected to each other (Figure 1. Left), for example, two passengers may be connected by a Wi-Fi router or phone device, a merchant may be connected to a passenger by a food order, and so on. A graph provides an elegant way to capture the spatial correlation among different entities in the Grab ecosystem. A common fraud shows clear patterns on a graph, for example, a fraud syndicate tends to share physical devices, and collusion happens between a merchant and an isolated set of passengers (Figure 1. Right).&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/graph-for-fraud-detection/fig1.png&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Figure 1. Left: The graph captures different correlations in the Grab ecosystem. &lt;br /&gt; Right: The graph shows that common fraud has clear patterns.&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;We believe graphs can help us discover subtle traces and complicated fraud patterns more effectively. Graph-based solutions will be a sustainable foundation for us to fight against known and unknown fraud risks.&lt;/p&gt;

&lt;h2 id=&quot;why-graph&quot;&gt;Why graph?&lt;/h2&gt;

&lt;p&gt;The most common fraud detection methods include the rule engine and the decision tree-based models, for example, boosted tree, random forest, and so on. Rules are a set of simple logical expressions designed by human experts to target a particular fraud problem. They are good for simple fraud detection, but they usually do not work well in complicated fraud or unknown fraud cases.&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Fraud detection methods &lt;br /&gt;&lt;br /&gt;&lt;/th&gt;
      &lt;th&gt;Utilises correlations &lt;br /&gt; (Higher is better)&lt;/th&gt;
      &lt;th&gt;Detects unknown fraud &lt;br /&gt; (Higher is better)&lt;/th&gt;
      &lt;th&gt;Requires feature engineering &lt;br /&gt; (Lower is better)&lt;/th&gt;
      &lt;th&gt;Depends on labels &lt;br /&gt; (Lower is better)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Rule engine&lt;/td&gt;
      &lt;td&gt;Low&lt;/td&gt;
      &lt;td&gt;N/A&lt;/td&gt;
      &lt;td&gt;N/A&lt;/td&gt;
      &lt;td&gt;Low&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Decision tree&lt;/td&gt;
      &lt;td&gt;Low&lt;/td&gt;
      &lt;td&gt;Low&lt;/td&gt;
      &lt;td&gt;High&lt;/td&gt;
      &lt;td&gt;High&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;Graph model&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;&lt;strong&gt;High&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;&lt;strong&gt;High&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;&lt;strong&gt;Low&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;&lt;strong&gt;Low&lt;/strong&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;br /&gt;
Table 1. Graph vs. common fraud detection methods.&lt;/p&gt;

&lt;p&gt;Decision tree-based models have been dominating fraud detection and Kaggle competitions for structured or tabular data in the past few years. With that said, the performance of a tree-based model is highly dependent on the quality of labels and feature engineering, which is often hard to obtain in real life. In addition, it usually does not work well in unknown fraud which has not been seen in the labels.&lt;/p&gt;

&lt;p&gt;On the other hand, a graph-based model requires little amount of feature engineering and it is applicable to unknown fraud detection with less dependence on labels, because it utilises the structural correlations on the graph.&lt;/p&gt;

&lt;p&gt;In particular, fraudsters tend to show strong correlations on a graph, because they have to share physical properties such as personal identities, phone devices, Wi-Fi routers, delivery addresses, and so on, to reduce cost and maximise revenue as shown in Figure 2 (left). An example of such strong correlations is shown in Figure 2 (right), where the entities on the graph are densely connected, and the known fraudsters are highlighted in red. Those strong correlations on the graph are the key reasons that make the graph based approach a sustainable foundation for various fraud detection tasks.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/graph-for-fraud-detection/fig2.png&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Figure 2. Fraudsters tend to share physical properties to reduce cost (left), and they are densely connected as shown on a graph (right).&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;h1 id=&quot;semi-supervised-graph-learning&quot;&gt;Semi-supervised graph learning&lt;/h1&gt;

&lt;p&gt;Unlike traditional decision tree-based models, the graph-based machine learning model can utilise the graph’s correlations and achieve great performance even with few labels. The semi-supervised Graph Convolutional Network model has been extremely popular in recent years &lt;sup id=&quot;fnref:1&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:1&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;. It has proven its success in many fraud detection tasks across industries, for example, e-commerce fraud, financial fraud, internet traffic fraud, etc.
We apply the Relational Graph Convolutional Network (RGCN) &lt;sup id=&quot;fnref:2&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:2&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt; for fraud detection in Grab’s ecosystem. Figure 3 shows the overall architecture of RGCN. It takes a graph as input, and the graph passes through several graph convolutional layers to get node embeddings. The final layer outputs a fraud probability for each node. At each graph convolutional layer, the information is propagated along the neighbourhood nodes within the graph, that is nodes that are close on the graph are similar to each other.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/graph-for-fraud-detection/fig3.png&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Fig 3. A semi-supervised Relational Graph Convolutional Network model.&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;We train the RGCN model on a graph with millions of nodes and edges, where only a few percentages of the nodes on the graph have labels. The semi-supervised graph model has little dependency on the labels, which makes it a robust model for tackling various types of unknown fraud.&lt;/p&gt;

&lt;p&gt;Figure 4 shows the overall performance of the RGCN model. On the left is the Receiver Operating Characteristic (ROC) curve on the label dataset, in particular, the Area Under the Receiver Operating Characteristic (AUROC) value is close to 1, which means the RGCN model can fit the label data quite well. The right column shows the low dimensional projections of the node embeddings on the label dataset. It is clear that the embeddings of the genuine passenger are well separated from the embeddings of the fraud passenger. The model can distinguish between a fraud and a genuine passenger quite well.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/graph-for-fraud-detection/fig4.png&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Fig 4. Left: ROC curve of the RGCN model on the label dataset. &lt;br /&gt; Right: Low dimensional projections of the graph node embeddings.&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;Finally, we would like to share a few tips that will make the RGCN model work well in practice.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Use less than three convolutional layers&lt;/strong&gt;: The node feature will be over-smoothed if there are many convolutional layers, that is all the nodes on the graph look similar.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Node features are important&lt;/strong&gt;: Domain knowledge of the node can be formulated as node features for the graph model, and rich node features are likely to boost the model performance.&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;graph-explainability&quot;&gt;Graph explainability&lt;/h1&gt;

&lt;p&gt;Unlike other deep network models, graph neural network models usually come with great explainability, that is why a user is classified as fraudulent. For example, fraudulent accounts are likely to share hardware devices and form dense clusters on the graph, and those fraud clusters can be easily spotted on a graph visualiser &lt;sup id=&quot;fnref:4&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:4&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;

&lt;p&gt;Figure 5 shows an example where graph visualisation helps to explain the model prediction scores. The genuine passenger with a low RGCN score does not share devices with other passengers, while the fraudulent passenger with a high RGCN score shares devices with many other passengers, that is, dense clusters.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/graph-for-fraud-detection/fig5.png&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Figure 5. Upper left: A genuine passenger with a low RGCN score has no device sharing with other passengers. Bottom right: A fraudulent user with a high RGCN score shares devices with many other passengers.&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;h1 id=&quot;closing-thoughts&quot;&gt;Closing thoughts&lt;/h1&gt;

&lt;p&gt;Graphs provide a sustainable foundation for combating many different types of fraud risks. Fraudsters are evolving very fast these days, and the best traditional rules or models can do is to chase after those fraudsters given that a fraud pattern has already been discovered. This is suboptimal as the damage has already been done on the platform. With the help of graph models, we can potentially detect those fraudsters before any fraudulent activity has been conducted, thus reducing the fraud cost.&lt;/p&gt;

&lt;p&gt;The graph structural information can significantly boost the model performance without much dependence on labels, which is often hard to get and might have a large bias in fraud detection tasks. We have shown that with only a small percentage of labelled nodes on the graph, our model can already achieve great performance.&lt;/p&gt;

&lt;p&gt;With that said, there are also many challenges to making a graph model work well in practice. We are working towards solving the following challenges we are facing.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Feature initialisation&lt;/strong&gt;: Sometimes, it is hard to initialise the node feature, for example, a device node does not carry many semantic meanings. We have explored self-supervised pre-training &lt;sup id=&quot;fnref:3&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:3&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;4&lt;/a&gt;&lt;/sup&gt; to help the feature initialisation, and the preliminary results are promising.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Real-time model prediction&lt;/strong&gt;: Realtime graph model prediction is challenging because real-time graph updating is a heavy operation in most cases. One possible solution is to do batch real-time prediction to reduce the overhead.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Noisy connections&lt;/strong&gt;: Some connections on the graph are inherently noisy on the graph, for example, two users sharing the same IP address does not necessarily mean they are physically connected. The IP might come from a mobile network. One possible solution is to use the attention mechanism in the graph convolutional kernel and control the message passing based on the type of connection and node profiles.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;speak-to-us&quot;&gt;Speak to us&lt;/h2&gt;
&lt;p&gt;GrabDefence is a proprietary fraud prevention platform built by Grab, Southeast Asia’s leading superapp. Since 2019, the GrabDefence team has shared its fraud management capabilities and platform with enterprises and startups to leverage Grab’s advanced AI/ML models, hyper local insights and patented device intelligence technologies.&lt;/p&gt;

&lt;p&gt;To learn more about GrabDefence or to speak to our fraud management experts, contact us at &lt;a href=&quot;mailto:gd.contact@grabtaxi.com&quot;&gt;gd.contact@grabtaxi.com&lt;/a&gt;.&lt;/p&gt;

&lt;h1 id=&quot;join-us&quot;&gt;Join us&lt;/h1&gt;

&lt;p&gt;Grab is the leading superapp platform in Southeast Asia, providing everyday services that matter to consumers. More than just a ride-hailing and food delivery app, Grab offers a wide range of on-demand services in the region, including mobility, food, package and grocery delivery services, mobile payments, and financial services across 428 cities in eight countries.&lt;/p&gt;

&lt;p&gt;Powered by technology and driven by heart, our mission is to drive Southeast Asia forward by creating economic empowerment for everyone. If this mission speaks to you, &lt;a href=&quot;https://grab.careers/&quot;&gt;join our team&lt;/a&gt; today!&lt;/p&gt;

&lt;h1 id=&quot;references&quot;&gt;References&lt;/h1&gt;

&lt;div class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;T. Kipf and M. Welling, “Semi-supervised classification with graph convolutional networks,” in ICLR, 2017 &lt;a href=&quot;#fnref:1&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:2&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;Schlichtkrull, Michael, et al. “Modeling relational data with graph convolutional networks.” European semantic web conference. Springer, Cham, 2018. &lt;a href=&quot;#fnref:2&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:4&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;Fujiao Liu, Shuqi Wang, et al.. “&lt;a href=&quot;https://engineering.grab.com/graph-visualisation&quot;&gt;Graph Networks - 10X investigation with Graph Visualisations&lt;/a&gt;”. Grab Tech Blog. &lt;a href=&quot;#fnref:4&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:3&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;Wang, Chen, et al.. “Deep Fraud Detection on Non-attributed Graph.” IEEE Big Data conference, PSBD, 2021. &lt;a href=&quot;#fnref:3&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</description>
        <pubDate>Thu, 24 Nov 2022 00:13:40 +0000</pubDate>
        <link>https://engineering.grab.com/graph-for-fraud-detection</link>
        <guid isPermaLink="true">https://engineering.grab.com/graph-for-fraud-detection</guid>
        
        <category>Analytics</category>
        
        <category>Data Science</category>
        
        <category>Security</category>
        
        <category>Graphs</category>
        
        <category>Graph visualisation</category>
        
        <category>Graph networks</category>
        
        <category>Fraud detection</category>
        
        
        <category>Engineering</category>
        
        <category>Data Science</category>
        
        <category>Security</category>
        
      </item>
    
      <item>
        <title>Query expansion based on user behaviour</title>
        <description>&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;Our consumers used to face a few common pain points while searching for food with the Grab app. Sometimes, the results would include merchants that were not yet operational or locations that were out of the delivery radius. Other times, no alternatives were provided. The search system would also have difficulties handling typos, keywords in different languages, synonyms, and even word spacing issues, resulting in a suboptimal user experience.&lt;/p&gt;

&lt;p&gt;Over the past few months, our search team has been building a query expansion framework that can solve these issues. When a user query comes in, it expands the query to a few related keywords based on semantic relevance and user intention. These expanded words are then searched with the original query to recall more results that are high-quality and diversified. Now let’s take a deeper look at how it works.&lt;/p&gt;

&lt;h1 id=&quot;query-expansion-framework&quot;&gt;Query expansion framework&lt;/h1&gt;

&lt;h2 id=&quot;building-the-query-expansion-corpus&quot;&gt;Building the query expansion corpus&lt;/h2&gt;

&lt;p&gt;We used two different approaches to produce query expansion candidates: manual annotation for top keywords and data mining based on user rewrites.&lt;/p&gt;

&lt;h3 id=&quot;manual-annotation-for-top-keywords&quot;&gt;Manual annotation for top keywords&lt;/h3&gt;

&lt;p&gt;Search has a pronounced fat head phenomenon. The most frequent thousand of keywords account for more than 70% of the total search traffic. Therefore, handling these keywords well can improve the overall search quality a lot. We manually annotated the possible expansion candidates for these common keywords to cover the most popular merchants, items and alternatives. For instance, “McDonald’s” is annotated with {“burger”, “western”}.&lt;/p&gt;

&lt;h3 id=&quot;data-mining-based-on-user-rewrites&quot;&gt;Data mining based on user rewrites&lt;/h3&gt;

&lt;p&gt;We observed that sometimes users tend to rewrite their queries if they are not satisfied with the search result. As a pilot study, we checked the user rewrite records within some user search sessions and found several interesting samples:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;{Ya Kun Kaya Toast,Starbucks}
{healthy,Subway}
{Muni,Muji}
{奶茶,koi}
{Roti,Indian}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We can see that besides spelling corrections, users’ rewrite behaviour also reveals deep semantic relations between these pairs that cannot be easily captured by lexical similarity, such as similar merchants, merchant attributes, language differences, cuisine types, and so on. We can leverage the user’s knowledge to build a query expansion corpus to improve the diversity of the search result and user experience. Furthermore, we can use the wisdom of the crowd to find some common patterns with higher confidence.&lt;/p&gt;

&lt;p&gt;Based on this intuition, we leveraged the high volume of search click data available in Grab to generate high-quality expansion pairs at the user session level. To augment the original queries, we collected rewrite pairs that happened to multiple users and multiple times in a time period. Specifically, we used the heuristic rules below to collect the rewrite pairs:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Select the sessions where there are at least two distinct queries (rewrite session)&lt;/li&gt;
  &lt;li&gt;Collect adjacent query pairs in the search session where the second query leads to a click but the first does not (effective rewrite)&lt;/li&gt;
  &lt;li&gt;Filter out the sample pairs with time interval longer than 30 seconds in between, as users are more likely to change their mind on what to look for in these pairs (single intention)&lt;/li&gt;
  &lt;li&gt;Count the occurrences and filter out the low-frequency pairs (confidence management)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;After we have the mining pairs, we categorised and annotated the rewrite types to gain a deeper understanding of the user’s rewrite behaviour. A few samples mined from the Singapore area data are shown in the table below.&lt;/p&gt;

&lt;table class=&quot;table&quot;&gt;
&lt;thead&gt;
  &lt;tr&gt;
    &lt;th&gt;Original query&lt;/th&gt;
    &lt;th&gt;Rewrite query&lt;/th&gt;
    &lt;th&gt;Frequency in a month&lt;/th&gt;
    &lt;th&gt;Distinct user count&lt;/th&gt;
    &lt;th&gt;Type&lt;/th&gt;
  &lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
    &lt;td&gt;playmade by 丸作&lt;/td&gt;
    &lt;td&gt;playmade&lt;/td&gt;
    &lt;td&gt;697&lt;/td&gt;
    &lt;td&gt;666&lt;/td&gt;
    &lt;td&gt;Drop keywords&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;mcdonald's&lt;/td&gt;
    &lt;td&gt;burger&lt;/td&gt;
    &lt;td&gt;573&lt;/td&gt;
    &lt;td&gt;535&lt;/td&gt;
    &lt;td&gt;Merchant -&amp;gt; Food&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;Bubble tea&lt;/td&gt;
    &lt;td&gt;koi&lt;/td&gt;
    &lt;td&gt;293&lt;/td&gt;
    &lt;td&gt;287&lt;/td&gt;
    &lt;td&gt;Food -&amp;gt; Merchant&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;Kfc&lt;/td&gt;
    &lt;td&gt;McDonald's&lt;/td&gt;
    &lt;td&gt;238&lt;/td&gt;
    &lt;td&gt;234&lt;/td&gt;
    &lt;td&gt;Merchant -&amp;gt; Merchant&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;cake&lt;/td&gt;
    &lt;td&gt;birthday cake&lt;/td&gt;
    &lt;td&gt;206&lt;/td&gt;
    &lt;td&gt;205&lt;/td&gt;
    &lt;td&gt;Add words&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;麦当劳&lt;/td&gt;
    &lt;td&gt;mcdonald's&lt;/td&gt;
    &lt;td&gt;205&lt;/td&gt;
    &lt;td&gt;199&lt;/td&gt;
    &lt;td&gt;Locale change&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;4 fingers&lt;/td&gt;
    &lt;td&gt;4fingers&lt;/td&gt;
    &lt;td&gt;165&lt;/td&gt;
    &lt;td&gt;162&lt;/td&gt;
    &lt;td&gt;Space correction&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;krc&lt;/td&gt;
    &lt;td&gt;kfc&lt;/td&gt;
    &lt;td&gt;126&lt;/td&gt;
    &lt;td&gt;124&lt;/td&gt;
    &lt;td&gt;Spelling correction&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;5 guys&lt;/td&gt;
    &lt;td&gt;five guys&lt;/td&gt;
    &lt;td&gt;120&lt;/td&gt;
    &lt;td&gt;120&lt;/td&gt;
    &lt;td&gt;Number synonym&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;koi the&lt;/td&gt;
    &lt;td&gt;koi thé&lt;/td&gt;
    &lt;td&gt;45&lt;/td&gt;
    &lt;td&gt;44&lt;/td&gt;
    &lt;td&gt;Tone change&lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;We further computed the percentages of some categories, as shown in the figure below.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/query-expansion-based-on-user-behaviour/image1.png&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;
  &lt;figcaption align=&quot;middle&quot;&gt;Figure 1. The donut chart illustrates the percentages of the distinct user counts for different types of rewrites.&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;Apart from adding words, dropping words and spelling corrections, a significant portion of the rewrites are in the category of Other. It is more semantic driven, such as merchant to merchant, or merchant to cuisine. Those rewrites are useful for capturing deeper connections between queries and can be a powerful diversifier to query expansion.&lt;/p&gt;

&lt;h3 id=&quot;grouping&quot;&gt;Grouping&lt;/h3&gt;

&lt;p&gt;After all the rewrite pairs were discovered offline through data mining, we grouped the query pairs by the original query to get the expansion candidates of each query. For serving efficiency, we limited the max number of expansion candidates to three.&lt;/p&gt;

&lt;h2 id=&quot;query-expansion-serving&quot;&gt;Query expansion serving&lt;/h2&gt;

&lt;h3 id=&quot;expansion-matching-architecture&quot;&gt;Expansion matching architecture&lt;/h3&gt;

&lt;p&gt;The expansion matching architecture benefits from the recent search architecture upgrade, where the system flow is changed to a query understanding, multi-recall and result fusion flow. In particular, a query goes through the query understanding module and gets augmented with additional information. In this case, the query understanding module takes in the keyword and expands it to multiple synonyms, for example, KFC will be expanded to fried chicken. The original query together with its expansions are sent together to the search engine under the multi-recall framework. After that, results from multiple recallers with different keywords are fused together.&lt;/p&gt;

&lt;h3 id=&quot;continuous-monitoring-and-feedback-loop&quot;&gt;Continuous monitoring and feedback loop&lt;/h3&gt;

&lt;p&gt;It’s important to make sure the expansion pairs are relevant and up-to-date. We run the data mining pipeline periodically to capture the new user rewrite behaviours. Meanwhile, we also monitor the expansion pairs’ contribution to the search result by measuring the net contribution of recall or user interaction that the particular query brings, and eliminate the obsolete pairs in an automatic way. This reflects our effort to build an adaptive system.&lt;/p&gt;

&lt;h1 id=&quot;results&quot;&gt;Results&lt;/h1&gt;

&lt;p&gt;We conducted online A/B experiments across 6 countries in Southeast Asia to evaluate the expanded queries generated by our system. We set up 3 groups:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Control group, where no query is expanded.&lt;/li&gt;
  &lt;li&gt;Treatment group 1, where we expanded the queries based on manual annotations only.&lt;/li&gt;
  &lt;li&gt;Treatment group 2, where we expanded the queries using the data mining approach.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;We observed decent uplift in click-through rate and conversion rate from both treatment groups. Furthermore, in treatment group 2, the data mining approach produced even better results.&lt;/p&gt;

&lt;h1 id=&quot;future-work&quot;&gt;Future work&lt;/h1&gt;

&lt;h2 id=&quot;data-mining-enhancement&quot;&gt;Data mining enhancement&lt;/h2&gt;

&lt;p&gt;Currently, the data mining approach can only identify the pairs from the same search session by one user. This limits the number of linked pairs. Some potential enhancements include:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Augment expansion pairs by associating queries from different users who click on the same merchant/item, for example, using a click graph. This can capture relevant queries across user sessions.&lt;/li&gt;
  &lt;li&gt;Build a probabilistic model on top of the current transition pairs. Currently, all the transition pairs are equally weighted but apparently, the transitions that happen more often should carry higher probability/weights.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;ads-application&quot;&gt;Ads application&lt;/h2&gt;

&lt;p&gt;Query expansion can be applied to advertising and would increase ads fill rate. With “KFC” expanded to “fried chicken”, the sponsored merchants who buy the keyword “fried chicken” would be eligible to show up when the user searches “KFC”. This would enable Grab to provide more relevant sponsored content to our users, which helps not only the consumers but also the merchants.&lt;/p&gt;

&lt;p&gt;&lt;small class=&quot;credits&quot;&gt;Special thanks to Zhengmin Xu and Daniel Ng for proofreading this article.&lt;/small&gt;&lt;/p&gt;

&lt;h1 id=&quot;join-us&quot;&gt;Join us&lt;/h1&gt;
&lt;p&gt;Grab is the leading superapp platform in Southeast Asia, providing everyday services that matter to consumers. More than just a ride-hailing and food delivery app, Grab offers a wide range of on-demand services in the region, including mobility, food, package and grocery delivery services, mobile payments, and financial services across 428 cities in eight countries.&lt;/p&gt;

&lt;p&gt;Powered by technology and driven by heart, our mission is to drive Southeast Asia forward by creating economic empowerment for everyone. If this mission speaks to you, &lt;a href=&quot;https://grab.careers/&quot;&gt;join our team&lt;/a&gt; today!&lt;/p&gt;
</description>
        <pubDate>Wed, 16 Nov 2022 00:29:00 +0000</pubDate>
        <link>https://engineering.grab.com/query-expansion-based-on-user-behaviour</link>
        <guid isPermaLink="true">https://engineering.grab.com/query-expansion-based-on-user-behaviour</guid>
        
        <category>Analytics</category>
        
        <category>Data Science</category>
        
        
        <category>Engineering</category>
        
        <category>Data Science</category>
        
      </item>
    
      <item>
        <title>Using mobile sensor data to encourage safer driving</title>
        <description>&lt;p&gt;“Telematics”, a cross between the words &lt;em&gt;telecommunications&lt;/em&gt; and &lt;em&gt;informatics&lt;/em&gt;, was coined in the late 1970s to refer to the use of communication technologies in facilitating exchange of information. In the modern day, such technologies may include cloud platforms, mobile networks, and wireless transmissions (e.g., Bluetooth). Although the initial intention is for a more general scope, telematics is now specifically used to refer to vehicle telematics where details of vehicle movements are tracked for use cases such as driving safety, driver profiling, fleet optimisation, and productivity improvements.&lt;/p&gt;

&lt;p&gt;We’ve previously published &lt;a href=&quot;https://engineering.grab.com/telematics-at-grab&quot;&gt;this article&lt;/a&gt; to share how Grab uses telematics to improve driver safety. In this blog post, we dive deeper into how telematics technology is used at Grab to encourage safer driving for our driver and delivery partners.&lt;/p&gt;

&lt;h1 id=&quot;background&quot;&gt;Background&lt;/h1&gt;

&lt;p&gt;At Grab, the safety of our users and their experience on our platform is our highest priority. By encouraging safer driving habits from our driver and delivery partners, road traffic accidents can be minimised, potentially reducing property damage, injuries, and even fatalities. Safe driving also helps ensure smoother rides and a more pleasant experience for consumers using our platform.&lt;/p&gt;

&lt;p&gt;To encourage safer driving, we should:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Have a data-driven approach to understand how our driver and delivery partners are driving.&lt;/li&gt;
  &lt;li&gt;Help partners better understand how to improve their driving by summarising key driving history into a personalised &lt;strong&gt;Driving Safety Report&lt;/strong&gt;.&lt;/li&gt;
&lt;/ol&gt;

&lt;h1 id=&quot;understanding-driving-behaviour&quot;&gt;Understanding driving behaviour&lt;/h1&gt;

&lt;p&gt;One of the most direct forms of driving assessment is consumer feedback or complaints. However, the frequency and coverage of this feedback is not very high as they are only applicable to transport verticals like JustGrab or GrabBike and not delivery verticals like GrabFood or GrabExpress. Plus, most driver partners tend not to receive any driving-related feedback (whether positive or negative), even for the transport verticals.&lt;/p&gt;

&lt;p&gt;A more comprehensive method of assessing driving behaviour is to use the driving data collected during Grab bookings. To make sense of these data, we focus on selected driving manoeuvres (e.g., braking, acceleration, cornering, speeding) and detect the number of instances where our data shows unsafe driving in each of these areas.&lt;/p&gt;

&lt;p&gt;We acknowledge that the detected instances may be subjected to errors and may not provide the complete picture of what’s happening on the ground (e.g., partners may be forced to do an emergency brake due to someone swerving into their lane).&lt;/p&gt;

&lt;p&gt;To address this, we have incorporated several fail-safe checks into our detection logic to minimise erroneous detection. Also, any assessment of driving behaviour will be based on an aggregation of these unsafe driving instances over a large amount of driving data. For example, individual harsh braking instances may be inconclusive but if a driver partner displays multiple counts consistently across many bookings, it is likely that the partner may be used to unsafe driving practices like tailgating or is distracted while driving.&lt;/p&gt;

&lt;h1 id=&quot;telematics-for-detecting-unsafe-driving&quot;&gt;Telematics for detecting unsafe driving&lt;/h1&gt;

&lt;p&gt;For Grab to consistently ensure our consumers’ safety, we need to proactively detect unsafe driving behaviour before an accident occurs. However, it is not feasible for someone to be with our driver and delivery partners all the time to observe their driving behaviour. We should leverage sensor data to monitor these driving behaviour at scale.&lt;/p&gt;

&lt;p&gt;Traditionally, a specialised “black box” inertial measurement unit (IMU) equipped with sensors such as accelerometers, gyroscopes, and GPS needs to be installed in alignment with the vehicle to directly measure vehicular acceleration and speed. In this manner, it would be straightforward to detect unsafe driving instances using this data. Unfortunately, the cost of purchasing and installing such devices for all our partners is prohibitively high and it would be hard to scale.&lt;/p&gt;

&lt;p&gt;Instead, we can leverage a device that all partners already have: their mobile phone. Modern smartphones already contain similar sensors to those in IMUs and data can be collected through the telematics SDK. More details on telematics data collection can be found in a recently published Grab tech blog article&lt;sup id=&quot;fnref:1&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:1&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;

&lt;p&gt;It’s important to note that telematics data are collected at a sufficiently high sampling frequency (much more than 1 Hz) to minimise inaccuracies in detecting unsafe driving instances characterised by sharp acceleration impulses.&lt;/p&gt;

&lt;h2 id=&quot;processing-mobile-sensor-data-to-detect-unsafe-driving&quot;&gt;Processing mobile sensor data to detect unsafe driving&lt;/h2&gt;

&lt;p&gt;Unlike specialised IMUs installed in vehicles, mobile sensor data have added challenges to detecting unsafe driving.&lt;/p&gt;

&lt;h3 id=&quot;accounting-for-orientation-phone-vs-vehicle&quot;&gt;Accounting for orientation: Phone vs. vehicle&lt;/h3&gt;

&lt;p&gt;The phone is usually in a different orientation compared to the vehicle. Strictly speaking, the phone accelerometer sensor measures the accelerations of the phone and not the vehicle acceleration. To infer vehicle acceleration from phone sensor data, we developed a customised processing algorithm optimised specifically for Grab’s data.&lt;/p&gt;

&lt;p&gt;First, the orientation offset of the phone with respect to the vehicle is defined using Euler angles: roll, pitch and yaw. In data windows with no net acceleration of the vehicle (e.g., no braking, turning motion), the only acceleration measured by the accelerometer is gravitational acceleration. Roll and pitch angles can then be determined through trigonometric manipulation. The complete triaxial accelerations of the phone are then rotated to the horizontal plane and the yaw angle is determined by principal component analysis (PCA).&lt;/p&gt;

&lt;p&gt;An assumption here is that there will be sufficient braking and acceleration manoeuvring for PCA to determine the correct forward direction. This Euler angles determination is done periodically to account for any movement of phones during the trip. Finally, the raw phone accelerations are rotated to the vehicle orientation through a matrix multiplication with the rotation matrix derived from the Euler angles (see Figure 1).&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/using-mobile-sensor-data-to-encourage-safer-driving/image1.png&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;
  &lt;figcaption align=&quot;middle&quot;&gt;Figure 1: Inference of vehicle acceleration from the phone sensor data. &lt;a href=&quot;https://www.freepik.com/free-psd/isometric-minimal-3d-phone-with-rrss-interface-mockup-levitating_13195223.htm&quot;&gt;Smartphone&lt;/a&gt; and &lt;a href=&quot;https://www.freepik.com/free-vector/white-sports-car-isolated-white-vector_3529812.htm&quot;&gt;car&lt;/a&gt; images modified from designs found in Freepik.com.&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;h3 id=&quot;handling-variations-in-data-quality&quot;&gt;Handling variations in data quality&lt;/h3&gt;

&lt;p&gt;Our processing algorithm is optimised to be highly robust and handle large variations in data quality that is expected from bookings on the Grab platform. There are many reported methods for processing mobile data to reorientate telematics data for four wheel vehicles&lt;sup id=&quot;fnref:2&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:2&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;sup id=&quot;fnref:3&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:3&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;

&lt;p&gt;However, with the prevalent use of motorcycles on our platform, especially for delivery verticals, we observed that data collected from two wheel vehicles tend to be noisier due to differences in phone stability and vehicular vibrations. Data noise can be exacerbated if partners hold the phone in their hand or place it in their pockets while driving.&lt;/p&gt;

&lt;p&gt;In addition, we also expect a wide variation in data quality and sensor availability from different phone models, such as older, low-end models to the newest, flagship models. A good example to illustrate the robustness of our algorithm is having different strategies to handle different degrees of data noise. For example, a simple low-pass filter is used for low noise data, while more complex variational decomposition and Kalman filter approaches are used for high noise data.&lt;/p&gt;

&lt;h3 id=&quot;detecting-behaviour-anomalies-with-thresholds&quot;&gt;Detecting behaviour anomalies with thresholds&lt;/h3&gt;

&lt;p&gt;Once the vehicular accelerations are inferred, we can use a thresholding approach (see Figure 2) to detect unsafe driving instances.&lt;/p&gt;

&lt;p&gt;For unsafe acceleration and braking, a peak finding algorithm is used to detect acceleration peaks beyond a threshold in the longitudinal (forward/backward) direction. For unsafe cornering, older and lower end phones are usually not equipped with gyroscope sensors, so we should look for peaks of lateral (sidewards) acceleration (which constitutes the centripetal acceleration during the turn) beyond a threshold. GPS bearing data that coarsely measures the orientation of the vehicle is then used to confirm that a cornering and not lane change instance is being detected. The thresholds selected are fine-tuned on Grab’s data using initial values based on published literature&lt;sup id=&quot;fnref:4&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:4&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;4&lt;/a&gt;&lt;/sup&gt; and other sources.&lt;/p&gt;

&lt;p&gt;To reduce false positive detection, no unsafe driving instances will be flagged when:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Large discrepancies are observed between speeds derived from integrating the longitudinal (forward/backward) acceleration and speeds directly measured by the GPS sensor.&lt;/li&gt;
  &lt;li&gt;Large phone motions are detected. For example, when the phone falls to the seat from the dashboard, accelerations recorded on the phone sensor will deviate significantly from the vehicle accelerations.&lt;/li&gt;
  &lt;li&gt;GPS speed is very low before and after the unsafe driving instance is detected. This is limited to data collected from motorcycles which is usually used by delivery partners. It implies that the partner is walking and not in a vehicle. For example, a GrabFood delivery partner may be collecting the food from the merchant partner on foot, so no unsafe driving instances should be detected.&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/using-mobile-sensor-data-to-encourage-safer-driving/image2.gif&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;
  &lt;figcaption align=&quot;middle&quot;&gt;Figure 2: Animation showing unsafe driving detection by thresholding. Dotted lines in acceleration charts indicate selected thresholds. Map tiles by stamen design.&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;h2 id=&quot;detecting-speeding-instances-from-gps-speeds-and-map-data&quot;&gt;Detecting speeding instances from GPS speeds and map data&lt;/h2&gt;

&lt;p&gt;To define speeding along a stretch of road, we used a rule-based method by comparing raw speeds from GPS pings with speeding thresholds for that road. Although GPS speeds are generally accurate (subjected to minimal GPS errors), we need to take more precautions to ensure the right speeding thresholds are determined.&lt;/p&gt;

&lt;p&gt;These thresholds are set using known speed limits from available map data or hourly aggregated speed statistics where speed limits are not available. The coverage and accuracy of known speed limits is continuously being improved by our in-house mapping initiatives and  validated comprehensively by the respective local ground teams in selected cities.&lt;/p&gt;

&lt;p&gt;Aggregating GPS pings from Grab driver and delivery partners can be a helpful proxy to actual speed limits by defining speeding violations as outliers from socially acceptable speeds derived from partners collectively. To reliably compute aggregated speed statistics, a representative speed profile for each stretch of road must first be inferred from raw GPS pings (see Figure 3).&lt;/p&gt;

&lt;p&gt;As ping sampling intervals are fixed, more pings tend to be recorded for slower speeds. To correct the bias in the speed profile, we reweigh ping counts by using speed values as weights. Furthermore, to minimise distortions in the speed profile from vehicles driving at lower-than-expected speeds due to high traffic volumes, only pings from free-flowing traffic are used when inferring the speed profile.&lt;/p&gt;

&lt;p&gt;Free-flowing traffic is defined by speeds higher than the median speed on each defined road category (e.g., small residential roads, normal primary roads, large expressways). To ensure extremely high speeds are flagged regardless of the speed of other drivers, maximum threshold values for aggregated speeds are set for each road category using heuristics based on the maximum known speed limit of that road category.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/using-mobile-sensor-data-to-encourage-safer-driving/image4.png&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;
  &lt;figcaption align=&quot;middle&quot;&gt;Figure 3: Steps to infer a representative speed profile for computing aggregated speed statistics.&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;Besides a representative speed profile, hourly aggregation should also include data from a sufficient number of unique drivers depending on speed variability. To obtain enough data, hourly aggregations are performed on the same day of the week over multiple weeks. This way, we have a comprehensive time-specific speed profile that accounts for traffic quality (e.g., peak hour traffic, traffic differences between weekdays/weekends) and driving conditions (e.g., visibility difference between day/night).&lt;/p&gt;

&lt;p&gt;When detecting speeding violations, the GPS pings used are snapped-to-road and stationary pings, pings with unrealistic speeds, while pings with low GPS accuracy (e.g., when the vehicle is in a tunnel) are excluded. A speeding violation is defined as a sequence of consecutive GPS pings that exceed the speeding threshold. The following checks were put in place to minimise erroneous flagging of speeding violations:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Removal of duplicated (or stale) GPS pings.&lt;/li&gt;
  &lt;li&gt;Sufficient speed buffer given to take into account GPS errors.&lt;/li&gt;
  &lt;li&gt;Sustained speeding for a prolonged period of time is required to exclude transient speeding events (e.g., during lane change).&lt;/li&gt;
&lt;/ol&gt;

&lt;h1 id=&quot;driving-safety-report&quot;&gt;Driving safety report&lt;/h1&gt;

&lt;p&gt;The driving safety report is a platform safety product that driver and delivery partners can access via their driver profile page on the Grab Driver Application (see Figure 4). It is updated daily and aims to create awareness regarding driving habits by summarising key information from the processed data into a personalised report that can be easily consumed.&lt;/p&gt;

&lt;p&gt;Individual reports of each driving manoeuvre (e.g., braking, acceleration, cornering and speeding) are available for daily and weekly views. Partners can also get more detailed information of each individual instance such as when these unsafe driving instances were detected.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/using-mobile-sensor-data-to-encourage-safer-driving/image5.png&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;
  &lt;figcaption align=&quot;middle&quot;&gt;Figure 4: Driving safety report for driver and delivery partners using four wheel vehicles. a) Actionable insights feature circled by red dotted lines. b) Daily view of various unsafe driving instances where more details of each instance can be viewed by tapping on “See details”.&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;h2 id=&quot;actionable-insights&quot;&gt;Actionable insights&lt;/h2&gt;

&lt;p&gt;Besides compiling the instances of unsafe driving in a report to create awareness, we are also using these data to provide some actionable recommendations for our partners to improve their driving.&lt;/p&gt;

&lt;p&gt;With unsafe driving feedback from consumers and reported road traffic accident data from our platform, we also train machine learning models to identify patterns in the detected unsafe driving instances and estimate the likelihood of partners receiving unsafe driving feedback or getting into accidents. One use case is to compute a safe driving score that equates a four-wheel partner’s driving behaviour to a numerical value where a higher score indicates a safer driver.&lt;/p&gt;

&lt;p&gt;Additionally, we use Shapley additive explanation (SHAP) approaches to determine which driving manoeuvre contributes the most to increasing the likelihood of partners receiving unsafe driving feedback or getting into accidents. This information is included as an actionable insight in the driving safety report and helps partners to identify the key area to improve their driving.&lt;/p&gt;

&lt;h1 id=&quot;whats-next&quot;&gt;What’s next?&lt;/h1&gt;

&lt;p&gt;At the moment, Grab performs telematics processing and unsafe driving detections after the trip and updates the report the next day. One of the biggest improvements would be to share this information with partners faster. We are actively working on developing a real-time processing algorithm that addresses this and also, satisfies the robustness requirements such that partners are immediately aware after an unsafe driving instance is detected.&lt;/p&gt;

&lt;p&gt;Besides detecting typical unsafe driving manoeuvres, we are also exploring other use cases for mobile sensor data in road safety such as detection of poor road conditions, counterflow driving against traffic, and phone usage leading to distracted driving.&lt;/p&gt;

&lt;h1 id=&quot;join-us&quot;&gt;Join us&lt;/h1&gt;

&lt;p&gt;Grab is the leading superapp platform in Southeast Asia, providing everyday services that matter to consumers. More than just a ride-hailing and food delivery app, Grab offers a wide range of on-demand services in the region, including mobility, food, package and grocery delivery services, mobile payments, and financial services across 428 cities in eight countries.&lt;/p&gt;

&lt;p&gt;Powered by technology and driven by heart, our mission is to drive Southeast Asia forward by creating economic empowerment for everyone. If this mission speaks to you, &lt;a href=&quot;https://grab.careers/&quot;&gt;join our team&lt;/a&gt; today!&lt;/p&gt;

&lt;h1 id=&quot;references&quot;&gt;References&lt;/h1&gt;

&lt;div class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;Burhan, W. (2022). How telematics helps Grab to improve safety. Grab Tech Blog. https://engineering.grab.com/telematics-at-grab &lt;a href=&quot;#fnref:1&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:2&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;Mohan, P., Padmanabhan, V.N. and Ramjee, R. (2008).Nericell: rich monitoring of road and traffic conditions using mobile smartphones. SenSys ‘08: Proceedings of the 6th ACM conference on Embedded network sensor systems, 312-336. https://doi.org/10.1145/1460412.1460444 &lt;a href=&quot;#fnref:2&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:3&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;Sentiance (2016). Driving behavior modeling using smart phone sensor data. Sentiance Blog. https://sentiance.com/2016/02/11/driving-behavior-modeling-using-smart-phone-sensor-data/ &lt;a href=&quot;#fnref:3&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:4&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;Yarlagadda, J. and Pawar, D.S. (2022). Heterogeneity in the Driver Behavior: An Exploratory Study Using Real-Time Driving Data. Journal of Advanced Transportation. vol. 2022, Article ID 4509071. https://doi.org/10.1155/2022/4509071 &lt;a href=&quot;#fnref:4&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</description>
        <pubDate>Tue, 25 Oct 2022 11:30:00 +0000</pubDate>
        <link>https://engineering.grab.com/using-mobile-sensor-data-to-encourage-safer-driving</link>
        <guid isPermaLink="true">https://engineering.grab.com/using-mobile-sensor-data-to-encourage-safer-driving</guid>
        
        <category>Analytics</category>
        
        <category>Driving patterns</category>
        
        <category>Data Science</category>
        
        <category>GPS</category>
        
        <category>Security</category>
        
        
        <category>Engineering</category>
        
        <category>Data Science</category>
        
        <category>Security</category>
        
      </item>
    
      <item>
        <title>Automatic rule backtesting with large quantities of data</title>
        <description>&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;

&lt;p&gt;Analysts need to analyse and simulate a rule on historical data to check the performance and accuracy of the rule. Backtesting enables analysts to run simulations of the rules and manage the results from the rule engine UI.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Backtesting&lt;/strong&gt; helps analysts to:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Define the desired impact of the rule for our business and users.&lt;/li&gt;
  &lt;li&gt;Evaluate the accuracy of the rule based on historical data.&lt;/li&gt;
  &lt;li&gt;Compare and analyse results with data points, such as known false positives, user segments, risk profile of a user or transaction, and so on.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Currently, the analytics process to test performance of a rule is not standardised, and is inaccurate and inefficient. Analysts from different teams have different approaches:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Offline process using Presto tables. This process is lengthy and inaccurate.&lt;/li&gt;
  &lt;li&gt;Offline process based on the rule engine payload. The setup takes time, and the process is not streamlined.&lt;/li&gt;
  &lt;li&gt;Running rules in shadow mode. This process takes days to get the desired result.&lt;/li&gt;
  &lt;li&gt;A team in Grab uses different rule engines to manage rules and do backtesting. This doubles the effort for analysts and engineers.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;In our vision for backtesting, it should allow analysts to:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Efficiently run and manage their jobs.&lt;/li&gt;
  &lt;li&gt;Create custom metrics, reports and dimensions for backtesting.&lt;/li&gt;
  &lt;li&gt;Add external data points and metrics to do a deep dive.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;For the purpose of establishing a minimum viable product (MVP), backtesting will support basic capabilities and enable analysts to access required metrics and data points. Thus, analysts can:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Run backtesting jobs from the rule engine UI.&lt;/li&gt;
  &lt;li&gt;Get fixed reports and dimensions for every checkpoint.&lt;/li&gt;
  &lt;li&gt;Get access to relevant data to analyse backtesting results.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;background&quot;&gt;Background&lt;/h2&gt;

&lt;p&gt;Assume a simple use case: &lt;strong&gt;A rule to detect the transaction risk.&lt;/strong&gt; &lt;/p&gt;

&lt;p&gt;Each transaction has a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;transaction_id&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user_id&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;currency&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;amount&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;timestamp&lt;/code&gt;. The rule engine also provides a &lt;em&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;treatment&lt;/code&gt;&lt;/em&gt; (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Approve&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Decline&lt;/code&gt;) based on the rule logic for the transaction.&lt;/p&gt;

&lt;p&gt;In this specific use case, we would like to see what will be the aggregation number of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;total transactions&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;total distinct users&lt;/code&gt;, and the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sum of the amount&lt;/code&gt;, based on the dimensions of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;date&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;treatment&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;and currency&lt;/code&gt; in the last couple of weeks.&lt;/p&gt;

&lt;p&gt;The result may look like the following data:&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Dimension    &lt;/th&gt;
      &lt;th&gt;Dimension    &lt;/th&gt;
      &lt;th&gt;Dimension    &lt;/th&gt;
      &lt;th&gt;metric      &lt;/th&gt;
      &lt;th&gt;metric          &lt;/th&gt;
      &lt;th&gt;metric     &lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Date&lt;/td&gt;
      &lt;td&gt;Treatment&lt;/td&gt;
      &lt;td&gt;Currency&lt;/td&gt;
      &lt;td&gt;Total tx&lt;/td&gt;
      &lt;td&gt;Distinct user    &lt;/td&gt;
      &lt;td&gt;Total amount&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2020-05-1&lt;/td&gt;
      &lt;td&gt;Approve&lt;/td&gt;
      &lt;td&gt;SGD&lt;/td&gt;
      &lt;td&gt;100&lt;/td&gt;
      &lt;td&gt;80&lt;/td&gt;
      &lt;td&gt;10020&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2020-05-1&lt;/td&gt;
      &lt;td&gt;Decline&lt;/td&gt;
      &lt;td&gt;SGD&lt;/td&gt;
      &lt;td&gt;50&lt;/td&gt;
      &lt;td&gt;40&lt;/td&gt;
      &lt;td&gt;450&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2020-05-1&lt;/td&gt;
      &lt;td&gt;Approve&lt;/td&gt;
      &lt;td&gt;MYR&lt;/td&gt;
      &lt;td&gt;110&lt;/td&gt;
      &lt;td&gt;100&lt;/td&gt;
      &lt;td&gt;1200&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2020-05-1&lt;/td&gt;
      &lt;td&gt;Decline&lt;/td&gt;
      &lt;td&gt;MYR&lt;/td&gt;
      &lt;td&gt;30&lt;/td&gt;
      &lt;td&gt;15&lt;/td&gt;
      &lt;td&gt;400&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;* This data does not reflect actual Grab data and is for illustrative purposes only.&lt;/p&gt;

&lt;h2 id=&quot;solution&quot;&gt;Solution&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;Use a cloud-agnostic Spark-based data pipeline to replay any existing or proposed rule to check performance.&lt;/li&gt;
  &lt;li&gt;Use a Web Portal to:
    &lt;ul&gt;
      &lt;li&gt;Create or select a rule to replay, with replay time range.&lt;/li&gt;
      &lt;li&gt;Display and download the result, such as total events and hit counts.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Replay any existing or proposed rule for checking performance.&lt;/li&gt;
  &lt;li&gt;Allow users to create or select a rule to replay in the rule engine UI, with provided replay time range.&lt;/li&gt;
  &lt;li&gt;Display the replay result in the rule engine UI, such as total events and hit counts.&lt;/li&gt;
  &lt;li&gt;Provide a way to download all testing results in the rule engine UI (for example, all rule responses).&lt;/li&gt;
  &lt;li&gt;Remove dependency on the specific cloud provider stack, so other teams in Grab can use it instead of Google Cloud Platform (GCP).&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;architecture-details&quot;&gt;Architecture details&lt;/h3&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/auto-rule-testing/image2.png&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;The rule editor UI reacts to the user input. Its engine sends a job command to the Amazon Simple Queue Service (SQS) to initialise the job. After that, the rule editor also performs the following processes in the background:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Lambda listens to the request SQS queue and invokes a job via the Spark jobs API.&lt;/li&gt;
  &lt;li&gt;The job fetches the executable artifacts, data source. After the job is completed, the job script saves the result sheet as required to S3.&lt;/li&gt;
  &lt;li&gt;The Spark script pushes the job final status (success, failure, timeout) through the shutdown hook to respond to the SQS queue.&lt;/li&gt;
  &lt;li&gt;The rule editor engine listens to response callback messages, and processes the job metadata to the database, or sends notifications.&lt;/li&gt;
  &lt;li&gt;The rule editor displays the job metadata on the UI.&lt;/li&gt;
  &lt;li&gt;The package pipeline builds and deploys the executable artifacts to S3 as a manageable structure.&lt;/li&gt;
  &lt;li&gt;The Spark script takes the filter logic as its input parameters.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;workflow&quot;&gt;Workflow&lt;/h3&gt;

&lt;h4 id=&quot;historical-data-preparation&quot;&gt;Historical data preparation&lt;/h4&gt;

&lt;p&gt;The historical events are published by the rule engine through Kafka, and stored into the S3 bucket based on time. The Backtesting system then fetches these data for testing based on the time range requested.&lt;/p&gt;

&lt;p&gt;By using a Kubernetes stream pipeline, we also save the trust inference stream to &lt;em&gt;Trust AWS subaccount&lt;/em&gt;. With the customer bucket and file format, we can improve the efficiency of the data processing, and also avoid any delay from the data lake.&lt;/p&gt;

&lt;h4 id=&quot;engineering-specifications&quot;&gt;Engineering specifications&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;Target location:&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    s3a://stg-trust-inference-event/&amp;lt;engine-name&amp;gt;/&amp;lt;predict-name&amp;gt;/&amp;lt;YYYY&amp;gt;/MM/DD/hh/mm/ss/&amp;lt;000001&amp;gt;.snappy.parquet
    s3a://prd-trust-inference-event/&amp;lt;engine-name&amp;gt;/&amp;lt;predict-name&amp;gt;/&amp;lt;YYYY&amp;gt;/MM/DD/hh/mm/ss/&amp;lt;000001&amp;gt;.snappy.parquet
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Description&lt;/strong&gt;: Following the fields of steam definition, the engine name would be &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ruleengine&lt;/code&gt;, or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;catwalk&lt;/code&gt;. The predict-name would be &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;preride&lt;/code&gt; (checkpoint name), or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cnpu&lt;/code&gt; (model name).&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;File Format: avro&lt;/li&gt;
  &lt;li&gt;File Compression: Snappy&lt;/li&gt;
  &lt;li&gt;There is no auto retention on sub-account S3. We will implement the archive process in the future. &lt;/li&gt;
  &lt;li&gt;The default pipeline and the new pipeline will run in parallel until the Data Engineering team is ready to retire the default pipeline.&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;backtesting&quot;&gt;Backtesting&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;Upon scheduling, the Backtesting Portal sends a message to SQS, which is then captured by the listening Lambda.&lt;/li&gt;
  &lt;li&gt;Lambda invokes a Spark job over the AWS elastic mapreduce engine (EMR).&lt;/li&gt;
  &lt;li&gt;The EMR engine fetches the executable artifacts containing the rule script and historical data from S3, and starts a Spark job to apply the rule script over historical data. Depending on the size of data, the Spark cluster will scale automatically to ensure timely completion.&lt;/li&gt;
  &lt;li&gt;Once completed, a report file is generated and available on Backtesting UI.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;ui&quot;&gt;UI&lt;/h3&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/auto-rule-testing/image1.gif&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;h2 id=&quot;learnings-and-conclusions&quot;&gt;Learnings and conclusions&lt;/h2&gt;

&lt;p&gt;After the release, here’s what our data analysers had to say:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;For trust analysts, testing a rule on historical data happens outside the rule engine UI and is not user-friendly, leading to analysts wasting significant time.&lt;/li&gt;
  &lt;li&gt;For financial analysts, as analysts migrate to the rule engine UI, the existing solution will be deprecated with no other solution.&lt;/li&gt;
  &lt;li&gt;An alternative to simulate a rule;  we no longer need to run a rule in shadow mode because we can use historical data to determine the outcome. This new approach saves us weeks of effort on the rule onboarding process.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;whats-next&quot;&gt;What’s next?&lt;/h2&gt;

&lt;p&gt;The underlying Spark jobs in this tool were developed by knowledgeable data engineers, which is a disadvantage because it requires a high level of expertise to modify the analytics. To mitigate this restriction, we are looking into using domain-specific language (DSL) to allow users to input desired attributes and dimensions, and provide the job release pipeline for self-serving jobs.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;small class=&quot;credits&quot;&gt;Thanks to Jia Long Loh for the support on the offline infrastructure engineering.&lt;/small&gt;&lt;/p&gt;

&lt;h1 id=&quot;join-us&quot;&gt;Join us&lt;/h1&gt;
&lt;p&gt;Grab is the leading superapp platform in Southeast Asia, providing everyday services that matter to consumers. More than just a ride-hailing and food delivery app, Grab offers a wide range of on-demand services in the region, including mobility, food, package and grocery delivery services, mobile payments, and financial services across 428 cities in eight countries.&lt;/p&gt;

&lt;p&gt;Powered by technology and driven by heart, our mission is to drive Southeast Asia forward by creating economic empowerment for everyone. If this mission speaks to you, &lt;a href=&quot;https://grab.careers/&quot;&gt;join our team&lt;/a&gt; today!&lt;/p&gt;
</description>
        <pubDate>Thu, 08 Sep 2022 00:55:55 +0000</pubDate>
        <link>https://engineering.grab.com/automatic-rule-backtesting</link>
        <guid isPermaLink="true">https://engineering.grab.com/automatic-rule-backtesting</guid>
        
        <category>Testing</category>
        
        <category>Automation</category>
        
        <category>Backtesting</category>
        
        <category>Data science</category>
        
        
        <category>Engineering</category>
        
        <category>Data Science</category>
        
      </item>
    
      <item>
        <title>How we store and process millions of orders daily</title>
        <description>&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;In the real world, after a passenger places a GrabFood order from the Grab App, the merchant-partner will prepare the order. A driver-partner will then collect the food and deliver it to the passenger. Have you ever wondered what happens in the backend system? The Grab Order Platform is a distributed system that processes millions of GrabFood or GrabMart orders every day. This post aims to share the journey of how we designed the database solution that powers the order platform.&lt;/p&gt;

&lt;h1 id=&quot;background&quot;&gt;Background&lt;/h1&gt;

&lt;p&gt;What are the design goals when building the database solution? We collected the requirements by analysing query patterns and traffic patterns.&lt;/p&gt;

&lt;h3 id=&quot;query-patterns&quot;&gt;Query patterns&lt;/h3&gt;

&lt;p&gt;Here are some important query examples that the Order Platform supports:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;Write queries:&lt;/p&gt;

    &lt;p&gt;a.  Create an order.&lt;/p&gt;

    &lt;p&gt;b.  Update an order.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Read queries:&lt;/p&gt;

    &lt;p&gt;a.  Get order by id.&lt;/p&gt;

    &lt;p&gt;b.  Get ongoing orders by passenger id.&lt;/p&gt;

    &lt;p&gt;c.  Get historical orders by various conditions.&lt;/p&gt;

    &lt;p&gt;d.  Get order statistics (for example, get the number of orders)&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;We can break down queries into two categories: transactional queries and analytical queries. Transactional queries are critical to online order creation and completion, including the write queries and read queries such as 2a or 2b. Analytical queries like 2c and 2d retrieves historical orders or order statistics on demand. Analytical queries are not essential to the oncall order processing.&lt;/p&gt;

&lt;h3 id=&quot;traffic-patterns&quot;&gt;Traffic patterns&lt;/h3&gt;

&lt;p&gt;Grab’s Order Platform processes a significant amount of transaction data every month.&lt;/p&gt;

&lt;p&gt;During peak hours, the write Queries per Second (QPS) is three times of primary key reads; whilst the range Queries per Second are four times of the primary key reads.&lt;/p&gt;

&lt;h3 id=&quot;design-goals&quot;&gt;Design goals&lt;/h3&gt;

&lt;p&gt;From the query and traffic patterns, we arrived at the following three design goals:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;Stability&lt;/strong&gt; - the database solution must be able to handle high read and write QPS. Online order processing queries must have high availability. Even when some part of the system is down, we must be able to provide a degraded experience to the end users allowing them to still be able to create and complete an order.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Scalability and cost&lt;/strong&gt; - the database solution must be able to support fast evolution of business requirements, given now we handle up to a million orders per month. The solution must also be cost effective at a large scale.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Consistency&lt;/strong&gt; - strong consistency for transactional queries, and eventually consistency for analytical queries.&lt;/li&gt;
&lt;/ol&gt;

&lt;h1 id=&quot;solution&quot;&gt;Solution&lt;/h1&gt;

&lt;p&gt;The first design principle towards a stable and scalable database solution is to use different databases to serve transactional and analytical queries, also known as OLTP and OLAP queries. An OLTP database serves queries critical to online order processing. This table keeps data for only a short period of time. Meanwhile, an OLAP database has the same set of data, but serves our historical and statistical queries. This database keeps data for a longer time.&lt;/p&gt;

&lt;p&gt;What are the benefits from this design principle? From a stability point of view, we can choose different databases which can better fulfil our different query patterns and QPS requirements. An OLTP database is the single source of truth for online order processing; any failure in the OLAP database will not affect online transactions. From a scalability and cost point of view, we can choose a flexible database for OLAP to support our fast evolution of business requirements. We can maintain less data in our OLTP database while keeping some older data in our OLAP database.&lt;/p&gt;

&lt;p&gt;To ensure that the data in both databases are consistent, we introduced the second design principle - data ingestion pipeline. In Figure 1, Order Platform writes data to the OLTP database to process online orders and asynchronously pushes the data into the data ingestion pipeline. The data ingestion pipeline ensures that the OLAP database data is eventually consistent.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/how-we-store-millions-orders/image3.png&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Figure 1: Order Platform database solution overview&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;h2 id=&quot;architecture-details&quot;&gt;Architecture details&lt;/h2&gt;

&lt;h3 id=&quot;oltp-database&quot;&gt;OLTP database&lt;/h3&gt;

&lt;p&gt;There are two categories of OLTP queries, the key-value queries (for example, load by order id) and the batch queries (for example, Get ongoing orders by passenger id). We use DynamoDB as the database to support these OLTP queries.&lt;/p&gt;

&lt;p&gt;Why DynamoDB?&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Scalable and highly available: the tables of DynamoDB are partitioned and each partition is three-way replicated.&lt;/li&gt;
  &lt;li&gt;Support for strong consistent reads by primary key.&lt;/li&gt;
  &lt;li&gt;DynamoDB has a mechanism called adaptive capacity to handle hotkey traffic. Internally, DynamoDB will distribute higher capacity to high-traffic partitions, and isolate frequently accessed items to a dedicated partition. This way, the hotkey can utilise the full capacity of an entire partition, which is up to 3000 read capacity units and 1000 write capacity units.&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/how-we-store-millions-orders/image2.png&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Figure 2: DynamoDB table structure overview. Source:  &lt;a href=&quot;#aws&quot;&gt;Amazon Web Services (2019, 28 April)&lt;/a&gt;&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;In each DynamoDB table, it has many items with attributes. In each item, it has a partition key and sort key. The partition key is used for key-value queries, and the sort key is used for range queries. In our case, the table contains multiple order items. The partition key is order ID. We can easily support key-value queries by the partition key.&lt;/p&gt;

&lt;table class=&quot;table&quot;&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;order_id (PK)&lt;/th&gt;
      &lt;th&gt;state&lt;/th&gt;
      &lt;th&gt;pax_id&lt;/th&gt;
      &lt;th&gt;created_at&lt;/th&gt;
      &lt;th&gt;pax_id_gsi&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;order1&lt;/td&gt;
      &lt;td&gt;Ongoing&lt;/td&gt;
      &lt;td&gt;Alice&lt;/td&gt;
      &lt;td&gt;9:00am&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;order2&lt;/td&gt;
      &lt;td&gt;Ongoing&lt;/td&gt;
      &lt;td&gt;Alice&lt;/td&gt;
      &lt;td&gt;9:30am&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;order3&lt;/td&gt;
      &lt;td&gt;Completed&lt;/td&gt;
      &lt;td&gt;Alice&lt;/td&gt;
      &lt;td&gt;8:30am&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Batch queries like ‘Get ongoing orders by passenger id’ are supported by DynamoDB Global Secondary Index (GSI). A GSI is like a normal DynamoDB table, which also has keys and attributes.&lt;/p&gt;

&lt;p&gt;In our case, we have a GSI table where the partition key is the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pax_id_gsi&lt;/code&gt;. The attribute &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pax_id_gsi&lt;/code&gt; is linked to the main table. It is eventually consistent with the main table that is maintained by DynamoDB. If the Order Platform queries ongoing orders for Alice, two items will be returned from the GSI table.&lt;/p&gt;

&lt;table class=&quot;table&quot;&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;pax_id_gsi (PK)&lt;/th&gt;
      &lt;th&gt;created_at (SK)&lt;/th&gt;
      &lt;th&gt;order_id&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Alice&lt;/td&gt;
      &lt;td&gt;9:00am&lt;/td&gt;
      &lt;td&gt;order1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Alice&lt;/td&gt;
      &lt;td&gt;9:30am&lt;/td&gt;
      &lt;td&gt;order2&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;We also make use of an advanced feature of GSI named sparse index to support ongoing order queries. When we update order status from ongoing to completed, at the same time, we set the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pax_id_gsi&lt;/code&gt; to empty, so that the linked item in the GSI will be automatically deleted by DynamoDB. At any time, the GSI table only stores the ongoing orders. We use a sparse index mechanism to control our table size for better performance and to be more cost effective.&lt;/p&gt;

&lt;p&gt;The next problem is data retention. This is achieved with the DynamoDB Time To Live (TTL) feature. DynamoDB will auto-scan expired items and delete them. But the challenge is when we add TTL to big tables, it will bring a heavy load to the background scanner and might result in an outage. Our solution is to only add a TTL attribute to the new items in the table. Then, we manually delete the items without TTL attributes, and run a script to delete items with TTL attributes that are too old. After this process, the table size will be quite small, so we can enable the TTL feature on the TTL attribute that we previously added without any concern. The retention period of our DynamoDB data is three months.&lt;/p&gt;

&lt;p&gt;Costwise, DynamoDB is charged by storage size and the provision of the read write capability. The provision capability is actually auto scalable. The cost is on-demand. So it’s generally cheaper than RDS.&lt;/p&gt;

&lt;h3 id=&quot;olap-database&quot;&gt;OLAP database&lt;/h3&gt;

&lt;p&gt;We use MySQL RDS as the database to support historical and statistical OLAP queries.&lt;/p&gt;

&lt;p&gt;Why not Aurora? We choose RDS mainly because it is a mature database solution. Even if Aurora can provide better high-availability, RDS is enough to support our less critical use cases. Costwise, Aurora charges by data storage and the number of requested Input/Output Operations per Second (IOPS). RDS charges only by data storage. As we are using General Purpose (SSD) storage, IOPS is free and supports up to 16k IOPS.&lt;/p&gt;

&lt;p&gt;We use MySQL partitioning for data retention. The order table is partitioned by creation time monthly. Since the data access pattern is mostly by month, the partition key can reduce cross-partition queries. Partitions older than six months are dropped at the beginning of each month.&lt;/p&gt;

&lt;h3 id=&quot;data-ingestion-pipeline&quot;&gt;Data ingestion pipeline&lt;/h3&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/how-we-store-millions-orders/image1.png&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Figure 3: Data Ingestion Pipeline Architecture.&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;A Kafka stream is used to process data in the data ingestion pipeline. We choose the Kafka stream, because it has 99.95% SLA. It is not restricted by the OLTP and OLAP database types.&lt;/p&gt;

&lt;p&gt;Even if Kafka can provide 99.95% SLA, there is still the chance of stream producer failures. When the producer fails, we will store the message in an Amazon Simple Queue Service (SQS) and retry. If the retry also fails, it will be moved to the SQS dead letter queue (DLQ), to be consumed at a later time.&lt;/p&gt;

&lt;p&gt;On the stream consumer side, we use back-off retry at both stream and database levels to ensure consistency. In a worst-case scenario, we can rewind the stream events from Kafka.&lt;/p&gt;

&lt;p&gt;It is important for the data ingestion pipeline to handle duplicate messages and out-of-order messages.&lt;/p&gt;

&lt;p&gt;Duplicate messages are handled by the database level unique key (for example, order ID + creation time).&lt;/p&gt;

&lt;p&gt;For the out-of-order messages, we implemented the following two mechanisms:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Version update: we only update the most recently updated data. The precision of the update time is in microseconds, which is enough for most of the use cases.&lt;/li&gt;
  &lt;li&gt;Upsert: if the update events occur before the create events, we simulate an upsert operation.&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;impact&quot;&gt;Impact&lt;/h2&gt;

&lt;p&gt;After launching our solution this year, we have saved significantly on cloud costs. In the earlier solution, Order Platform synchronously writes to DynamoDB and Aurora and the data is kept forever.&lt;/p&gt;

&lt;h1 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h1&gt;

&lt;p&gt;In terms of stability, we use DynamoDB as the critical OLTP database to ensure high availability for online order processing. Scalability wise, we use RDS as the OLAP database to support our quickly evolving business requirements by using a rich, multiple index. Cost efficiency is achieved by data retention in both databases. For consistency, we built a single source of truth OLTP database and an OLAP database that is eventually consistent with the help of the data ingestion pipeline.&lt;/p&gt;

&lt;h1 id=&quot;whats-next&quot;&gt;What’s next?&lt;/h1&gt;

&lt;p&gt;Currently, the database solution is running on the production environment. Even though the database solution is proven to be stable, scalable and consistent, we still see some potential areas of improvement.&lt;/p&gt;

&lt;p&gt;We use MySQL RDS for OLAP data storage. Even though MySQL is stable and cost effective, it is difficult to serve more complicated queries like free text search. Hence, we plan to explore other NoSQL databases like ElasticSearch.&lt;/p&gt;

&lt;p&gt;We hope this post helps you understand how we store Grab orders and fulfil the queries from the Grab Order Platform.&lt;/p&gt;

&lt;h1 id=&quot;references&quot;&gt;References&lt;/h1&gt;

&lt;!-- Figure 2, DynamoDB overview is taken from [Getting Started with Amazon DynamoDB](https://www.slideshare.net/AmazonWebServices/getting-started-with-amazon-dynamodb-63948367), authored by Amazon Web Services. --&gt;

&lt;p&gt;&lt;a id=&quot;aws&quot;&gt;Amazon Web Services. (2019, 28 April) &lt;em&gt;Build with DynamoDB: S1 E1 – Intro to Amazon DynamoDB&lt;/em&gt; [Video]. &lt;a href=&quot;https://youtu.be/W3S1OnDqWl4?t=455&quot;&gt;YouTube&lt;/a&gt;.&lt;/a&gt;&lt;/p&gt;

&lt;h1 id=&quot;join-us&quot;&gt;Join us&lt;/h1&gt;
&lt;p&gt;Grab is the leading superapp platform in Southeast Asia, providing everyday services that matter to consumers. More than just a ride-hailing and food delivery app, Grab offers a wide range of on-demand services in the region, including mobility, food, package and grocery delivery services, mobile payments, and financial services across 428 cities in eight countries.&lt;/p&gt;

&lt;p&gt;Powered by technology and driven by heart, our mission is to drive Southeast Asia forward by creating economic empowerment for everyone. If this mission speaks to you, &lt;a href=&quot;https://grab.careers/&quot;&gt;join our team&lt;/a&gt; today!&lt;/p&gt;
</description>
        <pubDate>Mon, 15 Aug 2022 00:55:55 +0000</pubDate>
        <link>https://engineering.grab.com/how-we-store-millions-orders</link>
        <guid isPermaLink="true">https://engineering.grab.com/how-we-store-millions-orders</guid>
        
        <category>Database</category>
        
        <category>Storage</category>
        
        <category>Distributed Systems</category>
        
        <category>Platform</category>
        
        
        <category>Engineering</category>
        
        <category>Data Science</category>
        
      </item>
    
      <item>
        <title>How we automated FAQ responses at Grab</title>
        <description>&lt;h2 id=&quot;overview-and-initial-analysis&quot;&gt;Overview and initial analysis&lt;/h2&gt;

&lt;p&gt;Knowledge management is often one of the biggest challenges most companies face internally. Teams spend several working hours trying to either inefficiently look for information or constantly asking colleagues about information already documented somewhere. A lot of time is spent on the internal employee communication channels (in our case, Slack) simply trying to figure out answers to repetitive questions. On our journey to automate the responses to these repetitive questions, we needed first to figure out exactly how much time and effort is spent by on-call engineers answering such repetitive questions.&lt;/p&gt;

&lt;p&gt;We soon identified that many of the internal engineering tools’ on-call activities involve answering users’ (internal users) questions on various Slack channels. Many of these questions have already been asked or documented on the wiki. These inquiries hinder on-call engineers’ productivity and affect their ability to focus on operational tasks. Once we figured out that on-call employees spend a lot of time answering Slack queries, we decided on a journey to determine the top questions.&lt;/p&gt;

&lt;p&gt;We considered smaller groups of teams for this study and found out that:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;The topmost user queries are “How do I do ABC?” or “Is XYZ broken?”.&lt;/li&gt;
  &lt;li&gt;The second most commonly asked questions revolve around access requests, approvals, or other permissions. The answer to such questions is often URLs to existing documentation.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;These findings informed us that we didn’t just need an artificial intelligence (AI) based autoresponder to repetitive questions. We must, in fact, also leverage these channels’ chat histories to identify patterns.&lt;/p&gt;

&lt;h2 id=&quot;gathering-user-votes-for-shortlisted-vendors&quot;&gt;Gathering user votes for shortlisted vendors&lt;/h2&gt;

&lt;p&gt;In light of saving costs and time and considering the quality of existing solutions already available in the market, we decided not to reinvent the wheel and instead purchase an existing product. And to figure out which product to purchase, we needed to do a comparative analysis. And thus began our vendor comparison journey!&lt;/p&gt;

&lt;p&gt;While comparing the feature sets offered by different vendors, we understood that our users need to play a part in this decision-making process. However, sharing our vendor analysis with our users and allowing them to choose the bot of their choice posed several challenges:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Users could be biased towards known bots (from previous experiences).&lt;/li&gt;
  &lt;li&gt;Users could be biased towards big brands with a preconceived notion that big brands mean better features and better user support.&lt;/li&gt;
  &lt;li&gt;Users may likely pick the most expensive vendor, assuming that a higher cost means higher efficiency.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;To ensure that we receive unbiased feedback, here’s how we opened users up to voting. We highlighted the top features of each vendor’s bot compared to other shortlisted bots. We hid the names of the bots to avoid brand attraction. At a high level, here’s what the categorisation looked like:&lt;/p&gt;

&lt;table border=&quot;1&quot; style=&quot;text-align:center;&quot;&gt;
  &lt;tr&gt;
    &lt;td&gt;&lt;strong&gt;Features&lt;/strong&gt;&lt;/td&gt;
    &lt;td&gt;&lt;strong&gt;Vendor 1 (name  hidden)&lt;/strong&gt;&lt;/td&gt;
    &lt;td&gt;&lt;strong&gt;Vendor 2 (name  hidden)&lt;/strong&gt;&lt;/td&gt;
    &lt;td&gt;&lt;strong&gt;Vendor 3 (name  hidden)&lt;/strong&gt;&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;Enables crowdsourcing, everyone is incentivised to participate. &lt;br /&gt; Participants/SME names are visible. &lt;br /&gt; Everyone can access the web UI and see how the responses configured on the bot.&lt;/td&gt;
    &lt;td&gt;&lt;img src=&quot;/img/automated-faq/image1.png&quot; alt=&quot;&quot; style=&quot;width:10%&quot; /&gt; &lt;img src=&quot;/img/automated-faq/image1.png&quot; alt=&quot;&quot; style=&quot;width:10%&quot; /&gt; &lt;img src=&quot;/img/automated-faq/image1.png&quot; alt=&quot;&quot; style=&quot;width:10%&quot; /&gt;&lt;/td&gt;
    &lt;td&gt;-&lt;/td&gt;
    &lt;td&gt;-&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;Lowers discussions on channels by providing easy ways to raise tickets to the team instead of discussing on Slack.&lt;/td&gt;
    &lt;td&gt;-&lt;/td&gt;
    &lt;td&gt;&lt;img src=&quot;/img/automated-faq/image1.png&quot; alt=&quot;&quot; style=&quot;width:10%&quot; /&gt; &lt;/td&gt;
    &lt;td&gt;&lt;img src=&quot;/img/automated-faq/image1.png&quot; alt=&quot;&quot; style=&quot;width:10%&quot; /&gt; &lt;img src=&quot;/img/automated-faq/image1.png&quot; alt=&quot;&quot; style=&quot;width:10%&quot; /&gt; &lt;img src=&quot;/img/automated-faq/image1.png&quot; alt=&quot;&quot; style=&quot;width:10%&quot; /&gt;&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;Only a specific set of admins (or oncall engineers) feed and maintain the bot thus ensuring information authenticity and reliability.&lt;/td&gt;
    &lt;td&gt;&lt;img src=&quot;/img/automated-faq/image1.png&quot; alt=&quot;&quot; style=&quot;width:10%&quot; /&gt; &lt;/td&gt;
    &lt;td&gt;&lt;img src=&quot;/img/automated-faq/image1.png&quot; alt=&quot;&quot; style=&quot;width:10%&quot; /&gt; &lt;img src=&quot;/img/automated-faq/image1.png&quot; alt=&quot;&quot; style=&quot;width:10%&quot; /&gt; &lt;img src=&quot;/img/automated-faq/image1.png&quot; alt=&quot;&quot; style=&quot;width:10%&quot; /&gt;&lt;/td&gt;
    &lt;td&gt;&lt;img src=&quot;/img/automated-faq/image1.png&quot; alt=&quot;&quot; style=&quot;width:10%&quot; /&gt; &lt;img src=&quot;/img/automated-faq/image1.png&quot; alt=&quot;&quot; style=&quot;width:10%&quot; /&gt;&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;Easy bot feeding mechanism/web UI to update FAQs.&lt;/td&gt;
    &lt;td&gt;&lt;img src=&quot;/img/automated-faq/image1.png&quot; alt=&quot;&quot; style=&quot;width:10%&quot; /&gt; &lt;img src=&quot;/img/automated-faq/image1.png&quot; alt=&quot;&quot; style=&quot;width:10%&quot; /&gt; &lt;img src=&quot;/img/automated-faq/image1.png&quot; alt=&quot;&quot; style=&quot;width:10%&quot; /&gt;&lt;/td&gt;
    &lt;td&gt;-&lt;/td&gt;
    &lt;td&gt;&lt;img src=&quot;/img/automated-faq/image1.png&quot; alt=&quot;&quot; style=&quot;width:10%&quot; /&gt; &lt;img src=&quot;/img/automated-faq/image1.png&quot; alt=&quot;&quot; style=&quot;width:10%&quot; /&gt;&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;Superior natural language processing capabilities.&lt;/td&gt;
    &lt;td&gt;&lt;img src=&quot;/img/automated-faq/image1.png&quot; alt=&quot;&quot; style=&quot;width:10%&quot; /&gt; &lt;img src=&quot;/img/automated-faq/image1.png&quot; alt=&quot;&quot; style=&quot;width:10%&quot; /&gt;&lt;/td&gt;
    &lt;td&gt;&lt;img src=&quot;/img/automated-faq/image1.png&quot; alt=&quot;&quot; style=&quot;width:10%&quot; /&gt; &lt;img src=&quot;/img/automated-faq/image1.png&quot; alt=&quot;&quot; style=&quot;width:10%&quot; /&gt; &lt;img src=&quot;/img/automated-faq/image1.png&quot; alt=&quot;&quot; style=&quot;width:10%&quot; /&gt;&lt;/td&gt;
    &lt;td&gt;-&lt;/td&gt;    
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;Please vote&lt;/td&gt;
    &lt;td&gt;Vendor 1&lt;/td&gt;
    &lt;td&gt;Vendor 2&lt;/td&gt;
    &lt;td&gt;Vendor 3&lt;/td&gt;    
  &lt;/tr&gt;
&lt;/table&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;Although none of the options had all the features our users wanted, &lt;strong&gt;&lt;em&gt;about 60% chose Vendor 1 (&lt;a href=&quot;https://onebar.io/&quot;&gt;OneBar&lt;/a&gt;)&lt;/em&gt;&lt;/strong&gt;. From this, we discovered the core features that our users needed while keeping them involved in the decision-making process.&lt;/p&gt;

&lt;h3 id=&quot;matching-our-requirements-with-available-vendors-feature-sets&quot;&gt;Matching our requirements with available vendors’ feature sets&lt;/h3&gt;

&lt;p&gt;Although our users made their preferences clear, we still needed to ensure that the feature sets available in the market suited our internal requirements in terms of the setup and the features available in portals that we envisioned replacing. As part of our requirements gathering process, here are some of the critical conditions that became more and more prominent:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;An ability to crowdsource Slack discussions/conclusions and save them directly from Slack (preferably with a single command).&lt;/li&gt;
  &lt;li&gt;An ability to auto-respond to Slack queries without calling the bot manually.&lt;/li&gt;
  &lt;li&gt;The bot must be able to respond to queries only on the preconfigured Slack channel (not a Slack-wide auto-responder that is already available).&lt;/li&gt;
  &lt;li&gt;Ability to auto-detect frequently asked questions on the channels would mean less work for platform engineers to feed the bot manually and periodically.&lt;/li&gt;
  &lt;li&gt;A trusted and secured data storage setup and a responsive customer support team.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;proof-of-concept&quot;&gt;Proof of concept&lt;/h2&gt;

&lt;p&gt;We considered several tools (including some of the tools used by our HR for auto-answering employee questions). We then decided to do a complete proof of concept (POC) with OneBar to check if it fulfils our internal requirements.&lt;/p&gt;

&lt;p&gt;These were the phases in which we conducted the POC for the shortlisted vendor (OneBar):&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Phase 1&lt;/strong&gt;: Study the traffic, see what insights OneBar shows and what it could/should potentially show. Then think about how an ideal oncall or support should behave in such an environment. i.e. we could identify specific messages in history and describe what should’ve happened to each one of them.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Phase 2&lt;/strong&gt;: Create required records in OneBar and configure it to match the desired behaviour as closely as possible.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Phase 3&lt;/strong&gt;: Let the tool run for a couple of weeks and then evaluate how well it responds to questions, how often people search directly, how much information they add, etc. Onebar adds all these metrics in the app making it easier to monitor activity.&lt;/p&gt;

&lt;p&gt;In addition to the Onebar POC, we investigated other solutions and did a thorough vendor comparison and analysis. After running the POC and investigating other vendors, we decided to use OneBar as its features best meet our needs.&lt;/p&gt;

&lt;h3 id=&quot;prioritising-slack-channels&quot;&gt;Prioritising Slack channels&lt;/h3&gt;

&lt;p&gt;While we had multiple Slack channels that we’d love to have enabled the shortlisted bot on, our initial contract limited our use of the bot to only 20 channels. We could not use OneBar to auto-scan more than 20 Slack channels.&lt;/p&gt;

&lt;p&gt;Users could still chat directly with the bot to get answers to FAQs based on what was fed to the bot’s knowledge base (KB). They could also access the web login, which displays its KB, other valuable features, and additional features for admins/experts.&lt;/p&gt;

&lt;p&gt;Slack channels that we enabled the licensed features on were prioritised based on:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Most messages sent on the channel per month, i.e. most active channels.&lt;/li&gt;
  &lt;li&gt;Most members impacted, i.e. channels with a large member count.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;To do this, we used Slack analytics reports and identified the channels that fit our prioritisation criteria.&lt;/p&gt;

&lt;h3 id=&quot;change-is-difficult-but-often-essential&quot;&gt;Change is difficult but often essential&lt;/h3&gt;

&lt;p&gt;Once we’d onboarded the vendor, we began training and educating employees on using this new Knowledge Management system for all their FAQs. It was a challenge as change is always complex but essential for growth.&lt;/p&gt;

&lt;p&gt;A series of tech talks and training conducted across the company and at more minor scales also helped guide users about the bot’s features and capabilities.&lt;/p&gt;

&lt;p&gt;At the start, we suffered from a lack of data resulting in incorrect responses from the bot. But as the team became increasingly aware of the features and learned more about its capabilities, the bot’s number of KB items grew, resulting in a much more efficient experience. It took us around one quarter to feed the bot consistently to see accurate and frequent responses from it.&lt;/p&gt;

&lt;h2 id=&quot;crowdsourcing-our-internal-glossary&quot;&gt;Crowdsourcing our internal glossary&lt;/h2&gt;

&lt;p&gt;With an increasing number of acronyms and company-specific words emerging each year, the number of acronyms and company-specific abbreviations that new joiners face is immense.&lt;/p&gt;

&lt;p&gt;We solved this issue by using the bot’s channel-specific KB feature. We created a specific Slack channel dedicated to storing and retrieving definitions of acronyms and other words. This solution turned out to be a big hit with our users.&lt;/p&gt;

&lt;p&gt;And who fed the bot with the terms and glossary items? Who better than our onboarding employees to train the bot to help other onboarders. A targeted campaign dedicated to feeding the bot excited many of our onboarders. They began to play around with the bot’s features and provide it with as many glossary items as possible, thus winning swags!&lt;/p&gt;

&lt;p&gt;In a matter of weeks, the user base grew from a couple of hundred to around 3000. This effort was also called out in one of our company-wide All Hands meetings, a big win for our team!&lt;/p&gt;

&lt;h1 id=&quot;join-us&quot;&gt;Join us&lt;/h1&gt;
&lt;p&gt;Grab is the leading superapp platform in Southeast Asia, providing everyday services that matter to consumers. More than just a ride-hailing and food delivery app, Grab offers a wide range of on-demand services in the region, including mobility, food, package and grocery delivery services, mobile payments, and financial services across 428 cities in eight countries.&lt;/p&gt;

&lt;p&gt;Powered by technology and driven by heart, our mission is to drive Southeast Asia forward by creating economic empowerment for everyone. If this mission speaks to you, &lt;a href=&quot;https://grab.careers/&quot;&gt;join our team&lt;/a&gt; today!&lt;/p&gt;
</description>
        <pubDate>Wed, 13 Jul 2022 00:20:55 +0000</pubDate>
        <link>https://engineering.grab.com/automated-faq</link>
        <guid isPermaLink="true">https://engineering.grab.com/automated-faq</guid>
        
        <category>Automation</category>
        
        <category>Knowledge management</category>
        
        <category>Productivity</category>
        
        
        <category>Engineering</category>
        
      </item>
    
      <item>
        <title>Graph Networks - 10X investigation with Graph Visualisations</title>
        <description>&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;

&lt;p&gt;Detecting fraud schemes used to require investigations using large amounts and varying types of data that come from many different anti-fraud systems. Investigators then need to combine the different types of data and use statistical methods to uncover suspicious claims, which is time consuming and inefficient in most cases.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/graph-visualisation/image1.png&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;We are always looking for ways to improve fraud investigation methods and stay one step ahead of our ever-growing fraudsters. In the &lt;a href=&quot;/graph-networks&quot;&gt;introductory blog&lt;/a&gt; and &lt;a href=&quot;/graph-concepts&quot;&gt;graph concepts&lt;/a&gt; articles of this series, we’ve covered experimenting with a set of Graph Network technologies, including Graph Visualisation, and the basics of graph concepts.&lt;/p&gt;

&lt;p&gt;In this post, we will introduce our Graph Visualisation Platform and briefly illustrate how it makes fraud investigations easier and more effective.&lt;/p&gt;

&lt;h2 id=&quot;why-visualise-a-graph&quot;&gt;Why visualise a graph?&lt;/h2&gt;

&lt;p&gt;If you’re a fan of crime shows, you would have come across scenes like a detective putting together evidence, such as pictures, notes and articles, on a board and connecting them with thumb tacks and yarn. When you look at the board, it’s easy to see the relationships between the different pieces of evidence. That’s what graphs do, especially in fraud detection.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/graph-visualisation/image6.png&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;In the same way, while graph data is the raw material of an investigation, some of the most interesting relationships are often inferred rather than modelled directly in the data. Visualising these relationships can give a unique “big picture” of the data that is difficult or impossible to obtain with traditional relational tables and business intelligence tools.&lt;/p&gt;

&lt;p&gt;On the other hand, graph visualisation enhances the quick identification of relationships and significant structures because it is an intuitive way to help detect patterns. Plus, the human brain processes visual information much faster; that’s where our Graph Visualisation platform comes in.&lt;/p&gt;

&lt;h2 id=&quot;what-is-the-graph-visualisation-platform&quot;&gt;What is the Graph Visualisation platform?&lt;/h2&gt;

&lt;p&gt;Graph Visualisation platform is a full-featured investigation platform that can reveal hidden connections and context in data by transforming raw records into highly visual and interactive maps. From there, investigators can grab any data point and quickly see relationships, patterns, and anomalies, and if necessary, drill down to investigate further.&lt;/p&gt;

&lt;p&gt;This is all done without writing a manual query, switching between anti-fraud systems, or having to think about data science! These are some of the interactions on the platform that easily make anomalies or relevant patterns stand out.&lt;/p&gt;

&lt;h3 id=&quot;expanding-the-data&quot;&gt;Expanding the data&lt;/h3&gt;

&lt;p&gt;To date, we have over three billion nodes and edges in our storage system. It is not possible (nor necessary) to show all of the data at once. The platform allows the user to grab any data point and easily expand to view the relationships.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/graph-visualisation/expand-data.gif&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;h3 id=&quot;timeline-tracking-and-history-replay&quot;&gt;Timeline tracking and history replay&lt;/h3&gt;

&lt;p&gt;The Graph Visualisation platform’s interactive time filter lets you see temporal relationships within your data and clearly reveals the chronological progression of events. You can start with a specific time of interest, track everything that happens after, then quickly focus on the time and relationships that matter most.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/graph-visualisation/data-replay.gif&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;h2 id=&quot;10x-investigations&quot;&gt;10X investigations&lt;/h2&gt;

&lt;p&gt;Here are a few examples of how the Graph Visualisation platform facilitates fraud investigations.&lt;/p&gt;

&lt;h3 id=&quot;appeal-confirmation&quot;&gt;Appeal confirmation&lt;/h3&gt;

&lt;p&gt;The following image shows the difference between a true fraudster and a falsely identified one. On the left, we have a Grab rental corporate account that was falsely detected by a fraud rule. Upon review, we discovered that there is no suspicious connection to this account, thus the account got unblocked.&lt;/p&gt;

&lt;p&gt;On the right, we have a passenger that was blocked by the system and they appealed. Investigations showed that the passenger is, in fact, part of an extremely dense device-sharing network, so we maintained our decision to block.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/graph-visualisation/image5.png&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;h3 id=&quot;modus-operandi-discovery&quot;&gt;Modus operandi discovery&lt;/h3&gt;

&lt;h4 id=&quot;passenger-sharing-device&quot;&gt;Passenger sharing device&lt;/h4&gt;

&lt;p&gt;Fraudsters tend to share physical resources to maximise their revenue. With our Graph Visualisation platform, you can see exactly how this pattern looks like. The image below shows a device that is shared by a lot of fraudsters.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/graph-visualisation/image4.png&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;h4 id=&quot;anti-money-laundering-aml&quot;&gt;Anti-money laundering (AML)&lt;/h4&gt;

&lt;p&gt;On the left, we see a pattern of healthy spending on Grab. However, on the right, we can see that passengers are highly connected, and it has frequent large amount transfers to other payment providers.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/graph-visualisation/image2.png&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;h2 id=&quot;closing-thoughts&quot;&gt;Closing thoughts&lt;/h2&gt;

&lt;p&gt;Graph Visualisation is an intuitive way to investigate suspicious connections and potential patterns of crime. Investigators can directly interact with any data point to get the details they need and literally view the relationships in the data to make fast, accurate, and defensible decisions.&lt;/p&gt;

&lt;p&gt;While fraud detection is a good use case for Graph Visualisation, it’s not the only possibility. Graph Visualisation can help make anything more efficient and intelligent, especially if you have highly connected data.&lt;/p&gt;

&lt;h2 id=&quot;speak-to-us&quot;&gt;Speak to us&lt;/h2&gt;
&lt;p&gt;GrabDefence is a proprietary fraud prevention platform built by Grab, Southeast Asia’s leading superapp. Since 2019, the GrabDefence team has shared its fraud management capabilities and platform with enterprises and startups to leverage Grab’s advanced AI/ML models, hyper local insights and patented device intelligence technologies.&lt;/p&gt;

&lt;p&gt;To learn more about GrabDefence or to speak to our fraud management experts, contact us at &lt;a href=&quot;mailto:gd.contact@grabtaxi.com&quot;&gt;gd.contact@grabtaxi.com&lt;/a&gt;.&lt;/p&gt;

&lt;h1 id=&quot;join-us&quot;&gt;Join us&lt;/h1&gt;
&lt;p&gt;Grab is the leading superapp platform in Southeast Asia, providing everyday services that matter to consumers. More than just a ride-hailing and food delivery app, Grab offers a wide range of on-demand services in the region, including mobility, food, package and grocery delivery services, mobile payments, and financial services across 428 cities in eight countries.&lt;/p&gt;

&lt;p&gt;Powered by technology and driven by heart, our mission is to drive Southeast Asia forward by creating economic empowerment for everyone. If this mission speaks to you, &lt;a href=&quot;https://grab.careers/&quot;&gt;join our team&lt;/a&gt; today!&lt;/p&gt;
</description>
        <pubDate>Thu, 30 Jun 2022 00:20:55 +0000</pubDate>
        <link>https://engineering.grab.com/graph-visualisation</link>
        <guid isPermaLink="true">https://engineering.grab.com/graph-visualisation</guid>
        
        <category>Security</category>
        
        <category>Graphs concepts</category>
        
        <category>Graph technology</category>
        
        <category>Graph visualisation</category>
        
        
        <category>Engineering</category>
        
        <category>Security</category>
        
        <category>Data Science</category>
        
      </item>
    
  </channel>
</rss>
