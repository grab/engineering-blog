<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Grab Tech</title>
    <description>Grab's Engineering team solves critical transportation challenges and makes transport freedom a reality for 620 million people in Southeast Asia.
</description>
    <link>https://engineering.grab.com/</link>
    <atom:link href="https://engineering.grab.com/feed.xml" rel="self" type="application/rss+xml" />
    <pubDate>Tue, 21 Mar 2023 09:20:26 +0000</pubDate>
    <lastBuildDate>Tue, 21 Mar 2023 09:20:26 +0000</lastBuildDate>
    <generator>Jekyll v4.2.0</generator>
    
      <item>
        <title>Determine the best technology stack for your web-based projects</title>
        <description>&lt;p&gt;In the current technology landscape, startups are developing rapidly. This usually leads to an increase in the number of engineers in teams, with the goal of increasing the speed of product development and delivery frequency. However, this growth often leads to a diverse selection of technology stacks being used by different teams within the same organisation.&lt;/p&gt;

&lt;p&gt;Having different technology stacks within a team could lead to a bigger problem in the future, especially if documentation is not well-maintained. The best course of action is to pick just one technology stack for your projects, but it begs the question, &lt;strong&gt;“How do I choose the best technology stack for my projects?”&lt;/strong&gt;. &lt;/p&gt;

&lt;p&gt;We share our process and analysis to determine the best technology stack that complies with precise standards. By the end of the article, you may also learn to choose the best technology stack for your needs.&lt;/p&gt;

&lt;h2 id=&quot;background&quot;&gt;Background&lt;/h2&gt;

&lt;p&gt;In recent years, we have seen massive growth in modern web technologies, such as React, Angular, Vue, Svelte, Django, TypeScript, and many more. Each technology has its benefits. However, having so many choices can be confusing when you must determine which technologies are best for your projects. To narrow down the choices, a few aspects, such as scalability, stability, and usage in the market, must be considered.&lt;/p&gt;

&lt;p&gt;That’s the problem that we used to face. Most of our legacy services were not standardised and were written in different languages like PHP, React, and Vue. Also, the documentation for these legacy services is not well-structured or regularly updated.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/determining-tech-stack/image1.png&quot; alt=&quot;&quot; style=&quot;width:60%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Current technology stack usage in OVO&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;We realised that we had &lt;strong&gt;two&lt;/strong&gt; main problems:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Various technology stacks&lt;/strong&gt; (PHP, Vue, React, Nuxt, and Go) maintained simultaneously, with incomplete documentation, may consume a lot of time to understand the code, especially for engineers unfamiliar with the frameworks or even a new hire.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Context switching&lt;/strong&gt; when reviewing code makes it hard to review other teammates’ merge requests on complex projects and quickly offer better code suggestions.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;To prevent these problems from recurring, teams must use &lt;strong&gt;one primary technology stack&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;After detailed comparisons, we narrowed our choices to &lt;strong&gt;two&lt;/strong&gt; options – React and Vue – because we have developed projects in both technologies and already have the user interface (UI) library in each technology stack.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/determining-tech-stack/image4.png&quot; alt=&quot;&quot; style=&quot;width:60%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Taken from &lt;a href=&quot;https://www.ulam.io/blog/react-vs-vue-framework-comparison&quot;&gt;ulam.io&lt;/a&gt;&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;Next, we conducted a more detailed research and exploration for each technology. The main goals were to find the unique features, scalability, ease of migration, and compatibility for the UI library for React and Vue. To test the compatibility of each UI library, we also used a sample UI on one of our upcoming projects and sliced it.&lt;/p&gt;

&lt;p&gt;Here’s a quick summary of our exploration:&lt;/p&gt;

&lt;table border=&quot;1&quot;&gt;
&lt;tr&gt;
  &lt;th style=&quot;padding: 20px&quot;&gt;Metrics&lt;/th&gt;
  &lt;th style=&quot;padding: 20px&quot;&gt;Vue&lt;/th&gt;
  &lt;th style=&quot;padding: 20px&quot;&gt;React&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
  &lt;td style=&quot;padding: 20px&quot;&gt;UI Library Compatibility&lt;/td&gt;
  &lt;td style=&quot;padding: 20px&quot;&gt;Doesn’t require much component development&lt;/td&gt;
  &lt;td style=&quot;padding: 20px&quot;&gt;Doesn’t require much component development&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
  &lt;td style=&quot;padding: 20px&quot;&gt;Scalability&lt;/td&gt;
  &lt;td style=&quot;padding: 20px&quot;&gt;Easier to upgrade, slower in releasing major updates, clear migration guide&lt;/td&gt;
  &lt;td style=&quot;padding: 20px&quot;&gt;Quicker release of major versions, supports gradual updates&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
  &lt;td style=&quot;padding: 20px&quot;&gt;Others&lt;/td&gt;
  &lt;td style=&quot;padding: 20px&quot;&gt;Composition API, strong community (&lt;a href=&quot;https://vue-community.org/&quot;&gt;Vue Community&lt;/a&gt;)&lt;/td&gt;
  &lt;td style=&quot;padding: 20px&quot;&gt;Latest version (v18) of React Hooks, gradual updates, doesn’t support IE&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;

&lt;p&gt;&lt;br /&gt;
From this table, we found that the differences between these frameworks are miniscule, making it tough for us to determine which to use. Ultimately, we decided to step back and see the &lt;strong&gt;Big Why&lt;/strong&gt;. &lt;/p&gt;

&lt;h2 id=&quot;solution&quot;&gt;Solution&lt;/h2&gt;

&lt;p&gt;The Big Why here was “Why do we need to standardise our technology stack?”. We wanted to ease the onboarding process for new hires and reduce the complexity, like context switching, during code reviews, which ultimately saves time.&lt;/p&gt;

&lt;p&gt;As Kleppmann (2017) states, &lt;em&gt;“The majority of the cost of software is in its ongoing maintenance”&lt;/em&gt;. In this case, the biggest cost was time. Increasing the ease of maintenance would reduce the cost, so we decided to use maintainability as our north star metric.&lt;/p&gt;

&lt;p&gt;Kleppmann (2017) also highlighted &lt;strong&gt;three design principles&lt;/strong&gt; in any software system:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;em&gt;Operability&lt;/em&gt;: Make it easy to keep the system running.&lt;/li&gt;
  &lt;li&gt;&lt;em&gt;Simplicity&lt;/em&gt;: Easy for new engineers to understand the system by minimising complexity.&lt;/li&gt;
  &lt;li&gt;&lt;em&gt;Evolvability&lt;/em&gt;: Make it easy for engineers to make changes to the system in the future.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Keeping these design principles in mind, we defined &lt;strong&gt;three metrics&lt;/strong&gt; that our selected tech stack must achieve:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;em&gt;Scalability&lt;/em&gt;
    &lt;ul&gt;
      &lt;li&gt;Keeping software and platforms up to date&lt;/li&gt;
      &lt;li&gt;Anticipating possible future problems&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;em&gt;Stability of the library and documentation&lt;/em&gt;
    &lt;ul&gt;
      &lt;li&gt;Establishing good practices and tools for development&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;em&gt;Usage in the market&lt;/em&gt;
    &lt;ul&gt;
      &lt;li&gt;The popularity of the library or framework and variety of coding best practices&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;
&lt;table border=&quot;1&quot;&gt;
  &lt;tr&gt;
    &lt;th style=&quot;padding: 20px&quot;&gt;Metrics&lt;/th&gt;
    &lt;th style=&quot;padding: 20px&quot;&gt;Vue&lt;/th&gt;
    &lt;th style=&quot;padding: 20px&quot;&gt;React&lt;/th&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td style=&quot;padding: 10px&quot;&gt;Scalability&lt;/td&gt;
    &lt;td style=&quot;padding: 10px&quot;&gt;&lt;strong&gt;Framework&lt;/strong&gt;&lt;br /&gt;&lt;br /&gt;&lt;strong&gt;Operability&lt;/strong&gt;&lt;br /&gt;Easier to update because there aren’t many approaches to writing Vue.&lt;br /&gt;&lt;br /&gt;&lt;strong&gt;Evolvability&lt;/strong&gt;&lt;br /&gt;Since Vue is a framework, it needs fewer steps to upgrade.&lt;/td&gt;
    &lt;td style=&quot;padding: 10px&quot;&gt;&lt;strong&gt;Library&lt;/strong&gt;&lt;br /&gt;Supports gradual updates but there will be many different approaches when upgrading React on our services.&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td style=&quot;padding: 10px&quot;&gt;Stability of the library and documentation&lt;/td&gt;
    &lt;td style=&quot;padding: 10px&quot;&gt;Has standardised documentation&lt;/td&gt;
    &lt;td style=&quot;padding: 10px&quot;&gt;Has many versions of documentation&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td style=&quot;padding: 10px&quot;&gt;Usage on Market&lt;/td&gt;
    &lt;td style=&quot;padding: 10px&quot;&gt;Smaller market share.&lt;br /&gt;&lt;br /&gt;&lt;strong&gt;Simplicity&lt;/strong&gt;&lt;br /&gt;We can reduce complexity for new hires, as the Vue standard in OVO remains consistent with standards in other companies.&lt;/td&gt;
    &lt;td style=&quot;padding: 10px&quot;&gt;Larger &lt;a href=&quot;https://www.statista.com/statistics/1124699/worldwide-developer-survey-most-used-frameworks-web/&quot;&gt;market share&lt;/a&gt;.&lt;br /&gt;&lt;br /&gt;    Many React variants are currently in the market, so different companies may have different folder structures/conventions.&lt;/td&gt;
  &lt;/tr&gt;
  &lt;/table&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/determining-tech-stack/image3.png&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Screenshot taken from &lt;a href=&quot;https://www.statista.com/&quot;&gt;https://www.statista.com/&lt;/a&gt; on 2022-10-13&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;After conducting a detailed comparison between Vue and React, we decided to use Vue as our primary tech stack as it best aligns with Kleppmann’s three design principles and our north star metric of maintainability. Even though we noticed a few disadvantages to using Vue, such as smaller market share, we found that Vue is still the better option as it complies with all our metrics.&lt;/p&gt;

&lt;p&gt;Moving forward, we will only use one tech stack across our projects but we decided not to migrate technology for existing projects. This allows us to continue &lt;strong&gt;exploring&lt;/strong&gt; and &lt;strong&gt;learning&lt;/strong&gt; about other technologies’ developments. One of the things we need to do is ensure that our current projects are kept up-to-date.&lt;/p&gt;

&lt;h3 id=&quot;implementation&quot;&gt;Implementation&lt;/h3&gt;

&lt;p&gt;After deciding on the primary technology stack, we had to do the following:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Define a boilerplate for future Vue projects, which will include items like a &lt;strong&gt;general library or dependencies&lt;/strong&gt;, &lt;strong&gt;implementation for unit testing&lt;/strong&gt;, and &lt;strong&gt;folder structure&lt;/strong&gt;, to align with our north star metric.&lt;/li&gt;
  &lt;li&gt;Update our existing &lt;strong&gt;UI library&lt;/strong&gt; with new components and the latest Vue version.&lt;/li&gt;
  &lt;li&gt;Perform periodic upgrades to existing React services and create a standardised code structure with proper documentation.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;With these practices in place, we can ensure that future projects will be standardised, making them easier for engineers to maintain.&lt;/p&gt;

&lt;h3 id=&quot;impact&quot;&gt;Impact&lt;/h3&gt;

&lt;p&gt;There are a few key benefits of standardising our technology stack.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Scalability and maintainability&lt;/strong&gt;: It’s much easier to scale and maintain projects using the same technology stack. For example, when implementing security patches on all projects due to certain vulnerabilities in the system or libraries, we will need one patch for each technology. With only one stack, we only need to implement one patch across all projects, saving a lot of time.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Faster onboarding process&lt;/strong&gt;: The onboarding process is simplified for new hires because we have standardisation between all services, which will minimise the amount of context switching and lower the learning curve.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Faster deliveries&lt;/strong&gt;: When it’s easier to implement a change, there’s a compounding impact where the delivery process is shortened and release to production is quicker. Ultimately, faster deliveries of a new product or feature will help increase revenue.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;learningsconclusion&quot;&gt;Learnings/Conclusion&lt;/h2&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/determining-tech-stack/image2.jpg&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;For every big decision, it is important to take a step back and understand the Big Why or the main motivation behind it, in order to remain objective. That’s why after we identified maintainability as our north star metric, it was easier to narrow down the choices and make detailed comparisons.&lt;/p&gt;

&lt;p&gt;The north star metric, or deciding factor, might differ vastly, but it depends on the problems you are trying to solve.&lt;/p&gt;

&lt;h2 id=&quot;references&quot;&gt;References&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;Kleppmann, M. (2017). Designing Data-Intensive Applications. Beijing: O’Reilly. ISBN: 978-1-4493-7332-0&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.statista.com/statistics/1124699/worldwide-developer-survey-most-used-frameworks-web/&quot;&gt;Most used web frameworks 2022 - Statista&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;join-us&quot;&gt;Join us&lt;/h1&gt;

&lt;p&gt;Grab is the leading superapp platform in Southeast Asia, providing everyday services that matter to consumers. More than just a ride-hailing and food delivery app, Grab offers a wide range of on-demand services in the region, including mobility, food, package and grocery delivery services, mobile payments, and financial services across 428 cities in eight countries.&lt;/p&gt;

&lt;p&gt;Powered by technology and driven by heart, our mission is to drive Southeast Asia forward by creating economic empowerment for everyone. If this mission speaks to you, &lt;a href=&quot;https://grab.careers/&quot;&gt;join our team&lt;/a&gt; today!&lt;/p&gt;
</description>
        <pubDate>Tue, 21 Mar 2023 01:23:05 +0000</pubDate>
        <link>https://engineering.grab.com/determining-tech-stack</link>
        <guid isPermaLink="true">https://engineering.grab.com/determining-tech-stack</guid>
        
        <category>Engineering</category>
        
        <category>Technology stack</category>
        
        <category>Exploration</category>
        
        
        <category>Engineering</category>
        
        <category>Design</category>
        
      </item>
    
      <item>
        <title>Migrating from Role to Attribute-based Access Control</title>
        <description>&lt;p&gt;Grab has always regarded security as one of our top priorities; this is especially important for data platform teams. We need to control access to data and resources in order to protect our consumers and ensure compliance with various, continuously evolving security standards.&lt;/p&gt;

&lt;p&gt;Additionally, we want to keep the process convenient, simple, and easily scalable for teams. However, as Grab continues to grow, we have more services and resources to manage and it becomes increasingly difficult to keep the process frictionless. That’s why we decided to move from Role-Based Access Control (RBAC) to Attribute-Based Access Control (ABAC) for our Kafka Control Plane (KCP).&lt;/p&gt;

&lt;p&gt;In this article, you will learn how Grab’s streaming data platform team (Coban) deleted manual role and permission management of hundreds of roles and resources, and reduced operational overhead of requesting or approving permissions to zero by moving from RBAC to ABAC.&lt;/p&gt;

&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;

&lt;p&gt;Kafka is widely used across Grab teams as a streaming platform. For decentralised Kafka resource (e.g. topic) management, teams have the right to create, update, or delete based on their needs. As the data platform team, we implemented a KCP to ensure that these operations are only performed by authorised parties, especially on multi-tenant Kafka clusters.&lt;/p&gt;

&lt;p&gt;For internal access management, Grab uses its own Identity and Access Management (IAM) service, based on RBAC, to support authentication and authorisation processes:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Authentication&lt;/strong&gt; verifies the identity of a user or service, for example, if the provided token is valid or expired.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Authorisation&lt;/strong&gt; determines their access rights, for example, whether users can only update and/or delete their own Kafka topics.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;In RBAC, roles, permissions, actions, resources, and the relationships between them need to be defined in the IAM service. They are used to determine whether a user can access a certain resource.&lt;/p&gt;

&lt;p&gt;In the following example, we can see how IAM concepts come together. The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Coban engineer&lt;/code&gt; role belongs to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Engineering-coban&lt;/code&gt; group and has permission to update the topic’s retention. Any engineer added to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Engineering-coban&lt;/code&gt; group will also be able to update the topic’s retention.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/migrating-to-abac/image5.png&quot; alt=&quot;&quot; style=&quot;width:60%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;Following the same concept, each team using the KCP has its own roles, permissions, and resources created in the system. However, there are some disadvantages to this approach:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;It leads to a significant growth in the number of access control artifacts both platform and user teams need to manage, and increased time and effort to debug access control issues. We start off by finding which group the engineer belongs to and locating the group that should be used for KCP, and then trace to role and permissions.&lt;/li&gt;
  &lt;li&gt;All group membership access requests of new joiners need to be reviewed and approved by their direct managers. This leads to a lot of backlog as new joiners might have multiple groups to join and managers might not be able to review them timely. In some cases, roles need to be re-applied or renewed every 90 days, which further adds to the delay.&lt;/li&gt;
  &lt;li&gt;Group memberships are not updated to reflect active members in the team, leaving some engineers with access they don’t need and others with access they should have but don’t.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;solution&quot;&gt;Solution&lt;/h2&gt;

&lt;p&gt;With ABAC, access management becomes a lot easier. Any new joiner to a specific team gets the same access rights as everyone on that team – no need for manual approval from a manager. However, for ABAC to work, we need these components in place:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;User attributes: Who is the subject (actor) of a request?&lt;/li&gt;
  &lt;li&gt;Resource attributes: Which object (resource) does the actor want to deal with?&lt;/li&gt;
  &lt;li&gt;Evaluation engine: How do we decide if the actor is allowed to perform the action on the resource?&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;User attributes&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;All users have certain attributes depending on the department or team they belong to. This data is then stored and synced automatically with the human resource management system (HRMS) tool, which acts as a source of truth for Grab-wide data, every time a user switches teams, roles, or leaves the company.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Resource attributes&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Resource provisioning is an authenticated operation. This means that KCP knows who sent the requests and what each request/action is about. Similarly, resource attributes can be derived from their creators. For new resource provisioning, it is possible to capture the resource tags and store them after authentication. For existing resources, a major challenge was the need to backfill the tagging and ensure a seamless transition from the user’s perspective. In the past, all resource provisioning operations were done by a centralised platform team and most of the existing resource attributes are still under platform team’s ownership.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Evaluation engine&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;We chose to use &lt;a href=&quot;https://www.openpolicyagent.org/&quot;&gt;Open Policy Agent&lt;/a&gt; (OPA) as our policy evaluation engine mainly for its wide community support, applicable feature set, and extensibility to other tools and platforms in our system. This is also currently used by our team for &lt;a href=&quot;/zero-trust-with-kafka&quot;&gt;Kafka authorisation&lt;/a&gt;. The policies are written in &lt;a href=&quot;https://www.openpolicyagent.org/docs/latest/policy-language/&quot;&gt;Rego&lt;/a&gt;, the default language supported by OPA.&lt;/p&gt;

&lt;h2 id=&quot;architectureand-implementation&quot;&gt;Architecture and implementation&lt;/h2&gt;

&lt;p&gt;With ABAC, the access control process looks like this:&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/migrating-to-abac/image6.png&quot; alt=&quot;&quot; style=&quot;width:60%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;h4 id=&quot;user-attributes&quot;&gt;User attributes&lt;/h4&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/migrating-to-abac/image4.png&quot; alt=&quot;&quot; style=&quot;width:60%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;Authentication is handled by the IAM service. In the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/generate_token&lt;/code&gt; call, a user requests an authentication token from KCP before calling an authenticated endpoint. KCP then calls IAM to generate a token and returns it to the user.&lt;/p&gt;

&lt;p&gt;In the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/create_topic&lt;/code&gt; call, the user includes the generated token in the request header. KCP takes the token and verifies the token validity with IAM. User attributes are then extracted from the token payload for later use in request authorisation.&lt;/p&gt;

&lt;p&gt;Some of the common attributes we use for our policy are &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;user identifier&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;department code&lt;/code&gt;, and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;team code&lt;/code&gt;, which provide details like a user’s department and work scope.&lt;/p&gt;

&lt;p&gt;When it comes to data governance and central platform and identity teams, one of the major challenges was standardising the set of attributes to be used for clear and consistent ABAC policies across platforms so that their lifecycle and changes could be governed. This was an important shift in the mental model for attribute management over the RBAC model.&lt;/p&gt;

&lt;h4 id=&quot;resource-attributes&quot;&gt;Resource attributes&lt;/h4&gt;

&lt;p&gt;For newly created resources, attributes will be derived from user attributes that are captured during the authentication process.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/migrating-to-abac/image3.png&quot; alt=&quot;&quot; style=&quot;width:60%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;Previously with RBAC, existing resources did not have the required attributes. Since migrating to ABAC, the implementation has tagged newly created resources and ensured that their attributes are up to standard. IAM was also still doing the actual authorisation using RBAC.&lt;/p&gt;

&lt;p&gt;It is also important to note that we collaborated with data governance teams to backfill Kafka resource ownership. Having accurate ownership of resources like data lake or Kafka topics enabled us to move toward a self-service model and remove bottlenecks from centralised platform teams.&lt;/p&gt;

&lt;p&gt;After identifying most of the resource ownership, we started switching over to ABAC. The transition was smooth and had no impact on user experience. The remaining unidentified resources were tagged to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;lost-and-found&lt;/code&gt; and could be reclaimed by service teams when they needed permission to manage them.&lt;/p&gt;

&lt;h4 id=&quot;open-policy-agent&quot;&gt;Open Policy Agent&lt;/h4&gt;

&lt;p&gt;The most common question when implementing the policy is “how do you define ownership by attributes?”. With respect to the principle of least privilege, each policy must be sufficiently strict to limit access to only the relevant parties. In the end, we aligned as an organisation on defining ownership by department and team.&lt;/p&gt;

&lt;p&gt;We created a simple example below to demonstrate how to define a policy:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;package authz

import future.keywords

default allow = false

allow if {
        input.endpoint == &quot;updateTopic&quot;
        is_owner(input.resource_attributes)
}

is_owner(md) if {
        md.department == input.user_attributes.department
        md.team == input.user_attributes.team
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In this example, we start with denying access to everyone. If the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;updateTopic&lt;/code&gt; endpoint is called and the department and team attributes between user and resource are matched, access is allowed.&lt;/p&gt;

&lt;p&gt;With a similar scenario, we would need 1 role, 1 action, 1 resource, and 1 mapping (a.k.a permission) between action and resource. We will need to keep adding resources and permissions when we have new resources created. Compared to the policy above, no other changes are required.&lt;/p&gt;

&lt;p&gt;With ABAC, there are no further setup or access requests needed when a user changes teams. The user will be tagged to different attributes, automatically granted access to the new team’s resources, and excluded from the previous team’s resources.&lt;/p&gt;

&lt;p&gt;Another consideration we had was making sure that the policy is well-written and transparent in terms of change history. We decided to include this as part of our application code so every change is accounted for in the unit test and review process.&lt;/p&gt;

&lt;h4 id=&quot;authorisation&quot;&gt;Authorisation&lt;/h4&gt;

&lt;p&gt;The last part of the ABAC process is authorisation logic. We added the logic to the middleware so that we could make a call to OPA for authorisation.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/migrating-to-abac/image2.png&quot; alt=&quot;&quot; style=&quot;width:60%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;To ensure token validity after authentication, KCP extracts user attributes from the token payload and fetches resource attributes from the resource store. It combines the request metadata such as method and endpoint, along with the user and resource attributes into an OPA request. OPA then evaluates the request based on the redefined policy above and returns a response.&lt;/p&gt;

&lt;h2 id=&quot;auditability&quot;&gt;Auditability&lt;/h2&gt;

&lt;p&gt;For ABAC authorisation, there are two key areas of consideration:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Who made changes to the policy, who deployed, and when the change was made&lt;/li&gt;
  &lt;li&gt;Who accessed what resource and when&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;We manage policies in a dedicated GitLab repository and changes are submitted via merge requests. Based on the commit history, we can easily tell who made changes, reviewed, approved, and deployed the policy. &lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/migrating-to-abac/image1.png&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;For resource access, OPA produces a decision log containing user attributes, resource attributes, and the authorisation decision for every call it serves. The log is kept for five days in Kibana for debugging purposes, then moved to S3 where it is kept for 28 days.&lt;/p&gt;

&lt;h2 id=&quot;impact&quot;&gt;Impact&lt;/h2&gt;

&lt;p&gt;The move to ABAC authorisation has improved our controls as compared to the previous RBAC model, with the biggest impact being fewer resources to manage. Some other benefits include:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Optimised resource allocation: Discarded over 200 roles, 200 permissions, and almost 3000 unused resources from IAM services, simplifying our debugging process. Now, we can simply check the user and resource attributes as needed.&lt;/li&gt;
  &lt;li&gt;Simplified resource management: In the three months we have been using ABAC, about 600 resources have been added without any increase in complexity for authorisation, which is significantly lesser than the RBAC model.&lt;/li&gt;
  &lt;li&gt;Reduction in delays and waiting time: Engineers no longer have to wait for approval for KCP access.&lt;/li&gt;
  &lt;li&gt;Better governance over resource ownership and costs: ABAC allowed us to have a standardised and accurate tagging system of almost 3000 resources.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;learnings&quot;&gt;Learnings&lt;/h2&gt;

&lt;p&gt;Although ABAC does provide significant improvements over RBAC, it comes with its own caveats:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;It needs a reliable and comprehensive attribute tagging system to function properly. This only became possible after roughly three months of identifying and tagging the ownership of existing resources by both automated and manual methods.&lt;/li&gt;
  &lt;li&gt;Tags should be kept up to date with the company’s growth. Teams could lose access to their resources if they are wrongly tagged. It needs a mechanism to keep up with changes, or people will unexpectedly lose access when user and resource attributes are changed.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;whats-next&quot;&gt;What’s next?&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;To keep up with organisational growth, KCP needs to start listening to the IAM stream, which is where all IAM changes are published. This will allow KCP to regularly update user attributes and refresh resource attributes when restructuring occurs, allowing authorisation to be done with the right data.&lt;/li&gt;
  &lt;li&gt;Constant collaboration with HR to ensure that we maintain sufficient user attributes (no extra unused information) that remain clean so ABAC works as expected.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;references&quot;&gt;References&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.openpolicyagent.org/&quot;&gt;OPA&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.openpolicyagent.org/docs/latest/policy-language/&quot;&gt;Rego&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;/zero-trust-with-kafka&quot;&gt;Zero trust with Kafka&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;join-us&quot;&gt;Join us&lt;/h1&gt;

&lt;p&gt;Grab is the leading superapp platform in Southeast Asia, providing everyday services that matter to consumers. More than just a ride-hailing and food delivery app, Grab offers a wide range of on-demand services in the region, including mobility, food, package and grocery delivery services, mobile payments, and financial services across 428 cities in eight countries.&lt;/p&gt;

&lt;p&gt;Powered by technology and driven by heart, our mission is to drive Southeast Asia forward by creating economic empowerment for everyone. If this mission speaks to you, &lt;a href=&quot;https://grab.careers/&quot;&gt;join our team&lt;/a&gt; today!&lt;/p&gt;
</description>
        <pubDate>Thu, 09 Mar 2023 01:23:05 +0000</pubDate>
        <link>https://engineering.grab.com/migrating-to-abac</link>
        <guid isPermaLink="true">https://engineering.grab.com/migrating-to-abac</guid>
        
        <category>Engineering</category>
        
        <category>Access control</category>
        
        <category>Security</category>
        
        
        <category>Engineering</category>
        
        <category>Security</category>
        
      </item>
    
      <item>
        <title>Securing GitOps pipelines</title>
        <description>&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;

&lt;p&gt;Grab’s real-time data platform team, Coban, has been managing infrastructure resources via Infrastructure-as-code (IaC). Through the IaC approach, Terraform is used to maintain infrastructure consistency, automation, and ease of deployment of our streaming infrastructure, notably:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://flink.apache.org/&quot;&gt;Flink&lt;/a&gt; pipelines&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://kafka.apache.org/&quot;&gt;Kafka&lt;/a&gt; topics&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://docs.confluent.io/platform/current/connect/index.html#kafka-connect&quot;&gt;Kafka Connect&lt;/a&gt; connectors&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;With Grab’s exponential growth, there needs to be a better way to scale infrastructure automatically. Moving towards GitOps processes benefits us in many ways:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Versioned and immutable&lt;/strong&gt;: With our source code being stored in Git repositories, the desired state of infrastructure is stored in an environment that enforces immutability, versioning, and retention of version history, which helps with auditing and traceability.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Faster deployment&lt;/strong&gt;: By automating the process of deploying resources after code is merged, we eliminate manual steps and improve overall engineering productivity while maintaining consistency.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Easier rollbacks&lt;/strong&gt;: It’s as simple as making a revert for a Git commit as compared to creating a merge request (MR) and commenting Atlantis commands, which add extra steps and contribute to a higher mean-time-to-resolve (MTTR) for incidents.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;background&quot;&gt;Background&lt;/h2&gt;

&lt;p&gt;Originally, Coban implemented automation on Terraform resources using &lt;a href=&quot;https://www.runatlantis.io/&quot;&gt;Atlantis&lt;/a&gt;, an application that operates based on user comments on MRs.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/securing-gitops-pipeline/atlantis-user-flow.png&quot; alt=&quot;&quot; style=&quot;width:70%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;&lt;i&gt;Fig. 1 User flow with Atlantis&lt;/i&gt;&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;We have come a long way with Atlantis. It has helped us to automate our workflows and enable self-service capabilities for our engineers. However, there were a few limitations in our setup, which we wanted to improve:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Coarse grained&lt;/strong&gt;: There is no way to restrict the kind of Terraform resources users can create, which introduces security issues. For example, if a user is one of the &lt;a href=&quot;https://docs.gitlab.com/ee/user/project/code_owners.html&quot;&gt;Code owners&lt;/a&gt;, they can create another IAM role with Admin privileges with approval from their own team anywhere in the repository.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Limited automation&lt;/strong&gt;: Users are still required to make comments in their MR such as &lt;a href=&quot;https://www.runatlantis.io/docs/using-atlantis.html#atlantis-apply&quot;&gt;atlantis apply&lt;/a&gt;. This requires the learning of Atlantis commands and is prone to human errors.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Limited capability&lt;/strong&gt;: Having to rely entirely on Terraform and Hashicorp Configuration Language (HCL) functions to validate user input comes with limitations. For example, the ability to validate an input variable based on the value of another has been a &lt;a href=&quot;https://github.com/hashicorp/terraform/issues/25609&quot;&gt;requested feature&lt;/a&gt; for a long time.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Not adhering to Don’t Repeat Yourself (DRY) principle&lt;/strong&gt;: Users need to create an entire Terraform project with boilerplate codes such as Terraform environment, local variables, and Terraform provider configurations to create a simple resource such as a Kafka topic.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;solution&quot;&gt;Solution&lt;/h2&gt;

&lt;p&gt;We have developed an in-house GitOps solution named Khone. Its name was inspired by the &lt;a href=&quot;https://en.wikipedia.org/wiki/Khone_Phapheng_Falls&quot;&gt;Khone Phapheng Waterfall&lt;/a&gt;. We have evaluated some of the best and most widely used GitOps products available but chose not to go with any as the majority of them aim to support Kubernetes native or &lt;a href=&quot;https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/&quot;&gt;custom resources&lt;/a&gt;, and we needed infrastructure provisioning that is beyond Kubernetes. With our approach, we have full control of the entire user flow and its implementation, and thus we benefit from:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Security&lt;/strong&gt;: The ability to secure the pipeline with many customised scripts and workflows.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Simple user experience (UX)&lt;/strong&gt;: Simplified user flow and prevents human errors with automation.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;DRY&lt;/strong&gt;: Minimise boilerplate codes. Users only need to create a single Terraform resource and not an entire Terraform project.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/securing-gitops-pipeline/khone-user-flow.png&quot; alt=&quot;&quot; style=&quot;width:70%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;&lt;i&gt;Fig. 2 User flow with Khone&lt;/i&gt;&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;With all types of streaming infrastructure resources that we support, be it Kafka topics or Flink pipelines, we have identified they all have common properties such as namespace, environment, or cluster name such as Kafka cluster and Kubernetes cluster. As such, using those values as file paths help us to easily validate users input and de-couple them from the resource specific configuration properties in their HCL source code. Moreover, it helps to remove redundant information to maintain consistency. If the piece of information is in the file path, it won’t be elsewhere in resource definition.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/securing-gitops-pipeline/khone-directory-structure.png&quot; alt=&quot;&quot; style=&quot;width:70%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;&lt;i&gt;Fig. 3 Khone directory structure&lt;/i&gt;&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;With this approach, we can utilise our pipeline scripts, which are written in Python and perform validations on the types of resources and resource names using Regular Expressions (Regex) without relying on HCL functions. Furthermore, we helped prevent human errors and improved developers’ efficiency by deriving these properties and reducing boilerplate codes by automatically parsing out other necessary configurations such as Kafka brokers endpoint from the cluster name and environment.&lt;/p&gt;

&lt;h3 id=&quot;pipeline-stages&quot;&gt;Pipeline stages&lt;/h3&gt;

&lt;p&gt;Khone’s pipeline implementation is designed with three stages. Each stage has different duties and responsibilities in verifying user input and securely creating the resources.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/securing-gitops-pipeline/khone-pipeline-example.png&quot; alt=&quot;&quot; style=&quot;width:70%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;&lt;i&gt;Fig. 4 An example of a Khone pipeline&lt;/i&gt;&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;h4 id=&quot;initialisation-stage&quot;&gt;Initialisation stage&lt;/h4&gt;

&lt;p&gt;At this stage, we categorise the changes into Deleted, Created or Changed resources and filter out unsupported resource types. We also prevent users from creating unintended resources by validating them based on resource path and inspecting the HCL source code in their Terraform module. This stage also prepares artefacts for subsequent stages.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/securing-gitops-pipeline/terraform-changes.png&quot; alt=&quot;&quot; style=&quot;width:70%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;&lt;i&gt;Fig. 5 Terraform changes detected by Khone&lt;/i&gt;&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;h4 id=&quot;terraform-stage&quot;&gt;Terraform stage&lt;/h4&gt;

&lt;p&gt;This is a downstream pipeline that runs either the Terraform plan or Terraform apply command depending on the state of the MR, which can either be pending review or merged. &lt;a href=&quot;https://engineering.grab.com/how-we-reduced-our-ci-yaml&quot;&gt;Individual jobs run in parallel&lt;/a&gt; for each resource change, which helps with performance and reduces the overall pipeline run time.&lt;/p&gt;

&lt;p&gt;For each individual job, we implemented multiple security checkpoints such as:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Code inspection&lt;/strong&gt;: We use the &lt;a href=&quot;https://pypi.org/project/python-hcl2/&quot;&gt;python-hcl2&lt;/a&gt; library to read HCL content of Terraform resources to perform validation, restrict the types of Terraform resources users can create, and ensure that resources have the intended configurations. We also validate whitelisted Terraform module source endpoint based on the declared resource type. This enables us to inherit the flexibility of Python as a programming language and perform validations more dynamically rather than relying on HCL functions.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Resource validation&lt;/strong&gt;: We validate configurations based on resource path to ensure users are following the correct and intended directory structure.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Linting and formatting&lt;/strong&gt;: Perform HCL code linting and formatting using Terraform CLI to ensure code consistency.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Furthermore, our Terraform module independently validates parameters by verifying the working directory instead of relying on user input, acting as an additional layer of defence for validation.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;path = one(regexall(join(&quot;/&quot;,
[
    &quot;^*&quot;,
    &quot;(?P&amp;lt;repository&amp;gt;khone|khone-dev)&quot;,
    &quot;resources&quot;,
    &quot;(?P&amp;lt;namespace&amp;gt;[^/]*)&quot;,
    &quot;(?P&amp;lt;resource_type&amp;gt;[^/]*)&quot;,
    &quot;(?P&amp;lt;env&amp;gt;[^/]*)&quot;,
    &quot;(?P&amp;lt;cluster_name&amp;gt;[^/]*)&quot;,
    &quot;(?P&amp;lt;resource_name&amp;gt;[^/]*)$&quot;
]), path.cwd))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;metric-stage&quot;&gt;Metric stage&lt;/h4&gt;

&lt;p&gt;In this stage, we consolidate previous jobs’ status and publish our pipeline metrics such as success or error rate.&lt;/p&gt;

&lt;p&gt;For our metrics, we identified actual users by omitting users from Coban. This helps us measure success metrics more consistently as we could isolate metrics from test continuous integration/continuous deployment (CI/CD) pipelines.&lt;/p&gt;

&lt;p&gt;For the second half of 2022, we achieved a 100% uptime for Khone pipelines.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/securing-gitops-pipeline/success-metrics.png&quot; alt=&quot;&quot; style=&quot;width:70%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;&lt;i&gt;Fig. 6 Khone's success metrics for the second half of 2022&lt;/i&gt;&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;h3 id=&quot;preventing-pipeline-config-tampering&quot;&gt;Preventing pipeline config tampering&lt;/h3&gt;

&lt;p&gt;By default, with each repository on GitLab that has CI/CD pipelines enabled, owners or administrators would need to have a pipeline config file at the root directory of the repository with the name &lt;strong&gt;.gitlab-ci.yml&lt;/strong&gt;. Other scripts may also be stored somewhere within the repository.&lt;/p&gt;

&lt;p&gt;With this setup, whenever a user creates an MR, if the pipeline config file is modified as part of the MR, the modified version of the config file will be immediately reflected in the pipeline’s run. Users can exploit this by running arbitrary code on the privileged GitLab runner.&lt;/p&gt;

&lt;p&gt;In order to prevent this, we utilise GitLab’s &lt;a href=&quot;https://docs.gitlab.com/ee/ci/pipelines/settings.html#specify-a-custom-cicd-configuration-file&quot;&gt;remote pipeline config&lt;/a&gt; functionality. We have created another private repository, &lt;strong&gt;khone-admin&lt;/strong&gt;, and stored our pipeline config there.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/securing-gitops-pipeline/khone-remote-pipeline-config.png&quot; alt=&quot;&quot; style=&quot;width:70%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;&lt;i&gt;Fig. 7 Khone's remote pipeline config&lt;/i&gt;&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;In Fig. 7, our configuration is set to a file called &lt;strong&gt;khone-gitlab-ci.yml&lt;/strong&gt; residing in the &lt;strong&gt;khone-admin&lt;/strong&gt; repository under &lt;strong&gt;snd&lt;/strong&gt; group.&lt;/p&gt;

&lt;h3 id=&quot;preventing-pipeline-scripts-tampering&quot;&gt;Preventing pipeline scripts tampering&lt;/h3&gt;

&lt;p&gt;We had scripts that ran before the MR and they were approved and merged to perform preliminary checks or validations. They were also used to run the Terraform plan command. Users could modify these existing scripts to perform malicious actions. For example, they could bypass all validations and directly run the Terraform apply command to create unintended resources.&lt;/p&gt;

&lt;p&gt;This can be prevented by storing all of our scripts in the &lt;strong&gt;khone-admin&lt;/strong&gt; repository and cloning them in each stage of our pipeline using the &lt;strong&gt;before_script&lt;/strong&gt; clause.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;default:
  before_script:
    - rm -rf khone_admin
    - git clone --depth 1 --single-branch https://gitlab-ci-token:${CI_JOB_TOKEN}@gitlab.myteksi.net/snd/khone-admin.git khone_admin
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Even though this adds an overhead to each of our pipeline jobs and increases run time, the amount is insignificant as we have optimised the process by using shallow cloning. The Git clone command included in the above script with &lt;strong&gt;depth=1&lt;/strong&gt; and &lt;strong&gt;single-branch&lt;/strong&gt; flag has reduced the time it takes to clone the scripts down to only &lt;strong&gt;0.59 seconds&lt;/strong&gt;.&lt;/p&gt;

&lt;h3 id=&quot;testing-our-pipeline&quot;&gt;Testing our pipeline&lt;/h3&gt;

&lt;p&gt;With all the security measures implemented for Khone, this raises a question of how did we test the pipeline? We have done this by setting up an additional repository called &lt;strong&gt;khone-dev&lt;/strong&gt;.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/securing-gitops-pipeline/repo-relationship.png&quot; alt=&quot;&quot; style=&quot;width:70%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;&lt;i&gt;Fig. 8 Repositories relationship&lt;/i&gt;&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;h4 id=&quot;pipeline-config&quot;&gt;Pipeline config&lt;/h4&gt;

&lt;p&gt;Within this &lt;strong&gt;khone-dev&lt;/strong&gt; repository, we have set up a remote pipeline config file following this format:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;File Name&amp;gt;@&amp;lt;Repository Ref&amp;gt;:&amp;lt;Branch Name&amp;gt;&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/securing-gitops-pipeline/khone-dev-remote.png&quot; alt=&quot;&quot; style=&quot;width:70%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;&lt;i&gt;Fig. 9 Khone-dev's remote pipeline config&lt;/i&gt;&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;In Fig. 9, our configuration is set to a file called &lt;strong&gt;khone-gitlab-ci.yml&lt;/strong&gt; residing in the &lt;strong&gt;khone-admin&lt;/strong&gt; repository under the &lt;strong&gt;snd&lt;/strong&gt; group and under a branch named &lt;strong&gt;ci-test&lt;/strong&gt;. With this approach, we can test our pipeline config without having to merge it to master branch that affects the main Khone repository. As a security measure, we only allow users within a certain GitLab group to push changes to this branch.&lt;/p&gt;

&lt;h4 id=&quot;pipeline-scripts&quot;&gt;Pipeline scripts&lt;/h4&gt;

&lt;p&gt;Following the same method for pipeline scripts, instead of cloning from the master branch in the &lt;strong&gt;khone-admin&lt;/strong&gt; repository, we have implemented a logic to clone them from the branch matching our lightweight directory access protocol (LDAP) user account if it exists. We utilised the &lt;strong&gt;GITLAB_USER_LOGIN&lt;/strong&gt; environment variable that is injected by GitLab to each individual CI job to get the respective LDAP account to perform this logic.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;default:
  before_script:
    - rm -rf khone_admin
    - |
      if git ls-remote --exit-code --heads &quot;https://gitlab-ci-token:${CI_JOB_TOKEN}@gitlab.myteksi.net/snd/khone-admin.git&quot; &quot;$GITLAB_USER_LOGIN&quot; &amp;gt; /dev/null; then
        echo &quot;Cloning khone-admin from dev branch ${GITLAB_USER_LOGIN}&quot;
        git clone --depth 1 --branch &quot;$GITLAB_USER_LOGIN&quot; --single-branch &quot;https://gitlab-ci-token:${CI_JOB_TOKEN}@gitlab.myteksi.net/snd/khone-admin.git&quot; khone_admin
      else
        echo &quot;Dev branch ${GITLAB_USER_LOGIN} not found, cloning from master instead&quot;
        git clone --depth 1 --single-branch &quot;https://gitlab-ci-token:${CI_JOB_TOKEN}@gitlab.myteksi.net/snd/khone-admin.git&quot; khone_admin
      fi
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;whats-next&quot;&gt;What’s next?&lt;/h2&gt;

&lt;p&gt;With security being our main focus for our Khone GitOps pipeline, we plan to abide by the &lt;a href=&quot;https://en.wikipedia.org/wiki/Principle_of_least_privilege&quot;&gt;principle of least privilege&lt;/a&gt; and implement separate GitLab runners for different types of resources and assign them with just enough IAM roles and policies, and minimal network security group rules to access our Kafka or Kubernetes clusters.&lt;/p&gt;

&lt;p&gt;Furthermore, we also plan to maintain high standards and stability by including unit tests in our CI scripts to ensure that every change is well-tested before being deployed.&lt;/p&gt;

&lt;h2 id=&quot;references&quot;&gt;References&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://docs.gitlab.com/ee/ci/pipelines/settings.html#specify-a-custom-cicd-configuration-file&quot;&gt;Specify a custom CI/CD configuration file&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html&quot;&gt;IAM roles for service accounts&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://docs.gitlab.com/ee/user/project/code_owners.html&quot;&gt;GitLab code owners&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;small class=&quot;credits&quot;&gt;Special thanks to Fabrice Harbulot for kicking off this project and building a strong foundation for it.&lt;/small&gt;&lt;/p&gt;

&lt;h1 id=&quot;join-us&quot;&gt;Join us&lt;/h1&gt;

&lt;p&gt;Grab is the leading superapp platform in Southeast Asia, providing everyday services that matter to consumers. More than just a ride-hailing and food delivery app, Grab offers a wide range of on-demand services in the region, including mobility, food, package and grocery delivery services, mobile payments, and financial services across 428 cities in eight countries.&lt;/p&gt;

&lt;p&gt;Powered by technology and driven by heart, our mission is to drive Southeast Asia forward by creating economic empowerment for everyone. If this mission speaks to you, &lt;a href=&quot;https://grab.careers/&quot;&gt;join our team&lt;/a&gt; today!&lt;/p&gt;
</description>
        <pubDate>Wed, 01 Mar 2023 02:23:05 +0000</pubDate>
        <link>https://engineering.grab.com/securing-gitops-pipeline</link>
        <guid isPermaLink="true">https://engineering.grab.com/securing-gitops-pipeline</guid>
        
        <category>Engineering</category>
        
        <category>Open source</category>
        
        <category>Pipelines</category>
        
        <category>Continuous Delivery</category>
        
        <category>Continuous Integration</category>
        
        <category>Optimisation</category>
        
        
        <category>Engineering</category>
        
      </item>
    
      <item>
        <title>New zoom freezing feature for Geohash plugin</title>
        <description>&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;

&lt;p&gt;Geohash is an encoding system with a unique identifier for each region on the planet. Therefore, all geohash units can be associated with an individual set of digits and letters.&lt;/p&gt;

&lt;p&gt;Geohash is a plugin built by Grab that is available in the Java OpenStreetMap Editor (JOSM) tool, which comes in handy for those who work on precise areas based on geohash units.&lt;/p&gt;

&lt;h2 id=&quot;background&quot;&gt;Background&lt;/h2&gt;

&lt;p&gt;Up until recently, users of the Geohash JOSM plugin were unable to stop the displaying of new geohashes with every zoom-in or zoom-out. This meant that every time they changed the zoom, new geohashes would be displayed, and this became bothersome for many users when it was unneeded. The previous behaviour of the plugin when zooming in and out is depicted in the following short video:&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/geohash-plugin/image7.gif&quot; alt=&quot;&quot; style=&quot;width:70%&quot; /&gt;
  &lt;/figure&gt;
&lt;/div&gt;
&lt;p&gt;This led to the implementation of the zoom freeze feature, which helps users toggle between Enable zoom freeze and Disable zoom freeze, based on their needs.&lt;/p&gt;

&lt;h2 id=&quot;solution&quot;&gt;Solution&lt;/h2&gt;

&lt;p&gt;As you can see in the following image, a new label was created with the purpose of freezing or unfreezing the display of new geohashes with each zoom change:&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/geohash-plugin/image3.png&quot; alt=&quot;&quot; style=&quot;width:70%&quot; /&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;By default, this label says “Enable zoom freeze”, and when zoom freezing is enabled, the label changes to “Disable zoom freeze”.&lt;/p&gt;

&lt;p&gt;In order to see how zoom freezing works, let’s consider the following example: a user wants to zoom inside the geohash with the code w886hu, without triggering the display of smaller geohashes inside of it. For this purpose, the user will enable the zoom freezing feature by clicking on the label, and then they will proceed with the zoom. The map will look like this:&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/geohash-plugin/image1.png&quot; alt=&quot;&quot; style=&quot;width:70%&quot; /&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;It is apparent from the image that no new geohashes were created. Now, let’s say the user has finished what they wanted to do, and wants to go back to the “normal” geohash visualisation mode, which means disabling the zoom freeze option. After clicking on the label that now says ‘Disable zoom freeze’, new, smaller geohashes will be displayed, according to the current zoom level:&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/geohash-plugin/image2.png&quot; alt=&quot;&quot; style=&quot;width:70%&quot; /&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;The functionality is illustrated in the following short video:&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/geohash-plugin/image5.gif&quot; alt=&quot;&quot; style=&quot;width:70%&quot; /&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;Another effect that enabling zoom freeze has is that it disables the ‘Display larger geohashes’ and ‘Display smaller geohashes’ options, since the geohashes are now fixed. The following images show how these options work before and after disabling zoom freeze:&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/geohash-plugin/image6.png&quot; alt=&quot;&quot; style=&quot;width:70%&quot; /&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/geohash-plugin/image4.png&quot; alt=&quot;&quot; style=&quot;width:70%&quot; /&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;To conclude, we believe that the release of this new feature will benefit users by making it more comfortable for them to zoom in and out of a map. By turning off the display of new geohashes when this is unwanted, map readability is improved, and this translates to a better user experience.&lt;/p&gt;

&lt;h2 id=&quot;impactlimitations&quot;&gt;Impact/Limitations&lt;/h2&gt;

&lt;p&gt;In order to start using this new feature, users need to update the Geohash JOSM plugin.&lt;/p&gt;

&lt;h2 id=&quot;whats-next&quot;&gt;What’s next?&lt;/h2&gt;

&lt;p&gt;Grab has come a long way in map-making, from using open source map-making software and developing its own suite of map-making tools to contributing to the open-source map community and building and launching GrabMaps. To find out more, read &lt;a href=&quot;/kartacam-powers-grabmaps&quot;&gt;How KartaCam powers GrabMaps&lt;/a&gt; and &lt;a href=&quot;https://www.grab.com/sg/enterprise-blog/kartacam-delivers-comprehensive-cost-effective-mapping-data/&quot;&gt;KartaCam delivers comprehensive, cost-effective mapping data&lt;/a&gt;.&lt;/p&gt;

&lt;h1 id=&quot;join-us&quot;&gt;Join us&lt;/h1&gt;

&lt;p&gt;Grab is the leading superapp platform in Southeast Asia, providing everyday services that matter to consumers. More than just a ride-hailing and food delivery app, Grab offers a wide range of on-demand services in the region, including mobility, food, package and grocery delivery services, mobile payments, and financial services across 428 cities in eight countries.&lt;/p&gt;

&lt;p&gt;Powered by technology and driven by heart, our mission is to drive Southeast Asia forward by creating economic empowerment for everyone. If this mission speaks to you, &lt;a href=&quot;https://grab.careers/&quot;&gt;join our team&lt;/a&gt; today!&lt;/p&gt;
</description>
        <pubDate>Tue, 21 Feb 2023 01:18:05 +0000</pubDate>
        <link>https://engineering.grab.com/geohash-plugin</link>
        <guid isPermaLink="true">https://engineering.grab.com/geohash-plugin</guid>
        
        <category>Engineering</category>
        
        <category>Geohash</category>
        
        <category>Maps</category>
        
        <category>Open source</category>
        
        
        <category>Engineering</category>
        
        <category>Product</category>
        
      </item>
    
      <item>
        <title>Graph service platform</title>
        <description>&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;

&lt;p&gt;In earlier articles of this series, we covered the &lt;a href=&quot;/graph-networks&quot;&gt;importance of graph networks&lt;/a&gt;, &lt;a href=&quot;/graph-concepts&quot;&gt;graph concepts&lt;/a&gt;, &lt;a href=&quot;/graph-visualisation&quot;&gt;how graph visualisation makes fraud investigations easier and more effective&lt;/a&gt;, and &lt;a href=&quot;/graph-for-fraud-detection&quot;&gt;how graphs for fraud detection work&lt;/a&gt;. In this article, we elaborate on the need for a graph service platform and how it works.&lt;/p&gt;

&lt;p&gt;In the present age, data linkages can generate significant business value. Whether we want to learn about the relationships between users in online social networks, between users and products in e-commerce, or understand credit relationships in financial networks, the capability to understand and analyse large amounts of highly interrelated data is becoming more important to businesses.&lt;/p&gt;

&lt;p&gt;As the amount of consumer data grows, the GrabDefence team must continuously enhance fraud detection on mobile devices to proactively identify the presence of fraudulent or malicious users. Even simple financial transactions between users must be monitored for transaction loops and money laundering. To preemptively detect such scenarios, we need a graph service platform to help discover data linkages. &lt;/p&gt;

&lt;h2 id=&quot;background&quot;&gt;Background&lt;/h2&gt;

&lt;p&gt;As mentioned in an &lt;a href=&quot;/graph-concepts&quot;&gt;earlier article&lt;/a&gt;, a graph is a model representation of the association of entities and holds knowledge in a structured way by marginalising entities and relationships. In other words, graphs hold a natural interpretability of linked data and graph technology plays an important role. Since the early days, large tech companies started to create their own graph technology infrastructure, which is used for things like social relationship mining, web search, and sorting and recommendation systems with great commercial success.&lt;/p&gt;

&lt;p&gt;As graph technology was developed, the amount of data gathered from graphs started to grow as well, leading to a need for graph databases. Graph databases&lt;sup id=&quot;fnref:1&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:1&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt; are used to store, manipulate, and access graph data on the basis of graph models. It is similar to the relational database with the feature of Online Transactional Processing (OLTP), which supports transactions, persistence, and other features.&lt;/p&gt;

&lt;p&gt;A key concept of graphs is the edge or relationship between entities. The graph relates the data items in the store to a collection of nodes and edges, the edges representing the relationships between the nodes. These relationships allow data in the store to be linked directly and retrieved with one operation.&lt;/p&gt;

&lt;p&gt;With graph databases, relationships between data can be queried fast as they are perpetually stored in the database. Additionally, relationships can be intuitively visualised using graph databases, making them useful for heavily interconnected data. To have real-time graph search capabilities, we must leverage the graph service platform and graph databases.&lt;/p&gt;

&lt;h2 id=&quot;architecture-details&quot;&gt;Architecture details&lt;/h2&gt;

&lt;p&gt;Graph services with graph databases are Platforms as a Service (PaaS) that encapsulate the underlying implementation of graph technology and support easier discovery of data association relationships with graph technologies.&lt;/p&gt;

&lt;p&gt;They also provide universal graph operation APIs and service management for users. This means that users do not need to build graph runtime environments independently and can explore the value of data with graph service directly.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/graph-service-platform/image5.png&quot; alt=&quot;&quot; style=&quot;width:70%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Fig. 1 Graph service platform system architecture&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;As shown in Fig. 1, the system can be divided into four layers:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;Storage backend&lt;/strong&gt; - Different forms of data (for example, CSV files) are stored in Amazon S3, graph data stores in Neptune and meta configuration stores in DynamoDB.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Driver&lt;/strong&gt; - Contains drivers such as Gremlin, Neptune, S3, and DynamoDB.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Service&lt;/strong&gt; - Manages clusters, instances, databases etc, provides management API, includes schema and data load management, graph operation logic, and other graph algorithms.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;RESTful APIs&lt;/strong&gt; - Currently supports the standard and uniform formats provided by the system, the Management API, Search API for OLTP, and Analysis API for online analytical processing (OLAP).&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;how-it-works&quot;&gt;How it works&lt;/h2&gt;

&lt;h3 id=&quot;graph-flow&quot;&gt;Graph flow&lt;/h3&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/graph-service-platform/image1.png&quot; alt=&quot;&quot; style=&quot;width:70%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Fig. 2 Graph flow&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;CSV files stored in Amazon S3 are processed by extract, transform, and load (ETL) tools to generate graph data. This data is then managed by an Amazon Neptune DB cluster, which can only be accessed by users through graph service. Graph service converts user requests into asynchronous interactions with Neptune Cluster, which returns the results to users.&lt;/p&gt;

&lt;p&gt;When users launch data load tasks, graph service synchronises the entity and attribute information with the CSV file in S3, and the schema stored in DynamoDB. The data is only imported into Neptune if there are no inconsistencies.&lt;/p&gt;

&lt;p&gt;The most important component in the system is the graph service, which provides RESTful APIs for two scenarios: graph search for real-time streams and graph analysis for batch processing. At the same time, the graph service manages clusters, databases, instances, users, tasks, and meta configurations stored in DynamoDB, which implements features of service monitor and data loading offline or stream ingress online.&lt;/p&gt;

&lt;h3 id=&quot;use-casein-fraud-detection&quot;&gt;Use case in fraud detection&lt;/h3&gt;

&lt;p&gt;In Grab’s mobility business, we have come across situations where multiple accounts use shared physical devices to maximise their earning potential. With the graph capabilities provided by the graph service platform, we can clearly see the connections between multiple accounts and shared devices.&lt;/p&gt;

&lt;p&gt;Historical device and account data are stored in the graph service platform via offline data loading or online stream injection. If the device and account data exists in the graph service platform, we can find the adjacent account IDs or the shared device IDs by using the device ID or account ID respectively specified in the user request.&lt;/p&gt;

&lt;p&gt;In our experience, fraudsters tend to share physical resources to maximise their revenue. The following image shows a device that is shared by many users. With our Graph Visualisation platform based on graph service, you can see exactly what this pattern looks like.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/graph-service-platform/image3.png&quot; alt=&quot;&quot; style=&quot;width:70%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Fig 3. Example of a device being shared with many users&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;h3 id=&quot;data-injection&quot;&gt;Data injection&lt;/h3&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/graph-service-platform/image4.png&quot; alt=&quot;&quot; style=&quot;width:70%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Fig. 4 Data injection&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;Graph service also supports data injection features, including data load by request (task with a type of data load) and real-time stream write by Kafka.  &lt;/p&gt;

&lt;p&gt;When connected to GrabDefence’s infrastructure, Confluent with Kafka is used as the streaming engine.  The purpose of using Kafka as a streaming write engine is two-fold: to provide primary user authentication and to relieve the pressure on Neptune.&lt;/p&gt;

&lt;h2 id=&quot;impact&quot;&gt;Impact&lt;/h2&gt;

&lt;p&gt;Graph service supports data management of Labelled Property Graphs and provides the capability to add, delete, update, and get vertices, edges, and properties for some graph models. Graph traversal and searching relationships with RESTful APIs are also more convenient with graph service.&lt;/p&gt;

&lt;p&gt;Businesses usually do not need to focus on the underlying data storage, just designing graph schemas for model definition according to their needs. With the graph service platform, platforms or systems can be built for personalised search, intelligent Q&amp;amp;A, financial fraud, etc.&lt;/p&gt;

&lt;p&gt;For big organisations, extensive graph algorithms provide the power to mine various entity connectivity relationships in massive amounts of data. The growth and expansion of new businesses is driven by discovering the value of data.&lt;/p&gt;

&lt;h2 id=&quot;whats-next&quot;&gt;What’s next?&lt;/h2&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/graph-service-platform/image2.png&quot; alt=&quot;&quot; style=&quot;width:70%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Fig. 5 Graph-centric ecosystems&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;We are building an integrated graph ecosystem inside and outside Grab. The infrastructure and service, or APIs are key components in graph-centric ecosystems; they provide graph arithmetic and basic capabilities of graphs in relation to search, computing, analysis etc. Besides that, we will also consider incorporating applications such as risk prediction and fraud detection in order to serve our current business needs.&lt;/p&gt;

&lt;h2 id=&quot;speak-to-us&quot;&gt;Speak to us&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://www.grab.com/sg/business/defence/&quot;&gt;GrabDefence&lt;/a&gt; is a proprietary fraud prevention platform built by Grab, Southeast Asia’s leading superapp. Since 2019, the GrabDefence team has shared its fraud management capabilities and platform with enterprises and startups to leverage Grab’s advanced AI/ML models, hyper local insights and patented device intelligence technologies.&lt;/p&gt;

&lt;p&gt;To learn more about GrabDefence or to speak to our fraud management experts, contact us at &lt;a href=&quot;mailto:gd.contact@grabtaxi.com&quot;&gt;gd.contact@grabtaxi.com&lt;/a&gt;.&lt;/p&gt;

&lt;h1 id=&quot;join-us&quot;&gt;Join us&lt;/h1&gt;

&lt;p&gt;Grab is the leading superapp platform in Southeast Asia, providing everyday services that matter to consumers. More than just a ride-hailing and food delivery app, Grab offers a wide range of on-demand services in the region, including mobility, food, package and grocery delivery services, mobile payments, and financial services across 428 cities in eight countries.&lt;/p&gt;

&lt;p&gt;Powered by technology and driven by heart, our mission is to drive Southeast Asia forward by creating economic empowerment for everyone. If this mission speaks to you, &lt;a href=&quot;https://grab.careers/&quot;&gt;join our team&lt;/a&gt; today!&lt;/p&gt;

&lt;h2 id=&quot;references&quot;&gt;References&lt;/h2&gt;

&lt;div class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;&lt;a href=&quot;https://neo4j.com/developer/graph-database/&quot;&gt;What is a Graph Database? - Developer Guides&lt;/a&gt; &lt;a href=&quot;#fnref:1&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</description>
        <pubDate>Thu, 05 Jan 2023 01:18:05 +0000</pubDate>
        <link>https://engineering.grab.com/graph-service-platform</link>
        <guid isPermaLink="true">https://engineering.grab.com/graph-service-platform</guid>
        
        <category>Engineering</category>
        
        <category>Graph networks</category>
        
        <category>Graphs</category>
        
        <category>Graph visualisation</category>
        
        <category>Security</category>
        
        <category>Analytics</category>
        
        <category>Fraud detection</category>
        
        
        <category>Engineering</category>
        
        <category>Security</category>
        
        <category>Data Science</category>
        
      </item>
    
      <item>
        <title>Zero trust with Kafka</title>
        <description>&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;
&lt;p&gt;Grab’s real-time data platform team, also known as Coban, has been operating large-scale Kafka clusters for all Grab verticals, with a strong focus on ensuring a best-in-class-performance and 99.99% availability.&lt;/p&gt;

&lt;p&gt;Security has always been one of Grab’s top priorities and as fraudsters continue to evolve, there is an increased need to continue strengthening the security of our data streaming platform. One of the ways of doing this is to move from a pure network-based access control to state-of-the-art security and zero trust by default, such as:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Authentication&lt;/strong&gt;: The identity of any remote systems - clients and servers - is established and ascertained first, prior to any further communications.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Authorisation&lt;/strong&gt;: Access to Kafka is granted based on the principle of least privilege; no access is given by default. Kafka clients are associated with the whitelisted Kafka topics and permissions - consume or produce - they strictly need. Also, granted access is auditable.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Confidentiality&lt;/strong&gt;: All in-transit traffic is encrypted.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;solution&quot;&gt;Solution&lt;/h2&gt;

&lt;p&gt;We decided to use mutual Transport Layer Security (mTLS) for authentication and encryption. mTLS enables clients to authenticate servers, and servers to reciprocally authenticate clients.&lt;/p&gt;

&lt;p&gt;Kafka supports other authentication mechanisms, like OAuth, or Salted Challenge Response Authentication Mechanism (SCRAM), but we chose mTLS because it is able to verify the peer’s identity offline. This verification ability means that systems do not need an active connection to an authentication server to ascertain the identity of a peer. This enables operating in disparate network environments, where all parties do not necessarily have access to such a central authority.&lt;/p&gt;

&lt;p&gt;We opted for &lt;a href=&quot;https://www.vaultproject.io/&quot;&gt;Hashicorp Vault&lt;/a&gt; and its &lt;a href=&quot;https://www.vaultproject.io/docs/secrets/pki&quot;&gt;PKI engine&lt;/a&gt; to dynamically generate clients and servers’ certificates. This enables us to enforce the usage of short-lived certificates for clients, which is a way to mitigate the potential impact of a client certificate being compromised or maliciously shared. We said zero trust, right?&lt;/p&gt;

&lt;p&gt;For authorisation, we chose Policy-Based Access Control (PBAC), a more scalable solution than Role-Based Access Control (RBAC), and the &lt;a href=&quot;https://www.openpolicyagent.org/&quot;&gt;Open Policy Agent&lt;/a&gt; (OPA) as our policy engine, for its wide community support.&lt;/p&gt;

&lt;p&gt;To integrate mTLS and the OPA with Kafka, we leveraged &lt;a href=&quot;https://strimzi.io/&quot;&gt;Strimzi&lt;/a&gt;, the Kafka on Kubernetes operator. In a previous &lt;a href=&quot;/exposing-kafka-cluster&quot;&gt;article&lt;/a&gt;, we have alluded to Strimzi and hinted at how it would help with scalability and cloud agnosticism. Built-in security is undoubtedly an additional driver of our adoption of Strimzi.&lt;/p&gt;

&lt;h3 id=&quot;server-authentication&quot;&gt;Server authentication&lt;/h3&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/zero-trust-with-kafka/image4.png&quot; alt=&quot;&quot; style=&quot;width:70%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Figure 1 - Server authentication process for internal cluster communications&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;We first set up a single Root Certificate Authority (CA) for each environment (staging, production, etc.). This Root CA, in blue on the diagram, is securely managed by the Hashicorp Vault cluster. Note that the color of the certificates, keys, signing arrows and signatures on the diagrams are consistent throughout this article.&lt;/p&gt;

&lt;p&gt;To secure the cluster’s internal communications, like the communications between the Kafka broker and Zookeeper pods, Strimzi sets up a Cluster CA, which is signed by the Root CA (step 1). The Cluster CA is then used to sign the individual Kafka broker and zookeeper certificates (step 2). Lastly, the Root CA’s public certificate is imported into the truststores of both the Kafka broker and Zookeeper (step 3), so that all pods can mutually verify their certificates when authenticating one with the other.&lt;/p&gt;

&lt;p&gt;Strimzi’s embedded Cluster CA dynamically generates valid individual certificates when spinning up new Kafka and Zookeeper pods. The signing operation (step 2) is handled automatically by Strimzi.&lt;/p&gt;

&lt;p&gt;For client access to Kafka brokers, Strimzi creates a different set of intermediate CA and server certificates, as shown in the next diagram.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/zero-trust-with-kafka/image5.png&quot; alt=&quot;&quot; style=&quot;width:70%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Figure 2 - Server authentication process for client access to Kafka brokers&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;The same Root CA from Figure 1 now signs a different intermediate CA, which the Strimzi community calls the Client CA (step 1). This naming is misleading since it does not actually sign any client certificates, but only the server certificates (step 2) that are set up on the external listener of the Kafka brokers. These server certificates are for the Kafka clients to authenticate the servers. This time, the Root CA’s public certificate will be imported into the Kafka Client truststore (step 3).&lt;/p&gt;

&lt;h3 id=&quot;clientauthentication&quot;&gt;Client authentication&lt;/h3&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/zero-trust-with-kafka/image1.png&quot; alt=&quot;&quot; style=&quot;width:70%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Figure 3 - Client authentication process&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;For client authentication, the Kafka client first needs to authenticate to Hashicorp Vault and request an ephemeral certificate from the Vault PKI engine (step 1). Vault then issues a certificate and signs it using its Root CA (step 2). With this certificate, the client can now authenticate to Kafka brokers, who will use the Root CA’s public certificate already in their truststore, as previously described (step 3).&lt;/p&gt;

&lt;h3 id=&quot;ca-tree&quot;&gt;CA tree&lt;/h3&gt;
&lt;p&gt;Putting together the three different authentication processes we have just covered, the CA tree now looks like this. Note that this is a simplified view for a single environment, a single cluster, and two clients only.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/zero-trust-with-kafka/image3.png&quot; alt=&quot;&quot; style=&quot;width:70%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Figure 4 - Complete certificate authority tree&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;As mentioned earlier, each environment (staging, production, etc.) has its own Root CA. Within an environment, each Strimzi cluster has its own pair of intermediate CAs: the Cluster CA and the Client CA. At the leaf level, the Zookeeper and Kafka broker pods each have their own individual certificates.&lt;/p&gt;

&lt;p&gt;On the right side of the diagram, each Kafka client can get an ephemeral certificate from Hashicorp Vault whenever they need to connect to Kafka. Each team or application has a dedicated Vault PKI role in Hashicorp Vault, restricting what can be requested for its certificate (e.g., Subject, TTL, etc.).&lt;/p&gt;

&lt;h3 id=&quot;strimzi-deployment&quot;&gt;Strimzi deployment&lt;/h3&gt;

&lt;p&gt;We heavily use Terraform to manage and provision our Kafka and Kafka-related components. This enables us to quickly and reliably spin up new clusters and perform cluster scaling operations.&lt;/p&gt;

&lt;p&gt;Under the hood, Strimzi Kafka deployment is a Kubernetes deployment. To increase the performance and the reliability of the Kafka cluster, we create dedicated Kubernetes nodes for each Strimzi Kafka broker and each Zookeeper pod, using &lt;a href=&quot;https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/&quot;&gt;Kubernetes taints and tolerations&lt;/a&gt;. This ensures that all resources of a single node are dedicated solely to either a single Kafka broker or a single Zookeeper pod.&lt;/p&gt;

&lt;p&gt;We also decided to go with a single Kafka cluster by Kubernetes cluster to make the management easier.&lt;/p&gt;

&lt;h3 id=&quot;client-setup&quot;&gt;Client setup&lt;/h3&gt;

&lt;p&gt;Coban provides backend microservice teams from all Grab verticals with a popular Kafka SDK in Golang, to standardise how teams utilise Coban Kafka clusters. Adding mTLS support mostly boils down to upgrading our SDK.&lt;/p&gt;

&lt;p&gt;Our enhanced SDK provides a default mTLS configuration that works out of the box for most teams, while still allowing customisation, e.g., for teams that have their own Hashicorp Vault Infrastructure for compliance reasons. Similarly, clients can choose among various Vault auth methods such as &lt;a href=&quot;https://developer.hashicorp.com/vault/docs/auth/aws&quot;&gt;AWS&lt;/a&gt; or &lt;a href=&quot;https://developer.hashicorp.com/vault/docs/auth/kubernetes&quot;&gt;Kubernetes&lt;/a&gt; to authenticate to Hashicorp Vault, or even implement their own logic for getting a valid client certificate.&lt;/p&gt;

&lt;p&gt;To mitigate the potential risk of a user maliciously sharing their application’s certificate with other applications or users, we limit the maximum Time-To-Live (TTL) for any given certificate. This also removes the overhead of maintaining a Certificate Revocation List (CRL). Additionally, our SDK stores the certificate and its associated private key in memory only, never on disk, hence reducing the attack surface.&lt;/p&gt;

&lt;p&gt;In our case, Hashicorp Vault is a dependency. To prevent it from reducing the overall availability of our data streaming platform, we have added two features to our SDK – a configurable retry mechanism and automatic renewal of clients’ short-lived certificates when two thirds of their TTL is reached. The upgraded SDK also produces new metrics around this certificate renewal process, enabling better monitoring and alerting.&lt;/p&gt;

&lt;h3 id=&quot;authorisation&quot;&gt;Authorisation&lt;/h3&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/zero-trust-with-kafka/image2.png&quot; alt=&quot;&quot; style=&quot;width:70%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Figure 5 - Authorisation process before a client can access a Kafka record&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;For authorisation, we set up the Open Policy Agent (OPA) as a standalone deployment in the Kubernetes cluster, and configured Strimzi to integrate the Kafka brokers with that OPA.&lt;/p&gt;

&lt;p&gt;OPA policies - written in the &lt;a href=&quot;https://www.openpolicyagent.org/docs/latest/policy-language/&quot;&gt;Rego&lt;/a&gt; language - describe the authorisation logic. They are created in a GitLab repository along with the authorisation rules, called data sources (step 1). Whenever there is a change, a GitLab CI pipeline automatically creates a bundle of the policies and data sources, and pushes it to an S3 bucket (step 2). From there, it is fetched by the OPA (step 3).&lt;/p&gt;

&lt;p&gt;When a client - identified by its TLS certificate’s Subject - attempts to consume or produce a Kafka record (step 4), the Kafka broker pod first issues an authorisation request to the OPA (step 5) before processing the client’s request. The outcome of the authorisation request is then cached by the Kafka broker pod to improve performance.&lt;/p&gt;

&lt;p&gt;As the core component of the authorisation process, the OPA is deployed with the same high availability as the Kafka cluster itself, i.e. spread across the same number of Availability Zones. Also, we decided to go with one dedicated OPA by Kafka cluster instead of having a unique global OPA shared between multiple clusters. This is to reduce the blast radius of any OPA incidents.&lt;/p&gt;

&lt;p&gt;For monitoring and alerting around authorisation, we submitted an &lt;a href=&quot;https://github.com/StyraInc/opa-kafka-plugin/pull/38&quot;&gt;Open Source contribution&lt;/a&gt; in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;opa-kafka-plugin&lt;/code&gt; project in order to enable the OPA authoriser to expose some metrics. Our contribution to the open source code allows us to monitor various aspects of the OPA, such as the number of authorised and unauthorised requests, as well as the cache hit-and-miss rates. Also, we set up alerts for suspicious activity such as unauthorised requests.&lt;/p&gt;

&lt;p&gt;Finally, as a platform team, we need to make authorisation a scalable, self-service process. Thus, we rely on the Git repository’s permissions to let Kafka topics’ owners approve the data source changes pertaining to their topics.&lt;/p&gt;

&lt;p&gt;Teams who need their applications to access a Kafka topic would write and submit a JSON data source as simple as this:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;{
 &quot;example_topic&quot;: {
   &quot;read&quot;: [
     &quot;clientA.grab&quot;,
     &quot;clientB.grab&quot;
   ],
   &quot;write&quot;: [
     &quot;clientB.grab&quot;
   ]
 }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;GitLab CI unit tests and business logic checks are set up in the Git repository to ensure that the submitted changes are valid. After that, the change would be submitted to the topic’s owner for review and approval.&lt;/p&gt;

&lt;h2 id=&quot;whats-next&quot;&gt;What’s next?&lt;/h2&gt;

&lt;p&gt;The performance impact of this security design is significant compared to unauthenticated, unauthorised, plaintext Kafka. We observed a drop in throughput, mostly due to the low performance of encryption and decryption in Java, and are currently benchmarking different encryption ciphers to mitigate this.&lt;/p&gt;

&lt;p&gt;Also, on authorisation, our current PBAC design is pretty static, with a list of applications granted access for each topic. In the future, we plan to move to Attribute-Based Access Control (ABAC), creating dynamic policies based on teams and topics’ metadata. For example, teams could be granted read and write access to all of their own topics by default. Leveraging a versatile component such as the OPA as our authorisation controller enables this evolution.&lt;/p&gt;

&lt;h1 id=&quot;join-us&quot;&gt;Join us&lt;/h1&gt;

&lt;p&gt;Grab is the leading superapp platform in Southeast Asia, providing everyday services that matter to consumers. More than just a ride-hailing and food delivery app, Grab offers a wide range of on-demand services in the region, including mobility, food, package and grocery delivery services, mobile payments, and financial services across 428 cities in eight countries.&lt;/p&gt;

&lt;p&gt;Powered by technology and driven by heart, our mission is to drive Southeast Asia forward by creating economic empowerment for everyone. If this mission speaks to you, &lt;a href=&quot;https://grab.careers/&quot;&gt;join our team&lt;/a&gt; today!&lt;/p&gt;
</description>
        <pubDate>Wed, 07 Dec 2022 00:23:05 +0000</pubDate>
        <link>https://engineering.grab.com/zero-trust-with-kafka</link>
        <guid isPermaLink="true">https://engineering.grab.com/zero-trust-with-kafka</guid>
        
        <category>Engineering</category>
        
        <category>Kafka</category>
        
        <category>Performance</category>
        
        <category>Zero trust</category>
        
        <category>Access control</category>
        
        
        <category>Engineering</category>
        
        <category>Security</category>
        
      </item>
    
      <item>
        <title>How KartaCam powers GrabMaps</title>
        <description>&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;

&lt;p&gt;The foundation for making any map is in imagery, but due to the complexity and dynamism of the real world, it is difficult for companies to collect high-quality, fresh images in an efficient yet low-cost manner. This is the case for Grab’s Geo team as well.&lt;/p&gt;

&lt;p&gt;Traditional map-making methods rely on professional-grade cameras that provide high resolution images to collect mapping imagery. These images are rich in content and detail, providing a good snapshot of the real world. However, we see two major challenges with this approach.&lt;/p&gt;

&lt;p&gt;The first is high cost. Professional cameras are too expensive to use at scale, especially in an emerging region like Southeast Asia. Apart from high equipment cost, operational cost is also high as local operation teams need professional training before collecting imagery.&lt;/p&gt;

&lt;p&gt;The other major challenge, related to the first, is that imagery will not be refreshed in a timely manner because of the high cost and operational effort required. It typically takes months or years before imagery is refreshed, which means maps get outdated easily.&lt;/p&gt;

&lt;p&gt;Compared to traditional collection methods, there are more affordable alternatives that some emerging map providers are using, such as crowdsourced collection done with smartphones or other consumer-grade action cameras. This allows more timely imagery refresh at a much lower cost.&lt;/p&gt;

&lt;p&gt;That said, there are several challenges with crowdsourcing imagery, such as:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Inconsistent quality in collected images.&lt;/li&gt;
  &lt;li&gt;Low operational efficiency as cameras and smartphones are not optimised for mapping.&lt;/li&gt;
  &lt;li&gt;Unreliable location accuracy.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;In order to solve the challenges above, we started building our own artificial intelligence (AI) camera called KartaCam.&lt;/p&gt;

&lt;h2 id=&quot;what-is-kartacam&quot;&gt;What is KartaCam?&lt;/h2&gt;

&lt;p&gt;Designed specifically for map-making, KartaCam is a lightweight camera that is easy to operate. It is everything you need for accurate and efficient image collection. KartaCam is powered by edge AI, and mainly comprises a camera module, a dual-band Global Navigation Satellite System (GNSS) module, and a built-in 4G Long-Term Evolution (LTE) module.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/kartacam-powers-grabmaps/image1.jpg&quot; alt=&quot;&quot; style=&quot;width:30%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;KartaCam&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;h3 id=&quot;camera-module&quot;&gt;Camera module&lt;/h3&gt;

&lt;p&gt;The camera module or optical design of KartaCam focuses on several key features:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Wide field of vision (FOV)&lt;/strong&gt;: A wide FOV to capture as many scenes and details as possible without requiring additional trips. A single KartaCam has a wide lens FOV of &amp;gt;150° and when we use four KartaCams together, each facing a different direction, we increase the FOV to 360°.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;High image quality&lt;/strong&gt;: A combination of high-definition optical lens and a high-resolution pixel image sensor can help to achieve better image quality. KartaCam uses a high-quality 12MP image sensor.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Ease of use&lt;/strong&gt;: Portable and easy to start using for people with little to no photography training. At Grab, we can easily deploy KartaCam to our fleet of driver-partners to map our region as they regularly travel these roads while ferrying passengers or making deliveries.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;edge-ai-for-smart-capturing-on-edge&quot;&gt;Edge AI for smart capturing on edge&lt;/h3&gt;

&lt;p&gt;Each KartaCam device is also equipped with &lt;a href=&quot;https://blogs.nvidia.com/blog/2022/02/17/what-is-edge-ai/&quot;&gt;edge AI&lt;/a&gt;, which enables AI computations to operate closer to the actual data – in our case, imagery collection. With edge AI, we can make decisions about imagery collection (i.e. upload, delete or recapture) at the device-level.&lt;/p&gt;

&lt;p&gt;To help with these decisions, we use a series of edge AI models and algorithms that are executed immediately after each image capture such as:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Scene recognition model&lt;/strong&gt;: For efficient map-making, we ensure that we make the right screen verdicts, meaning we only upload and process the right scene images. Unqualified images such as indoor, raining, and cloudy images are deleted directly on the KartaCam device. Joint detection algorithms are deployed in some instances to improve the accuracy of scene verdicts. For example, to detect indoor recording we look at a combination of driver moving speed, Inertial Measurement Units (IMU) data and edge AI image detection.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Image quality (IQ) checking AI model&lt;/strong&gt;: The quality of the images collected is paramount for map-making. Only qualified images judged by our IQ classification algorithm will be uploaded while those that are blurry or considered low-quality will be deleted. Once an unqualified image is detected (usually within the next second), a new image is captured, improving the success rate of collection.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Object detection AI model&lt;/strong&gt;: Only roadside images that contain relevant map-making content such as traffic signs, lights, and Point of Interest (POI) text are uploaded.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Privacy information detection&lt;/strong&gt;: Edge AI also helps protect privacy when collecting street images for map-making. It automatically blurs private information such as pedestrians’ faces and car plate numbers before uploading, ensuring adequate privacy protection.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/kartacam-powers-grabmaps/image7.png&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;h3 id=&quot;better-positioning-with-a-dual-band-gnssmodule&quot;&gt;Better positioning with a dual-band GNSS module&lt;/h3&gt;

&lt;p&gt;The Global Positioning System (GPS) mainly uses two frequency bands: L1 and L5. Most traditional phone or GPS modules only support the legacy GPS L1 band, while modern GPS modules support both L1 and L5. KartaCam leverages the L5 band which provides improved signal structure, transmission capabilities, and a wider bandwidth that can reduce multipath error, interference, and noise impacts. In addition, KartaCam uses a fine-tuned high-quality ceramic antenna that, together with the dual frequency band GPS module, greatly improves positioning accuracy.&lt;/p&gt;

&lt;h3 id=&quot;keeping-kartacam-connected&quot;&gt;Keeping KartaCam connected&lt;/h3&gt;

&lt;p&gt;KartaCam has a built-in 4G LTE module that ensures it is always connected and can be remotely managed. The KartaCam management portal can monitor camera settings like resolution and capturing intervals, even in edge AI machine learning models. This makes it easy for Grab’s map ops team and drivers to configure their cameras and upload captured images in a timely manner.&lt;/p&gt;

&lt;h2 id=&quot;enhancing-kartacam&quot;&gt;Enhancing KartaCam&lt;/h2&gt;

&lt;h3 id=&quot;kartacam-360-capturing-a-panorama-view&quot;&gt;KartaCam 360: Capturing a panorama view&lt;/h3&gt;

&lt;p&gt;To improve single collection trip efficiency, we group four KartaCams together to collect 360° images. The four cameras can be synchronised within milliseconds and the collected images are stitched together in a panoramic view.&lt;/p&gt;

&lt;p&gt;With KartaCam 360, we can increase the number of images collected in a single trip. According to Grab’s benchmark testing in Singapore and Jakarta, the POI information collected by KartaCam 360 is comparable to that of professional cameras, which cost about 20x more.&lt;/p&gt;

&lt;div align=&quot;middle&quot;&gt;
&lt;img src=&quot;/img/kartacam-powers-grabmaps/image3.png&quot; alt=&quot;&quot; style=&quot;width:30%&quot; /&gt;&lt;img src=&quot;/img/kartacam-powers-grabmaps/image2.jpg&quot; alt=&quot;&quot; style=&quot;width:30%&quot; /&gt;
&lt;/div&gt;
&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;figcaption align=&quot;middle&quot;&gt;KartaCam 360 &amp;amp; Scooter mount&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/kartacam-powers-grabmaps/image8.png&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Image sample from KartaCam 360&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;h2 id=&quot;kartacam-and-the-image-collection-workflow&quot;&gt;KartaCam and the image collection workflow&lt;/h2&gt;

&lt;p&gt;KartaCam, together with other GrabMaps imagery tools, provides a highly efficient, end-to-end, low-cost, and edge AI-powered smart solution to map the region. KartaCam is fully integrated as part of our map-making workflow.&lt;/p&gt;

&lt;p&gt;Our map-making solution includes the following components:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Collection management tool - Platform that defines map collection tasks for our driver-partners.&lt;/li&gt;
  &lt;li&gt;KartaView application - Mobile application provides map collection tasks and handles crowdsourced imagery collection.&lt;/li&gt;
  &lt;li&gt;KartaCam - Camera device connected to KartaView via Bluetooth and equipped with edge automatic processing for imagery capturing according to the task accepted.&lt;/li&gt;
  &lt;li&gt;Camera management tool - Handles camera parameters and settings for all KartaCam devices and can remotely control the KartaCam.&lt;/li&gt;
  &lt;li&gt;Automatic processing - Collected images are processed for quality check, stitching, and personal identification information (PII) blurring.&lt;/li&gt;
  &lt;li&gt;KartaView imagery platform - Processed images are then uploaded and the driver-partner receives payment.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/kartacam-powers-grabmaps/image4.jpg&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;In a future article, we will dive deeper into the technology behind KartaView and its role in GrabMaps.&lt;/p&gt;

&lt;h2 id=&quot;impact&quot;&gt;Impact&lt;/h2&gt;

&lt;p&gt;At the moment, Grab is rolling out thousands of KartaCams to all locations across Southeast Asia where Grab operates. This saves operational costs while improving the efficiency and quality of our data collection.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/kartacam-powers-grabmaps/image10.png&quot; alt=&quot;&quot; style=&quot;width:60%&quot; /&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;h3 id=&quot;better-data-quality-and-moremap-attributes&quot;&gt;Better data quality and more map attributes&lt;/h3&gt;

&lt;p&gt;Due to the excellent image quality, wide FOV coverage, accurate GPS positioning, and sensor data, the 360° images captured by KartaCam 360 also register detailed map attributes like POIs, traffic signs, and address plates. This will help us build a high quality map with rich and accurate content.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/kartacam-powers-grabmaps/image6.png&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;h3 id=&quot;reducing-operational-costs&quot;&gt;Reducing operational costs&lt;/h3&gt;

&lt;p&gt;Based on our research, the hardware cost for KartaCam 360 is significantly lower compared to similar professional cameras in the market. This makes it a more feasible option to scale up in Southeast Asia as the preferred tool for crowdsourcing imagery collection.&lt;/p&gt;

&lt;p&gt;With image quality checks and detection conducted at the edge, we can avoid re-collections and also ensure that only qualified images are uploaded. These result in saving time as well as operational and upload costs.&lt;/p&gt;

&lt;h3 id=&quot;upholding-privacy-standards&quot;&gt;Upholding privacy standards&lt;/h3&gt;

&lt;p&gt;KartaCam automatically blurs captured images that contain PII, like faces and licence plates directly from the edge devices. This means that all sensitive information is removed at this stage and is never uploaded to Grab servers.&lt;/p&gt;

&lt;div align=&quot;middle&quot;&gt;
&lt;img src=&quot;/img/kartacam-powers-grabmaps/image9.png&quot; alt=&quot;&quot; style=&quot;width:40%&quot; /&gt;&lt;img src=&quot;/img/kartacam-powers-grabmaps/image5.png&quot; alt=&quot;&quot; style=&quot;width:40%&quot; /&gt;
&lt;/div&gt;
&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;figcaption align=&quot;middle&quot;&gt;On-the-edge blurring example&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;h2 id=&quot;whats-next&quot;&gt;What’s next?&lt;/h2&gt;

&lt;p&gt;Moving forward, Grab will continue to enhance KartaCam’s performance in the following aspects:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Further improve image quality with better image sensors, unique optical components, and state-of-art Image Signal Processor (ISP).&lt;/li&gt;
  &lt;li&gt;Make KartaCam compatible with Light Detection And Ranging (LIDAR) for high-definition collection and indoor use cases.&lt;/li&gt;
  &lt;li&gt;Improve GNSS module performance with higher sampling frequency and accuracy, and integrate new technology like Real-Time Kinematic (RTK) and Precise Point Positioning (PPP) solutions to further improve the positioning accuracy. When combined with sensor fusion from IMU sensors, we can improve positioning accuracy for map-making further.&lt;/li&gt;
  &lt;li&gt;Improve usability, integration, and enhance imagery collection and portability for KartaCam so driver-partners can easily capture mapping data. &lt;/li&gt;
  &lt;li&gt;Explore new product concepts for future passive street imagery collection.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;To find out more about how KartaCam delivers comprehensive cost-effective mapping data, check out &lt;a href=&quot;https://www.grab.com/sg/enterprise-blog/kartacam-delivers-comprehensive-cost-effective-mapping-data/&quot;&gt;this article&lt;/a&gt;.&lt;/p&gt;

&lt;h1 id=&quot;join-us&quot;&gt;Join us&lt;/h1&gt;

&lt;p&gt;Grab is the leading superapp platform in Southeast Asia, providing everyday services that matter to consumers. More than just a ride-hailing and food delivery app, Grab offers a wide range of on-demand services in the region, including mobility, food, package and grocery delivery services, mobile payments, and financial services across 428 cities in eight countries.&lt;/p&gt;

&lt;p&gt;Powered by technology and driven by heart, our mission is to drive Southeast Asia forward by creating economic empowerment for everyone. If this mission speaks to you, &lt;a href=&quot;https://grab.careers/&quot;&gt;join our team&lt;/a&gt; today!&lt;/p&gt;

&lt;h1 id=&quot;references&quot;&gt;References&lt;/h1&gt;

</description>
        <pubDate>Thu, 01 Dec 2022 01:08:40 +0000</pubDate>
        <link>https://engineering.grab.com/kartacam-powers-grabmaps</link>
        <guid isPermaLink="true">https://engineering.grab.com/kartacam-powers-grabmaps</guid>
        
        <category>Engineering</category>
        
        <category>GrabMaps</category>
        
        <category>KartaCam</category>
        
        <category>Maps</category>
        
        <category>Edge AI</category>
        
        
        <category>Engineering</category>
        
        <category>Product</category>
        
        <category>Design</category>
        
      </item>
    
      <item>
        <title>Graph for fraud detection</title>
        <description>&lt;p&gt;In earlier articles of this series, we’ve covered the &lt;a href=&quot;/graph-networks&quot;&gt;importance of graph networks&lt;/a&gt;, &lt;a href=&quot;/graph-concepts&quot;&gt;graph concepts&lt;/a&gt; and &lt;a href=&quot;/graph-visualisation&quot;&gt;how graph visualisation makes fraud investigations easier and more effective&lt;/a&gt;. In this article, we will explore how we use graph-based models to tackle fraud detection as fraud patterns increase and diversify.&lt;/p&gt;

&lt;p&gt;Grab has grown rapidly in the past few years. It has expanded its business from ride hailing to food and grocery delivery, financial services, and more. Fraud detection is challenging in Grab, because new fraud patterns always arise whenever we introduce a new business product. We cannot afford to develop a new model whenever a new fraud pattern appears as it is time consuming and introduces a cold start problem, that is no protection at the early stage. We need a general fraud detection framework to better protect Grab from various unknown fraud risks.&lt;/p&gt;

&lt;p&gt;Our key observation is that although Grab has many different business verticals, the entities within those businesses are connected to each other (Figure 1. Left), for example, two passengers may be connected by a Wi-Fi router or phone device, a merchant may be connected to a passenger by a food order, and so on. A graph provides an elegant way to capture the spatial correlation among different entities in the Grab ecosystem. A common fraud shows clear patterns on a graph, for example, a fraud syndicate tends to share physical devices, and collusion happens between a merchant and an isolated set of passengers (Figure 1. Right).&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/graph-for-fraud-detection/fig1.png&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Figure 1. Left: The graph captures different correlations in the Grab ecosystem. &lt;br /&gt; Right: The graph shows that common fraud has clear patterns.&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;We believe graphs can help us discover subtle traces and complicated fraud patterns more effectively. Graph-based solutions will be a sustainable foundation for us to fight against known and unknown fraud risks.&lt;/p&gt;

&lt;h2 id=&quot;why-graph&quot;&gt;Why graph?&lt;/h2&gt;

&lt;p&gt;The most common fraud detection methods include the rule engine and the decision tree-based models, for example, boosted tree, random forest, and so on. Rules are a set of simple logical expressions designed by human experts to target a particular fraud problem. They are good for simple fraud detection, but they usually do not work well in complicated fraud or unknown fraud cases.&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Fraud detection methods &lt;br /&gt;&lt;br /&gt;&lt;/th&gt;
      &lt;th&gt;Utilises correlations &lt;br /&gt; (Higher is better)&lt;/th&gt;
      &lt;th&gt;Detects unknown fraud &lt;br /&gt; (Higher is better)&lt;/th&gt;
      &lt;th&gt;Requires feature engineering &lt;br /&gt; (Lower is better)&lt;/th&gt;
      &lt;th&gt;Depends on labels &lt;br /&gt; (Lower is better)&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Rule engine&lt;/td&gt;
      &lt;td&gt;Low&lt;/td&gt;
      &lt;td&gt;N/A&lt;/td&gt;
      &lt;td&gt;N/A&lt;/td&gt;
      &lt;td&gt;Low&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Decision tree&lt;/td&gt;
      &lt;td&gt;Low&lt;/td&gt;
      &lt;td&gt;Low&lt;/td&gt;
      &lt;td&gt;High&lt;/td&gt;
      &lt;td&gt;High&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;Graph model&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;&lt;strong&gt;High&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;&lt;strong&gt;High&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;&lt;strong&gt;Low&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;&lt;strong&gt;Low&lt;/strong&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;br /&gt;
Table 1. Graph vs. common fraud detection methods.&lt;/p&gt;

&lt;p&gt;Decision tree-based models have been dominating fraud detection and Kaggle competitions for structured or tabular data in the past few years. With that said, the performance of a tree-based model is highly dependent on the quality of labels and feature engineering, which is often hard to obtain in real life. In addition, it usually does not work well in unknown fraud which has not been seen in the labels.&lt;/p&gt;

&lt;p&gt;On the other hand, a graph-based model requires little amount of feature engineering and it is applicable to unknown fraud detection with less dependence on labels, because it utilises the structural correlations on the graph.&lt;/p&gt;

&lt;p&gt;In particular, fraudsters tend to show strong correlations on a graph, because they have to share physical properties such as personal identities, phone devices, Wi-Fi routers, delivery addresses, and so on, to reduce cost and maximise revenue as shown in Figure 2 (left). An example of such strong correlations is shown in Figure 2 (right), where the entities on the graph are densely connected, and the known fraudsters are highlighted in red. Those strong correlations on the graph are the key reasons that make the graph based approach a sustainable foundation for various fraud detection tasks.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/graph-for-fraud-detection/fig2.png&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Figure 2. Fraudsters tend to share physical properties to reduce cost (left), and they are densely connected as shown on a graph (right).&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;h1 id=&quot;semi-supervised-graph-learning&quot;&gt;Semi-supervised graph learning&lt;/h1&gt;

&lt;p&gt;Unlike traditional decision tree-based models, the graph-based machine learning model can utilise the graph’s correlations and achieve great performance even with few labels. The semi-supervised Graph Convolutional Network model has been extremely popular in recent years &lt;sup id=&quot;fnref:1&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:1&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;. It has proven its success in many fraud detection tasks across industries, for example, e-commerce fraud, financial fraud, internet traffic fraud, etc.
We apply the Relational Graph Convolutional Network (RGCN) &lt;sup id=&quot;fnref:2&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:2&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt; for fraud detection in Grab’s ecosystem. Figure 3 shows the overall architecture of RGCN. It takes a graph as input, and the graph passes through several graph convolutional layers to get node embeddings. The final layer outputs a fraud probability for each node. At each graph convolutional layer, the information is propagated along the neighbourhood nodes within the graph, that is nodes that are close on the graph are similar to each other.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/graph-for-fraud-detection/fig3.png&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Fig 3. A semi-supervised Relational Graph Convolutional Network model.&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;We train the RGCN model on a graph with millions of nodes and edges, where only a few percentages of the nodes on the graph have labels. The semi-supervised graph model has little dependency on the labels, which makes it a robust model for tackling various types of unknown fraud.&lt;/p&gt;

&lt;p&gt;Figure 4 shows the overall performance of the RGCN model. On the left is the Receiver Operating Characteristic (ROC) curve on the label dataset, in particular, the Area Under the Receiver Operating Characteristic (AUROC) value is close to 1, which means the RGCN model can fit the label data quite well. The right column shows the low dimensional projections of the node embeddings on the label dataset. It is clear that the embeddings of the genuine passenger are well separated from the embeddings of the fraud passenger. The model can distinguish between a fraud and a genuine passenger quite well.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/graph-for-fraud-detection/fig4.png&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Fig 4. Left: ROC curve of the RGCN model on the label dataset. &lt;br /&gt; Right: Low dimensional projections of the graph node embeddings.&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;Finally, we would like to share a few tips that will make the RGCN model work well in practice.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Use less than three convolutional layers&lt;/strong&gt;: The node feature will be over-smoothed if there are many convolutional layers, that is all the nodes on the graph look similar.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Node features are important&lt;/strong&gt;: Domain knowledge of the node can be formulated as node features for the graph model, and rich node features are likely to boost the model performance.&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;graph-explainability&quot;&gt;Graph explainability&lt;/h1&gt;

&lt;p&gt;Unlike other deep network models, graph neural network models usually come with great explainability, that is why a user is classified as fraudulent. For example, fraudulent accounts are likely to share hardware devices and form dense clusters on the graph, and those fraud clusters can be easily spotted on a graph visualiser &lt;sup id=&quot;fnref:4&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:4&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;

&lt;p&gt;Figure 5 shows an example where graph visualisation helps to explain the model prediction scores. The genuine passenger with a low RGCN score does not share devices with other passengers, while the fraudulent passenger with a high RGCN score shares devices with many other passengers, that is, dense clusters.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/graph-for-fraud-detection/fig5.png&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;&lt;figcaption align=&quot;middle&quot;&gt;Figure 5. Upper left: A genuine passenger with a low RGCN score has no device sharing with other passengers. Bottom right: A fraudulent user with a high RGCN score shares devices with many other passengers.&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;h1 id=&quot;closing-thoughts&quot;&gt;Closing thoughts&lt;/h1&gt;

&lt;p&gt;Graphs provide a sustainable foundation for combating many different types of fraud risks. Fraudsters are evolving very fast these days, and the best traditional rules or models can do is to chase after those fraudsters given that a fraud pattern has already been discovered. This is suboptimal as the damage has already been done on the platform. With the help of graph models, we can potentially detect those fraudsters before any fraudulent activity has been conducted, thus reducing the fraud cost.&lt;/p&gt;

&lt;p&gt;The graph structural information can significantly boost the model performance without much dependence on labels, which is often hard to get and might have a large bias in fraud detection tasks. We have shown that with only a small percentage of labelled nodes on the graph, our model can already achieve great performance.&lt;/p&gt;

&lt;p&gt;With that said, there are also many challenges to making a graph model work well in practice. We are working towards solving the following challenges we are facing.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Feature initialisation&lt;/strong&gt;: Sometimes, it is hard to initialise the node feature, for example, a device node does not carry many semantic meanings. We have explored self-supervised pre-training &lt;sup id=&quot;fnref:3&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:3&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;4&lt;/a&gt;&lt;/sup&gt; to help the feature initialisation, and the preliminary results are promising.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Real-time model prediction&lt;/strong&gt;: Realtime graph model prediction is challenging because real-time graph updating is a heavy operation in most cases. One possible solution is to do batch real-time prediction to reduce the overhead.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Noisy connections&lt;/strong&gt;: Some connections on the graph are inherently noisy on the graph, for example, two users sharing the same IP address does not necessarily mean they are physically connected. The IP might come from a mobile network. One possible solution is to use the attention mechanism in the graph convolutional kernel and control the message passing based on the type of connection and node profiles.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;speak-to-us&quot;&gt;Speak to us&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://www.grab.com/sg/business/defence/&quot;&gt;GrabDefence&lt;/a&gt; is a proprietary fraud prevention platform built by Grab, Southeast Asia’s leading superapp. Since 2019, the GrabDefence team has shared its fraud management capabilities and platform with enterprises and startups to leverage Grab’s advanced AI/ML models, hyper local insights and patented device intelligence technologies.&lt;/p&gt;

&lt;p&gt;To learn more about GrabDefence or to speak to our fraud management experts, contact us at &lt;a href=&quot;mailto:gd.contact@grabtaxi.com&quot;&gt;gd.contact@grabtaxi.com&lt;/a&gt;.&lt;/p&gt;

&lt;h1 id=&quot;join-us&quot;&gt;Join us&lt;/h1&gt;

&lt;p&gt;Grab is the leading superapp platform in Southeast Asia, providing everyday services that matter to consumers. More than just a ride-hailing and food delivery app, Grab offers a wide range of on-demand services in the region, including mobility, food, package and grocery delivery services, mobile payments, and financial services across 428 cities in eight countries.&lt;/p&gt;

&lt;p&gt;Powered by technology and driven by heart, our mission is to drive Southeast Asia forward by creating economic empowerment for everyone. If this mission speaks to you, &lt;a href=&quot;https://grab.careers/&quot;&gt;join our team&lt;/a&gt; today!&lt;/p&gt;

&lt;h1 id=&quot;references&quot;&gt;References&lt;/h1&gt;

&lt;div class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;T. Kipf and M. Welling, “Semi-supervised classification with graph convolutional networks,” in ICLR, 2017 &lt;a href=&quot;#fnref:1&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:2&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;Schlichtkrull, Michael, et al. “Modeling relational data with graph convolutional networks.” European semantic web conference. Springer, Cham, 2018. &lt;a href=&quot;#fnref:2&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:4&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;Fujiao Liu, Shuqi Wang, et al.. “&lt;a href=&quot;https://engineering.grab.com/graph-visualisation&quot;&gt;Graph Networks - 10X investigation with Graph Visualisations&lt;/a&gt;”. Grab Tech Blog. &lt;a href=&quot;#fnref:4&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:3&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;Wang, Chen, et al.. “Deep Fraud Detection on Non-attributed Graph.” IEEE Big Data conference, PSBD, 2021. &lt;a href=&quot;#fnref:3&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</description>
        <pubDate>Thu, 24 Nov 2022 00:13:40 +0000</pubDate>
        <link>https://engineering.grab.com/graph-for-fraud-detection</link>
        <guid isPermaLink="true">https://engineering.grab.com/graph-for-fraud-detection</guid>
        
        <category>Analytics</category>
        
        <category>Data Science</category>
        
        <category>Security</category>
        
        <category>Graphs</category>
        
        <category>Graph visualisation</category>
        
        <category>Graph networks</category>
        
        <category>Fraud detection</category>
        
        
        <category>Engineering</category>
        
        <category>Data Science</category>
        
        <category>Security</category>
        
      </item>
    
      <item>
        <title>Query expansion based on user behaviour</title>
        <description>&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;Our consumers used to face a few common pain points while searching for food with the Grab app. Sometimes, the results would include merchants that were not yet operational or locations that were out of the delivery radius. Other times, no alternatives were provided. The search system would also have difficulties handling typos, keywords in different languages, synonyms, and even word spacing issues, resulting in a suboptimal user experience.&lt;/p&gt;

&lt;p&gt;Over the past few months, our search team has been building a query expansion framework that can solve these issues. When a user query comes in, it expands the query to a few related keywords based on semantic relevance and user intention. These expanded words are then searched with the original query to recall more results that are high-quality and diversified. Now let’s take a deeper look at how it works.&lt;/p&gt;

&lt;h1 id=&quot;query-expansion-framework&quot;&gt;Query expansion framework&lt;/h1&gt;

&lt;h2 id=&quot;building-the-query-expansion-corpus&quot;&gt;Building the query expansion corpus&lt;/h2&gt;

&lt;p&gt;We used two different approaches to produce query expansion candidates: manual annotation for top keywords and data mining based on user rewrites.&lt;/p&gt;

&lt;h3 id=&quot;manual-annotation-for-top-keywords&quot;&gt;Manual annotation for top keywords&lt;/h3&gt;

&lt;p&gt;Search has a pronounced fat head phenomenon. The most frequent thousand of keywords account for more than 70% of the total search traffic. Therefore, handling these keywords well can improve the overall search quality a lot. We manually annotated the possible expansion candidates for these common keywords to cover the most popular merchants, items and alternatives. For instance, “McDonald’s” is annotated with {“burger”, “western”}.&lt;/p&gt;

&lt;h3 id=&quot;data-mining-based-on-user-rewrites&quot;&gt;Data mining based on user rewrites&lt;/h3&gt;

&lt;p&gt;We observed that sometimes users tend to rewrite their queries if they are not satisfied with the search result. As a pilot study, we checked the user rewrite records within some user search sessions and found several interesting samples:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;{Ya Kun Kaya Toast,Starbucks}
{healthy,Subway}
{Muni,Muji}
{奶茶,koi}
{Roti,Indian}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We can see that besides spelling corrections, users’ rewrite behaviour also reveals deep semantic relations between these pairs that cannot be easily captured by lexical similarity, such as similar merchants, merchant attributes, language differences, cuisine types, and so on. We can leverage the user’s knowledge to build a query expansion corpus to improve the diversity of the search result and user experience. Furthermore, we can use the wisdom of the crowd to find some common patterns with higher confidence.&lt;/p&gt;

&lt;p&gt;Based on this intuition, we leveraged the high volume of search click data available in Grab to generate high-quality expansion pairs at the user session level. To augment the original queries, we collected rewrite pairs that happened to multiple users and multiple times in a time period. Specifically, we used the heuristic rules below to collect the rewrite pairs:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Select the sessions where there are at least two distinct queries (rewrite session)&lt;/li&gt;
  &lt;li&gt;Collect adjacent query pairs in the search session where the second query leads to a click but the first does not (effective rewrite)&lt;/li&gt;
  &lt;li&gt;Filter out the sample pairs with time interval longer than 30 seconds in between, as users are more likely to change their mind on what to look for in these pairs (single intention)&lt;/li&gt;
  &lt;li&gt;Count the occurrences and filter out the low-frequency pairs (confidence management)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;After we have the mining pairs, we categorised and annotated the rewrite types to gain a deeper understanding of the user’s rewrite behaviour. A few samples mined from the Singapore area data are shown in the table below.&lt;/p&gt;

&lt;table class=&quot;table&quot;&gt;
&lt;thead&gt;
  &lt;tr&gt;
    &lt;th&gt;Original query&lt;/th&gt;
    &lt;th&gt;Rewrite query&lt;/th&gt;
    &lt;th&gt;Frequency in a month&lt;/th&gt;
    &lt;th&gt;Distinct user count&lt;/th&gt;
    &lt;th&gt;Type&lt;/th&gt;
  &lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
    &lt;td&gt;playmade by 丸作&lt;/td&gt;
    &lt;td&gt;playmade&lt;/td&gt;
    &lt;td&gt;697&lt;/td&gt;
    &lt;td&gt;666&lt;/td&gt;
    &lt;td&gt;Drop keywords&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;mcdonald's&lt;/td&gt;
    &lt;td&gt;burger&lt;/td&gt;
    &lt;td&gt;573&lt;/td&gt;
    &lt;td&gt;535&lt;/td&gt;
    &lt;td&gt;Merchant -&amp;gt; Food&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;Bubble tea&lt;/td&gt;
    &lt;td&gt;koi&lt;/td&gt;
    &lt;td&gt;293&lt;/td&gt;
    &lt;td&gt;287&lt;/td&gt;
    &lt;td&gt;Food -&amp;gt; Merchant&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;Kfc&lt;/td&gt;
    &lt;td&gt;McDonald's&lt;/td&gt;
    &lt;td&gt;238&lt;/td&gt;
    &lt;td&gt;234&lt;/td&gt;
    &lt;td&gt;Merchant -&amp;gt; Merchant&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;cake&lt;/td&gt;
    &lt;td&gt;birthday cake&lt;/td&gt;
    &lt;td&gt;206&lt;/td&gt;
    &lt;td&gt;205&lt;/td&gt;
    &lt;td&gt;Add words&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;麦当劳&lt;/td&gt;
    &lt;td&gt;mcdonald's&lt;/td&gt;
    &lt;td&gt;205&lt;/td&gt;
    &lt;td&gt;199&lt;/td&gt;
    &lt;td&gt;Locale change&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;4 fingers&lt;/td&gt;
    &lt;td&gt;4fingers&lt;/td&gt;
    &lt;td&gt;165&lt;/td&gt;
    &lt;td&gt;162&lt;/td&gt;
    &lt;td&gt;Space correction&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;krc&lt;/td&gt;
    &lt;td&gt;kfc&lt;/td&gt;
    &lt;td&gt;126&lt;/td&gt;
    &lt;td&gt;124&lt;/td&gt;
    &lt;td&gt;Spelling correction&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;5 guys&lt;/td&gt;
    &lt;td&gt;five guys&lt;/td&gt;
    &lt;td&gt;120&lt;/td&gt;
    &lt;td&gt;120&lt;/td&gt;
    &lt;td&gt;Number synonym&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;koi the&lt;/td&gt;
    &lt;td&gt;koi thé&lt;/td&gt;
    &lt;td&gt;45&lt;/td&gt;
    &lt;td&gt;44&lt;/td&gt;
    &lt;td&gt;Tone change&lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;We further computed the percentages of some categories, as shown in the figure below.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/query-expansion-based-on-user-behaviour/image1.png&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;
  &lt;figcaption align=&quot;middle&quot;&gt;Figure 1. The donut chart illustrates the percentages of the distinct user counts for different types of rewrites.&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;Apart from adding words, dropping words and spelling corrections, a significant portion of the rewrites are in the category of Other. It is more semantic driven, such as merchant to merchant, or merchant to cuisine. Those rewrites are useful for capturing deeper connections between queries and can be a powerful diversifier to query expansion.&lt;/p&gt;

&lt;h3 id=&quot;grouping&quot;&gt;Grouping&lt;/h3&gt;

&lt;p&gt;After all the rewrite pairs were discovered offline through data mining, we grouped the query pairs by the original query to get the expansion candidates of each query. For serving efficiency, we limited the max number of expansion candidates to three.&lt;/p&gt;

&lt;h2 id=&quot;query-expansion-serving&quot;&gt;Query expansion serving&lt;/h2&gt;

&lt;h3 id=&quot;expansion-matching-architecture&quot;&gt;Expansion matching architecture&lt;/h3&gt;

&lt;p&gt;The expansion matching architecture benefits from the recent search architecture upgrade, where the system flow is changed to a query understanding, multi-recall and result fusion flow. In particular, a query goes through the query understanding module and gets augmented with additional information. In this case, the query understanding module takes in the keyword and expands it to multiple synonyms, for example, KFC will be expanded to fried chicken. The original query together with its expansions are sent together to the search engine under the multi-recall framework. After that, results from multiple recallers with different keywords are fused together.&lt;/p&gt;

&lt;h3 id=&quot;continuous-monitoring-and-feedback-loop&quot;&gt;Continuous monitoring and feedback loop&lt;/h3&gt;

&lt;p&gt;It’s important to make sure the expansion pairs are relevant and up-to-date. We run the data mining pipeline periodically to capture the new user rewrite behaviours. Meanwhile, we also monitor the expansion pairs’ contribution to the search result by measuring the net contribution of recall or user interaction that the particular query brings, and eliminate the obsolete pairs in an automatic way. This reflects our effort to build an adaptive system.&lt;/p&gt;

&lt;h1 id=&quot;results&quot;&gt;Results&lt;/h1&gt;

&lt;p&gt;We conducted online A/B experiments across 6 countries in Southeast Asia to evaluate the expanded queries generated by our system. We set up 3 groups:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Control group, where no query is expanded.&lt;/li&gt;
  &lt;li&gt;Treatment group 1, where we expanded the queries based on manual annotations only.&lt;/li&gt;
  &lt;li&gt;Treatment group 2, where we expanded the queries using the data mining approach.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;We observed decent uplift in click-through rate and conversion rate from both treatment groups. Furthermore, in treatment group 2, the data mining approach produced even better results.&lt;/p&gt;

&lt;h1 id=&quot;future-work&quot;&gt;Future work&lt;/h1&gt;

&lt;h2 id=&quot;data-mining-enhancement&quot;&gt;Data mining enhancement&lt;/h2&gt;

&lt;p&gt;Currently, the data mining approach can only identify the pairs from the same search session by one user. This limits the number of linked pairs. Some potential enhancements include:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Augment expansion pairs by associating queries from different users who click on the same merchant/item, for example, using a click graph. This can capture relevant queries across user sessions.&lt;/li&gt;
  &lt;li&gt;Build a probabilistic model on top of the current transition pairs. Currently, all the transition pairs are equally weighted but apparently, the transitions that happen more often should carry higher probability/weights.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;ads-application&quot;&gt;Ads application&lt;/h2&gt;

&lt;p&gt;Query expansion can be applied to advertising and would increase ads fill rate. With “KFC” expanded to “fried chicken”, the sponsored merchants who buy the keyword “fried chicken” would be eligible to show up when the user searches “KFC”. This would enable Grab to provide more relevant sponsored content to our users, which helps not only the consumers but also the merchants.&lt;/p&gt;

&lt;p&gt;&lt;small class=&quot;credits&quot;&gt;Special thanks to Zhengmin Xu and Daniel Ng for proofreading this article.&lt;/small&gt;&lt;/p&gt;

&lt;h1 id=&quot;join-us&quot;&gt;Join us&lt;/h1&gt;
&lt;p&gt;Grab is the leading superapp platform in Southeast Asia, providing everyday services that matter to consumers. More than just a ride-hailing and food delivery app, Grab offers a wide range of on-demand services in the region, including mobility, food, package and grocery delivery services, mobile payments, and financial services across 428 cities in eight countries.&lt;/p&gt;

&lt;p&gt;Powered by technology and driven by heart, our mission is to drive Southeast Asia forward by creating economic empowerment for everyone. If this mission speaks to you, &lt;a href=&quot;https://grab.careers/&quot;&gt;join our team&lt;/a&gt; today!&lt;/p&gt;
</description>
        <pubDate>Wed, 16 Nov 2022 00:29:00 +0000</pubDate>
        <link>https://engineering.grab.com/query-expansion-based-on-user-behaviour</link>
        <guid isPermaLink="true">https://engineering.grab.com/query-expansion-based-on-user-behaviour</guid>
        
        <category>Analytics</category>
        
        <category>Data Science</category>
        
        
        <category>Engineering</category>
        
        <category>Data Science</category>
        
      </item>
    
      <item>
        <title>Using mobile sensor data to encourage safer driving</title>
        <description>&lt;p&gt;“Telematics”, a cross between the words &lt;em&gt;telecommunications&lt;/em&gt; and &lt;em&gt;informatics&lt;/em&gt;, was coined in the late 1970s to refer to the use of communication technologies in facilitating exchange of information. In the modern day, such technologies may include cloud platforms, mobile networks, and wireless transmissions (e.g., Bluetooth). Although the initial intention is for a more general scope, telematics is now specifically used to refer to vehicle telematics where details of vehicle movements are tracked for use cases such as driving safety, driver profiling, fleet optimisation, and productivity improvements.&lt;/p&gt;

&lt;p&gt;We’ve previously published &lt;a href=&quot;https://engineering.grab.com/telematics-at-grab&quot;&gt;this article&lt;/a&gt; to share how Grab uses telematics to improve driver safety. In this blog post, we dive deeper into how telematics technology is used at Grab to encourage safer driving for our driver and delivery partners.&lt;/p&gt;

&lt;h1 id=&quot;background&quot;&gt;Background&lt;/h1&gt;

&lt;p&gt;At Grab, the safety of our users and their experience on our platform is our highest priority. By encouraging safer driving habits from our driver and delivery partners, road traffic accidents can be minimised, potentially reducing property damage, injuries, and even fatalities. Safe driving also helps ensure smoother rides and a more pleasant experience for consumers using our platform.&lt;/p&gt;

&lt;p&gt;To encourage safer driving, we should:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Have a data-driven approach to understand how our driver and delivery partners are driving.&lt;/li&gt;
  &lt;li&gt;Help partners better understand how to improve their driving by summarising key driving history into a personalised &lt;strong&gt;Driving Safety Report&lt;/strong&gt;.&lt;/li&gt;
&lt;/ol&gt;

&lt;h1 id=&quot;understanding-driving-behaviour&quot;&gt;Understanding driving behaviour&lt;/h1&gt;

&lt;p&gt;One of the most direct forms of driving assessment is consumer feedback or complaints. However, the frequency and coverage of this feedback is not very high as they are only applicable to transport verticals like JustGrab or GrabBike and not delivery verticals like GrabFood or GrabExpress. Plus, most driver partners tend not to receive any driving-related feedback (whether positive or negative), even for the transport verticals.&lt;/p&gt;

&lt;p&gt;A more comprehensive method of assessing driving behaviour is to use the driving data collected during Grab bookings. To make sense of these data, we focus on selected driving manoeuvres (e.g., braking, acceleration, cornering, speeding) and detect the number of instances where our data shows unsafe driving in each of these areas.&lt;/p&gt;

&lt;p&gt;We acknowledge that the detected instances may be subjected to errors and may not provide the complete picture of what’s happening on the ground (e.g., partners may be forced to do an emergency brake due to someone swerving into their lane).&lt;/p&gt;

&lt;p&gt;To address this, we have incorporated several fail-safe checks into our detection logic to minimise erroneous detection. Also, any assessment of driving behaviour will be based on an aggregation of these unsafe driving instances over a large amount of driving data. For example, individual harsh braking instances may be inconclusive but if a driver partner displays multiple counts consistently across many bookings, it is likely that the partner may be used to unsafe driving practices like tailgating or is distracted while driving.&lt;/p&gt;

&lt;h1 id=&quot;telematics-for-detecting-unsafe-driving&quot;&gt;Telematics for detecting unsafe driving&lt;/h1&gt;

&lt;p&gt;For Grab to consistently ensure our consumers’ safety, we need to proactively detect unsafe driving behaviour before an accident occurs. However, it is not feasible for someone to be with our driver and delivery partners all the time to observe their driving behaviour. We should leverage sensor data to monitor these driving behaviour at scale.&lt;/p&gt;

&lt;p&gt;Traditionally, a specialised “black box” inertial measurement unit (IMU) equipped with sensors such as accelerometers, gyroscopes, and GPS needs to be installed in alignment with the vehicle to directly measure vehicular acceleration and speed. In this manner, it would be straightforward to detect unsafe driving instances using this data. Unfortunately, the cost of purchasing and installing such devices for all our partners is prohibitively high and it would be hard to scale.&lt;/p&gt;

&lt;p&gt;Instead, we can leverage a device that all partners already have: their mobile phone. Modern smartphones already contain similar sensors to those in IMUs and data can be collected through the telematics SDK. More details on telematics data collection can be found in a recently published Grab tech blog article&lt;sup id=&quot;fnref:1&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:1&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;

&lt;p&gt;It’s important to note that telematics data are collected at a sufficiently high sampling frequency (much more than 1 Hz) to minimise inaccuracies in detecting unsafe driving instances characterised by sharp acceleration impulses.&lt;/p&gt;

&lt;h2 id=&quot;processing-mobile-sensor-data-to-detect-unsafe-driving&quot;&gt;Processing mobile sensor data to detect unsafe driving&lt;/h2&gt;

&lt;p&gt;Unlike specialised IMUs installed in vehicles, mobile sensor data have added challenges to detecting unsafe driving.&lt;/p&gt;

&lt;h3 id=&quot;accounting-for-orientation-phone-vs-vehicle&quot;&gt;Accounting for orientation: Phone vs. vehicle&lt;/h3&gt;

&lt;p&gt;The phone is usually in a different orientation compared to the vehicle. Strictly speaking, the phone accelerometer sensor measures the accelerations of the phone and not the vehicle acceleration. To infer vehicle acceleration from phone sensor data, we developed a customised processing algorithm optimised specifically for Grab’s data.&lt;/p&gt;

&lt;p&gt;First, the orientation offset of the phone with respect to the vehicle is defined using Euler angles: roll, pitch and yaw. In data windows with no net acceleration of the vehicle (e.g., no braking, turning motion), the only acceleration measured by the accelerometer is gravitational acceleration. Roll and pitch angles can then be determined through trigonometric manipulation. The complete triaxial accelerations of the phone are then rotated to the horizontal plane and the yaw angle is determined by principal component analysis (PCA).&lt;/p&gt;

&lt;p&gt;An assumption here is that there will be sufficient braking and acceleration manoeuvring for PCA to determine the correct forward direction. This Euler angles determination is done periodically to account for any movement of phones during the trip. Finally, the raw phone accelerations are rotated to the vehicle orientation through a matrix multiplication with the rotation matrix derived from the Euler angles (see Figure 1).&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/using-mobile-sensor-data-to-encourage-safer-driving/image1.png&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;
  &lt;figcaption align=&quot;middle&quot;&gt;Figure 1: Inference of vehicle acceleration from the phone sensor data. &lt;a href=&quot;https://www.freepik.com/free-psd/isometric-minimal-3d-phone-with-rrss-interface-mockup-levitating_13195223.htm&quot;&gt;Smartphone&lt;/a&gt; and &lt;a href=&quot;https://www.freepik.com/free-vector/white-sports-car-isolated-white-vector_3529812.htm&quot;&gt;car&lt;/a&gt; images modified from designs found in Freepik.com.&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;h3 id=&quot;handling-variations-in-data-quality&quot;&gt;Handling variations in data quality&lt;/h3&gt;

&lt;p&gt;Our processing algorithm is optimised to be highly robust and handle large variations in data quality that is expected from bookings on the Grab platform. There are many reported methods for processing mobile data to reorientate telematics data for four wheel vehicles&lt;sup id=&quot;fnref:2&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:2&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;sup id=&quot;fnref:3&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:3&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;

&lt;p&gt;However, with the prevalent use of motorcycles on our platform, especially for delivery verticals, we observed that data collected from two wheel vehicles tend to be noisier due to differences in phone stability and vehicular vibrations. Data noise can be exacerbated if partners hold the phone in their hand or place it in their pockets while driving.&lt;/p&gt;

&lt;p&gt;In addition, we also expect a wide variation in data quality and sensor availability from different phone models, such as older, low-end models to the newest, flagship models. A good example to illustrate the robustness of our algorithm is having different strategies to handle different degrees of data noise. For example, a simple low-pass filter is used for low noise data, while more complex variational decomposition and Kalman filter approaches are used for high noise data.&lt;/p&gt;

&lt;h3 id=&quot;detecting-behaviour-anomalies-with-thresholds&quot;&gt;Detecting behaviour anomalies with thresholds&lt;/h3&gt;

&lt;p&gt;Once the vehicular accelerations are inferred, we can use a thresholding approach (see Figure 2) to detect unsafe driving instances.&lt;/p&gt;

&lt;p&gt;For unsafe acceleration and braking, a peak finding algorithm is used to detect acceleration peaks beyond a threshold in the longitudinal (forward/backward) direction. For unsafe cornering, older and lower end phones are usually not equipped with gyroscope sensors, so we should look for peaks of lateral (sidewards) acceleration (which constitutes the centripetal acceleration during the turn) beyond a threshold. GPS bearing data that coarsely measures the orientation of the vehicle is then used to confirm that a cornering and not lane change instance is being detected. The thresholds selected are fine-tuned on Grab’s data using initial values based on published literature&lt;sup id=&quot;fnref:4&quot; role=&quot;doc-noteref&quot;&gt;&lt;a href=&quot;#fn:4&quot; class=&quot;footnote&quot; rel=&quot;footnote&quot;&gt;4&lt;/a&gt;&lt;/sup&gt; and other sources.&lt;/p&gt;

&lt;p&gt;To reduce false positive detection, no unsafe driving instances will be flagged when:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Large discrepancies are observed between speeds derived from integrating the longitudinal (forward/backward) acceleration and speeds directly measured by the GPS sensor.&lt;/li&gt;
  &lt;li&gt;Large phone motions are detected. For example, when the phone falls to the seat from the dashboard, accelerations recorded on the phone sensor will deviate significantly from the vehicle accelerations.&lt;/li&gt;
  &lt;li&gt;GPS speed is very low before and after the unsafe driving instance is detected. This is limited to data collected from motorcycles which is usually used by delivery partners. It implies that the partner is walking and not in a vehicle. For example, a GrabFood delivery partner may be collecting the food from the merchant partner on foot, so no unsafe driving instances should be detected.&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/using-mobile-sensor-data-to-encourage-safer-driving/image2.gif&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;
  &lt;figcaption align=&quot;middle&quot;&gt;Figure 2: Animation showing unsafe driving detection by thresholding. Dotted lines in acceleration charts indicate selected thresholds. Map tiles by stamen design.&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;h2 id=&quot;detecting-speeding-instances-from-gps-speeds-and-map-data&quot;&gt;Detecting speeding instances from GPS speeds and map data&lt;/h2&gt;

&lt;p&gt;To define speeding along a stretch of road, we used a rule-based method by comparing raw speeds from GPS pings with speeding thresholds for that road. Although GPS speeds are generally accurate (subjected to minimal GPS errors), we need to take more precautions to ensure the right speeding thresholds are determined.&lt;/p&gt;

&lt;p&gt;These thresholds are set using known speed limits from available map data or hourly aggregated speed statistics where speed limits are not available. The coverage and accuracy of known speed limits is continuously being improved by our in-house mapping initiatives and  validated comprehensively by the respective local ground teams in selected cities.&lt;/p&gt;

&lt;p&gt;Aggregating GPS pings from Grab driver and delivery partners can be a helpful proxy to actual speed limits by defining speeding violations as outliers from socially acceptable speeds derived from partners collectively. To reliably compute aggregated speed statistics, a representative speed profile for each stretch of road must first be inferred from raw GPS pings (see Figure 3).&lt;/p&gt;

&lt;p&gt;As ping sampling intervals are fixed, more pings tend to be recorded for slower speeds. To correct the bias in the speed profile, we reweigh ping counts by using speed values as weights. Furthermore, to minimise distortions in the speed profile from vehicles driving at lower-than-expected speeds due to high traffic volumes, only pings from free-flowing traffic are used when inferring the speed profile.&lt;/p&gt;

&lt;p&gt;Free-flowing traffic is defined by speeds higher than the median speed on each defined road category (e.g., small residential roads, normal primary roads, large expressways). To ensure extremely high speeds are flagged regardless of the speed of other drivers, maximum threshold values for aggregated speeds are set for each road category using heuristics based on the maximum known speed limit of that road category.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/using-mobile-sensor-data-to-encourage-safer-driving/image4.png&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;
  &lt;figcaption align=&quot;middle&quot;&gt;Figure 3: Steps to infer a representative speed profile for computing aggregated speed statistics.&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;p&gt;Besides a representative speed profile, hourly aggregation should also include data from a sufficient number of unique drivers depending on speed variability. To obtain enough data, hourly aggregations are performed on the same day of the week over multiple weeks. This way, we have a comprehensive time-specific speed profile that accounts for traffic quality (e.g., peak hour traffic, traffic differences between weekdays/weekends) and driving conditions (e.g., visibility difference between day/night).&lt;/p&gt;

&lt;p&gt;When detecting speeding violations, the GPS pings used are snapped-to-road and stationary pings, pings with unrealistic speeds, while pings with low GPS accuracy (e.g., when the vehicle is in a tunnel) are excluded. A speeding violation is defined as a sequence of consecutive GPS pings that exceed the speeding threshold. The following checks were put in place to minimise erroneous flagging of speeding violations:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Removal of duplicated (or stale) GPS pings.&lt;/li&gt;
  &lt;li&gt;Sufficient speed buffer given to take into account GPS errors.&lt;/li&gt;
  &lt;li&gt;Sustained speeding for a prolonged period of time is required to exclude transient speeding events (e.g., during lane change).&lt;/li&gt;
&lt;/ol&gt;

&lt;h1 id=&quot;driving-safety-report&quot;&gt;Driving safety report&lt;/h1&gt;

&lt;p&gt;The driving safety report is a platform safety product that driver and delivery partners can access via their driver profile page on the Grab Driver Application (see Figure 4). It is updated daily and aims to create awareness regarding driving habits by summarising key information from the processed data into a personalised report that can be easily consumed.&lt;/p&gt;

&lt;p&gt;Individual reports of each driving manoeuvre (e.g., braking, acceleration, cornering and speeding) are available for daily and weekly views. Partners can also get more detailed information of each individual instance such as when these unsafe driving instances were detected.&lt;/p&gt;

&lt;div class=&quot;post-image-section&quot;&gt;&lt;figure&gt;
  &lt;img src=&quot;/img/using-mobile-sensor-data-to-encourage-safer-driving/image5.png&quot; alt=&quot;&quot; style=&quot;width:80%&quot; /&gt;
  &lt;figcaption align=&quot;middle&quot;&gt;Figure 4: Driving safety report for driver and delivery partners using four wheel vehicles. a) Actionable insights feature circled by red dotted lines. b) Daily view of various unsafe driving instances where more details of each instance can be viewed by tapping on “See details”.&lt;/figcaption&gt;
  &lt;/figure&gt;
&lt;/div&gt;

&lt;h2 id=&quot;actionable-insights&quot;&gt;Actionable insights&lt;/h2&gt;

&lt;p&gt;Besides compiling the instances of unsafe driving in a report to create awareness, we are also using these data to provide some actionable recommendations for our partners to improve their driving.&lt;/p&gt;

&lt;p&gt;With unsafe driving feedback from consumers and reported road traffic accident data from our platform, we also train machine learning models to identify patterns in the detected unsafe driving instances and estimate the likelihood of partners receiving unsafe driving feedback or getting into accidents. One use case is to compute a safe driving score that equates a four-wheel partner’s driving behaviour to a numerical value where a higher score indicates a safer driver.&lt;/p&gt;

&lt;p&gt;Additionally, we use Shapley additive explanation (SHAP) approaches to determine which driving manoeuvre contributes the most to increasing the likelihood of partners receiving unsafe driving feedback or getting into accidents. This information is included as an actionable insight in the driving safety report and helps partners to identify the key area to improve their driving.&lt;/p&gt;

&lt;h1 id=&quot;whats-next&quot;&gt;What’s next?&lt;/h1&gt;

&lt;p&gt;At the moment, Grab performs telematics processing and unsafe driving detections after the trip and updates the report the next day. One of the biggest improvements would be to share this information with partners faster. We are actively working on developing a real-time processing algorithm that addresses this and also, satisfies the robustness requirements such that partners are immediately aware after an unsafe driving instance is detected.&lt;/p&gt;

&lt;p&gt;Besides detecting typical unsafe driving manoeuvres, we are also exploring other use cases for mobile sensor data in road safety such as detection of poor road conditions, counterflow driving against traffic, and phone usage leading to distracted driving.&lt;/p&gt;

&lt;h1 id=&quot;join-us&quot;&gt;Join us&lt;/h1&gt;

&lt;p&gt;Grab is the leading superapp platform in Southeast Asia, providing everyday services that matter to consumers. More than just a ride-hailing and food delivery app, Grab offers a wide range of on-demand services in the region, including mobility, food, package and grocery delivery services, mobile payments, and financial services across 428 cities in eight countries.&lt;/p&gt;

&lt;p&gt;Powered by technology and driven by heart, our mission is to drive Southeast Asia forward by creating economic empowerment for everyone. If this mission speaks to you, &lt;a href=&quot;https://grab.careers/&quot;&gt;join our team&lt;/a&gt; today!&lt;/p&gt;

&lt;h1 id=&quot;references&quot;&gt;References&lt;/h1&gt;

&lt;div class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;Burhan, W. (2022). How telematics helps Grab to improve safety. Grab Tech Blog. https://engineering.grab.com/telematics-at-grab &lt;a href=&quot;#fnref:1&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:2&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;Mohan, P., Padmanabhan, V.N. and Ramjee, R. (2008).Nericell: rich monitoring of road and traffic conditions using mobile smartphones. SenSys ‘08: Proceedings of the 6th ACM conference on Embedded network sensor systems, 312-336. https://doi.org/10.1145/1460412.1460444 &lt;a href=&quot;#fnref:2&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:3&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;Sentiance (2016). Driving behavior modeling using smart phone sensor data. Sentiance Blog. https://sentiance.com/2016/02/11/driving-behavior-modeling-using-smart-phone-sensor-data/ &lt;a href=&quot;#fnref:3&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:4&quot; role=&quot;doc-endnote&quot;&gt;
      &lt;p&gt;Yarlagadda, J. and Pawar, D.S. (2022). Heterogeneity in the Driver Behavior: An Exploratory Study Using Real-Time Driving Data. Journal of Advanced Transportation. vol. 2022, Article ID 4509071. https://doi.org/10.1155/2022/4509071 &lt;a href=&quot;#fnref:4&quot; class=&quot;reversefootnote&quot; role=&quot;doc-backlink&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;
</description>
        <pubDate>Tue, 25 Oct 2022 11:30:00 +0000</pubDate>
        <link>https://engineering.grab.com/using-mobile-sensor-data-to-encourage-safer-driving</link>
        <guid isPermaLink="true">https://engineering.grab.com/using-mobile-sensor-data-to-encourage-safer-driving</guid>
        
        <category>Analytics</category>
        
        <category>Driving patterns</category>
        
        <category>Data Science</category>
        
        <category>GPS</category>
        
        <category>Security</category>
        
        
        <category>Engineering</category>
        
        <category>Data Science</category>
        
        <category>Security</category>
        
      </item>
    
  </channel>
</rss>
