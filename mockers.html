<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Mockers - Overcoming Testing Challenges at Grab</title>
    <meta name="description" content="Sustaining quality in fast paced development is a challenge. At Grab, we use Mockers - a tool to expand the scope of local box testing. It helps us overcome testing challenges in a microservice architecture.">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- Open Graph -->
    <meta property="og:url" content="https://engineering.grab.com/mockers">
    <meta property="og:title" content="Mockers - Overcoming Testing Challenges at Grab">
    <meta property="og:description" content="Sustaining quality in fast paced development is a challenge. At Grab, we use Mockers - a tool to expand the scope of local box testing. It helps us overcome testing challenges in a microservice architecture.">
    <meta property="og:site_name" content="Grab Tech">
    <meta property="og:type" content="article">
    <meta property="og:image" content="https://engineering.grab.com/img/mockers/cover.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">

    <!-- Favicons -->
    <link rel="icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">

    <!-- CSS -->
    <link href="//fonts.googleapis.com/css?family=Droid+Serif:400,400i,700,700i" rel="stylesheet">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap-theme.min.css">
    <script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="https://engineering.grab.com/mockers">

    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title="RSS for Official Grab Tech Blog" href="/feed.xml">
    <!-- OneTrust Cookies Consent Notice start for grab.com -->
    <script type="text/javascript" src="https://cdn-apac.onetrust.com/consent/a3be3527-7455-48e0-ace6-557ddbd506d5/OtAutoBlock.js" ></script>
    <script src="https://cdn-apac.onetrust.com/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="a3be3527-7455-48e0-ace6-557ddbd506d5" ></script>
    <script type="text/javascript">
    function OptanonWrapper() { }
    </script>
    <!-- OneTrust Cookies Consent Notice end for grab.com -->
  </head>

  <body>
    <header class="site-header">
  <div class="wrapper-navbar">
    <div class="site-title-wrapper">
      <div class="row site-title-wrapper-inner">
        <div class="col-xs-1 visible-xs hamburger-nav" id="mobile-menu-btn">
          <div class="menu-btn"></div>
        </div>
        <div class="col-sm-3 col-xs-3">
          <div class="site-title-container">
            <a class="site-title" href="/"></a>
            <span class="site-subtitle">&nbsp;Tech Blog</span>
          </div>
        </div>
        <div class="col-sm-9 col-xs-8 text-right">
          <ul class="nav-category hidden-xs">
            
              
              <li>
                <a href="/categories/engineering/">Engineering</a>
              </li>
            
              
              <li>
                <a href="/categories/data-science/">Data Science</a>
              </li>
            
              
              <li>
                <a href="/categories/design/">Design</a>
              </li>
            
              
              <li>
                <a href="/categories/product/">Product</a>
              </li>
            
              
              <li>
                <a href="/categories/security/">Security</a>
              </li>
            
          </ul>
          <div class="site-search text-right">
            <form action="/search.html" role="search" class="search-form">
  <div class="search-icon"> </div>
  <input type="search" name="q" class="search-text" placeholder="Search...">
  <button class="search-submit"><i class="fa fa-chevron-right"></i></button>
</form>
    

          </div>
        </div>
      </div>
      <!--  Only visible on mobile view -->
      <div class="mobile-menu-container">
        <ul class="mobile-menu">
          
            
            <li>
              <a href="/categories/engineering/">Engineering</a>
            </li>
          
            
            <li>
              <a href="/categories/data-science/">Data Science</a>
            </li>
          
            
            <li>
              <a href="/categories/design/">Design</a>
            </li>
          
            
            <li>
              <a href="/categories/product/">Product</a>
            </li>
          
            
            <li>
              <a href="/categories/security/">Security</a>
            </li>
          
        </ul>
      </div>
    </div>
  </div>
</header>
<script src="/js/main.js"></script>

    <div class="page-content">
      
<div class="wrapper">
  <div class="post">
    <header class="post-header">
      <img src="/img/mockers/cover.jpg" class="post-cover-photo" alt="Mockers - Overcoming Testing Challenges at Grab cover photo">
      
        
          <a class="post-category" href="/categories/engineering/">Engineering </a>
      

      <h1 class="post-title">Mockers - Overcoming Testing Challenges at Grab</h1>
      
      <div class="post-meta">
        <div class="row">
          <div class="col-xs-12">
            <div class="post-author-thumbnail-container">
              
                
                
                  <img class="post-author-thumbnail-large img-circle" src="/img/authors/mayank-gupta.jpg">
                
              
                
                
                  <img class="post-author-thumbnail-large img-circle" src="/img/authors/vineet-nair.jpg">
                
              
                
                
                  <img class="post-author-thumbnail-large img-circle" src="/img/authors/shivkumar-krishnan.jpg">
                
              
                
                
                  <img class="post-author-thumbnail-large img-circle" src="/img/authors/thuy-nguyent.jpg">
                
              
                
                
                  <img class="post-author-thumbnail-large img-circle" src="/img/authors/vishal-prakash.jpg">
                
              
            </div>

            <div class="post-meta-text-container">
              <span class="post-author-large">
                
                  
                  
                    
                    <a href="/authors#mayank-gupta">Mayank Gupta</a>
                  
                
                  
                  
                    
                      &middot;
                    
                    <a href="/authors#vineet-nair">Vineet Nair</a>
                  
                
                  
                  
                    
                      &middot;
                    
                    <a href="/authors#shivkumar-krishnan">Shivkumar Krishnan</a>
                  
                
                  
                  
                    
                      &middot;
                    
                    <a href="/authors#thuy-nguyent">Thuy Nguyen</a>
                  
                
                  
                  
                    
                      &middot;
                    
                    <a href="/authors#vishal-prakash">Vishal Prakash</a>
                  
                
              </span>
              <span class="post-date-large">18 Sep 2018 | 9 min read</span>
            </div>
          </div>
        </div>
      </div>

    </header>
    <div class="wrapper-content">
      <article class="post-content">
        <p>Grab serves millions of consumers in Southeast Asia, taking care of their everyday needs such as rides, food delivery, logistics, financial services, and cashless payments.</p>

<p>To delight our consumers, we’re always looking at new features to launch, or how we can improve existing features. This means we need to develop fast, but also at high quality - which is not an easy balance to strike. To tackle this, we innovated around testing, resulting in Mockers - a tool to expand the scope of local box testing. In local box testing, developers can test their microservices without depending on an integrated test environment. It is an approach to implement Shift Left testing, in which testing is performed earlier in the product life cycle. Early testing makes it easier and less expensive to fix bugs.</p>

<p>Grab employs a microservice architecture with over 250 microservices working together. Think of our application as a clockwork with coordinating gears. Each gear may evolve and change over time, but the overall system continues to work.</p>

<p><img src="/img/mockers/image_1.png" alt="" /></p>

<p>Each microservice runs on its own and communicates with others through lightweight protocols like HTTP and gRPC, and each has its own development life cycle. This architecture allows Grab to quickly scale its applications. It takes less time to implement and deploy a new feature as a microservice.</p>

<p>However the complexity of a microservices architecture makes testing much harder. Here are some common challenges:</p>

<ul>
  <li>
    <p>Each team is responsible only for its microservices, so there’s little centralised management.</p>
  </li>
  <li>
    <p>Teams use different programming languages, data stores, etc. for each microservice, so it’s hard to construct and maintain a good test environment that covers everything.</p>
  </li>
  <li>
    <p>Some microservices have been around since the start, some were created last week, some were refactored a month ago. This means they may be at very different maturity levels.</p>
  </li>
  <li>
    <p>As the number of microservices keeps growing, so does the number of tests needed for coverage.</p>
  </li>
</ul>

<h2 id="why-conventional-testing-is-not-enough">Why Conventional Testing is Not Enough</h2>

<p>The conventional approach to testing involves heavy unit testing on local boxes, and maintains one or more test environments with all microservices  - these are usually called staging environments. Teams run integration, contract, and other tests on the staging environment, making it the primary test area. After comprehensive testing on staging, teams promote the microservice to production. Once it reaches production, very little or no testing is done.</p>

<p>(The testing terminologies used here such as unit tests, integration tests, contract tests, etc are defined in <a href="http://www.testingstandards.co.uk/bs_7925-1_online.htm">http://www.testingstandards.co.uk/bs_7925-1_online.htm</a> and <a href="https://martinfowler.com/bliki/ContractTest.html">https://martinfowler.com/bliki/ContractTest.html</a>.)</p>

<p><img src="/img/mockers/image_2.png" alt="" /></p>

<p>However, testing on a staging environment has its limitations:</p>

<ul>
  <li>
    <p><strong>Ambiguity of ownership</strong> - Staging is usually nobody’s responsibility as there is no centralized management. Issues on staging take longer to resolve because questions such as ‘who fixes’, ‘who coordinates’, and ‘who maintains’ can go unanswered. Further, one failed microservice results in a testing blocker as many microservices may depend on it.</p>
  </li>
  <li>
    <p><strong>High cost of finding and fixing bugs</strong> - Staging is where teams try to uncover complex bugs. Quite often, the cost of testing and debugging is high and confidence over results is low because:</p>

    <ul>
      <li>
        <p>State of test environment is constantly changing as independent teams deploy their microservices, leading to false test failures</p>
      </li>
      <li>
        <p>Data and configuration become inconsistent over time due to:</p>

        <ul>
          <li>
            <p>Orphaned testing that leaves data inconsistent across microservices</p>
          </li>
          <li>
            <p>Multiple users overusing staging for different purposes such as manual testing, providing demos and training, etc</p>
          </li>
          <li>
            <p>Manually hacking or hard coding data to simulate dependent functionality</p>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>Difficulty in testing negative cases</strong> - How would my microservice respond if the dependency times out or returns a bad response, or if the response payload is too big? Such negative cases are hard to simulate in staging as they either require extensive data set up or an intentional dependency failure.</p>
  </li>
</ul>

<h2 id="introducing-mockers---now-you-can-run-your-tests-locally">Introducing Mockers - Now You can Run Your Tests Locally</h2>

<p>Mockers is a Go SDK coupled with a CLI tool for managing a central monorepo of mock servers at Grab.</p>

<p>Mockers simulates a staging environment on developer local boxes. It expands the scope of testing at the local box level, and lets you run functional, resiliency, and contract tests on local boxes or on your CI (Continuous Integration) such as Jenkins. This enables you to catch complex bugs at lower costs as bugs are now found much earlier in the development life cycle. This key advantage makes Mockers a better testing tool than the conventional approach where testing primarily happens on staging, resulting in higher costs.</p>

<p>It lets you create mock servers for mimicking the behaviour of your microservice dependencies, and you can easily set positive or negative expectations in your tests to simulate complex scenarios.</p>

<p><img src="/img/mockers/image_3.png" alt="" /></p>

<p>The idea is to have one standard mock server per microservice at Grab, kept up-to-date with the microservice definition. Our monorepo makes any new mock server available to all teams for testing.</p>

<p>Mockers generates mock servers for both HTTP and gRPC microservices. To set up a mock server for a HTTP microservice, you need to provide its API Swagger specification. For a gRPC mock server, you need to provide the protobuf file.</p>

<p>Simple CLI commands in Mockers let you generate or update mock servers with the latest microservice definitions, as well as list all available mock servers.</p>

<p>Here is an example for generating a gRPC mock server. The path to the protobuf file, in this case &lt;gitlab.net/…/pb&gt;, is provided in the servergen command.</p>

<p><img src="/img/mockers/image_4.png" alt="" /></p>

<p><img src="/img/mockers/image_5.png" alt="" /></p>

<p>The Go SDK sets expectations for testing, and manages the mock server life cycle.</p>

<p>For example, there’s a microservice, <em>booking</em>, that has a mock server. To test your microservice, which depends on <em>booking</em>,you start <em>booking</em>’s mock server and set up test expectations (requests to <em>booking</em> and responses from <em>booking</em>) in your test file. If the mock server is not in sync with the latest changes to <em>booking</em>, you use a simple CLI command to update it, and then run your tests and evaluate the results.</p>

<p><img src="/img/mockers/image_6.png" alt="" /></p>

<p>Note that mock servers provide responses to requests from a microservice being tested, but do not process the requests with any internal logic. They just return the specified response for that request.</p>

<h2 id="whats-great-about-mockers">What’s Great About Mockers</h2>

<p>Here are some of Mockers’ features and their benefits:</p>

<ul>
  <li>Automatic contract verification - We generate a mock server based on a microservice’s API specification. It provides code hooks to set expectations using the microservice defined request and response structs. In the code below, assume the CarType struct field is deleted from the <em>booking</em> microservice. Now, when we update the mock server using CLI, this test generates a compile time error saying “CarType” struct field is unknown, indicating a contract mismatch.</li>
</ul>

<p><img src="/img/mockers/image_7.png" alt="" /></p>

<ul>
  <li>
    <p>Out-of-the-box resiliency testing with repeatable tests - Building on top of our in-house chaos SDK, we inject a middleware into the mock server enabling developers to bring all sorts of chaos scenarios to life. Want to check if your retries are working properly or code fallback actually works? Just add a resiliency test to fail the mock server by 50% and check if retries work, or fail 100% to check if code fallback actually executes. You can also simulate latency, memory leaks, CPU spike, etc.</p>
  </li>
  <li>
    <p>No overhead of maintaining code mocks when dependent microservices change; a simple CLI command updates the mock server.</p>
  </li>
  <li>
    <p>As shown in the following examples, it’s simple to write tests. As mock servers send their mock results at the network level, you don’t have to expose your microservice’s guts to inject code mocks. Developers can treat their microservice as a black box. Note that these are not complete test cases, but they show the basics of testing using mock servers.</p>
  </li>
</ul>

<p>Here is an example test.</p>

<p><img src="/img/mockers/image_8.png" alt="" /></p>

<p>Here is an example of resiliency testing.</p>

<p><img src="/img/mockers/image_9.png" alt="" /></p>

<h2 id="common-questions-about-mockers">Common Questions about Mockers</h2>

<ol>
  <li><em>How is this different from my unit tests with code mocks for dependencies?</em></li>
</ol>

<p>In unit tests, you mock the interfaces for your microservice dependencies. With Mockers, you avoid this overhead and use mock servers started on network ports. This tests your outbound API calls over the network to dependent mock servers, and tests your microservice at a layer closer to integration.</p>

<ol>
  <li><em>How do I know my mock server is up-to-date with the latest API contracts?</em></li>
</ol>

<p>Currently, you need to update the mock server using the CLI. If there is an API contract mismatch after the update, your Mockers based tests start to break. In future, we will add the last updated info for each mock server in the mockers ls CLI command.</p>

<ol>
  <li><em>I ran functional tests locally using Mockers. Should I still write and maintain integration tests for my microservice on staging?</em></li>
</ol>

<p>Yes. The integration tests run against real microservice dependencies with real data, and other streaming infrastructure on a distributed <em>Staging</em> environment. Hence, you should have integration tests for your microservice to catch issues before promoting to production.</p>

<h2 id="road-ahead">Road Ahead</h2>

<p>We’ve identified Grab’s mobile app as a candidate to benefit from using mock servers. To this end, we are working on building a microservice that acts as a mock server supporting both HTTP and TCP protocols.</p>

<p>With this microservice, mobile developers and test engineers can use our user interface (UI) to set their expected responses to mobile app calls. The mobile app is then pointed to the mock server for sending and receiving responses.</p>

<p>Benefits:</p>

<ul>
  <li>
    <p>Mobile teams can test an app’s rendering and functionality aspects without being fully dependent on an integrated staging environment for the backend.</p>
  </li>
  <li>
    <p>Backend flows currently under production can be easily tested using custom JSON responses during the mobile app development phase.</p>
  </li>
</ul>

<h2 id="in-conclusion">In Conclusion</h2>

<p>Mockers deals with microservice testing challenges, which helps you meet your consumers’ demands.</p>

<p>Mockers adoption has seen a steady growth among our critical microservices. Since Mockers was launched at Grab, many teams have adopted it to test their microservices. Our adoption rate has increased every month in 2018 so far, and we see no reason why this won’t continue until we run out of non-Mockers using microservices.</p>

<p><img src="/img/mockers/image_10.png" alt="" /></p>

<p>Depth rather than breadth of Mockers usage has increased. In the last few months, teams adopting Mockers wrote a large number of tests that use mock servers.</p>

<p><img src="/img/mockers/image_11.png" alt="" /></p>

<p>If you have any comments or questions about Mockers, please leave a comment.</p>

      </article>
      <div>
        
          <div class="post-tags">
  
  
    <a href="/tags#back-end" class="label tags-label">Back End</a>
  
    <a href="/tags#service" class="label tags-label">Service</a>
  
    <a href="/tags#testing" class="label tags-label">Testing</a>
  
</div>

        
        <br>
      </div>
      <div class="sharing-links text-right">
  Share on &nbsp;
  <a href="https://twitter.com/intent/tweet?text=Mockers - Overcoming Testing Challenges at Grab&url=https://engineering.grab.com/mockers&via=grabengineering&related=grabengineering" class="btn btn-sm btn-share btn-share-twitter" rel="nofollow" target="_new" title="Share on Twitter" onclick="onShareButtonClick(this); return false;"><i class="fa fa-lg fa-twitter"></i>&nbsp; Twitter</a>
  <a href="https://facebook.com/sharer.php?u=https://engineering.grab.com/mockers" class="btn btn-sm btn-share btn-share-facebook" rel="nofollow" target="_new" title="Share on Facebook" onclick="onShareButtonClick(this); return false;"><i class="fa fa-lg fa-facebook"></i>&nbsp; Facebook</a>
  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://engineering.grab.com/mockers&title=Mockers - Overcoming Testing Challenges at Grab
&summary=Sustaining quality in fast paced development is a challenge. At Grab, we use Mockers - a tool to expand the scope of local box testing. It helps us overcome testing challenges in a microservice architecture.&source=Grab Tech" class="btn btn-sm btn-share btn-share-linkedin" rel="nofollow" target="_new" title="Share on LinkedIn" onclick="onShareButtonClick(this); return false;"><i class="fa fa-lg fa-linkedin"></i>&nbsp; LinkedIn</a>
</div>
<script>
  function onShareButtonClick(button) {
    var width = 600;
    var height = 600;
    var left = (window.screen.width / 2) - (width / 2);
    var top = (window.screen.height / 2) - (height / 2);
    window.open(button.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=' + height + ',width=' + width + ',top=' + top + ',left=' + left);
    return false;
  }
</script>

      <hr class="section-divider">

      <br/>
      <!-- 
        <div id="disqus_thread"></div>
<script>
  var disqus_config = function () {
    this.page.url = 'https://engineering.grab.com/mockers';
    this.page.identifier = '/mockers';
  };
  (function() {
    var d = document, s = d.createElement('script');
    s.src = '//grabengineering.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

       -->

    </div>
  </div>
</div>

    </div>
    <div class="progress-wrap">
    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98" />
    </svg>
    <i class="fa fa-chevron-up btt-btn"></i>
</div>
    <footer class="site-footer">
  <div class="wrapper">
    <div class="row">
      <div class="col-sm-6 col-xs-12">
        <h2 class="footer-heading">Grab Tech</h2>
        <ul class="social-media-list">
  
    <li>
      <a href="https://github.com/grab" target="_blank" rel="nofollow noreferrer">
        <i class="fa fa-github fa-lg"></i>
      </a>
    </li>
  
  
    <li>
      <a href="https://www.linkedin.com/company/grabapp" target="_blank" rel="nofollow noreferrer">
        <i class="fa fa-linkedin fa-lg"></i>
      </a>
    </li>
  
  <li>
    <a href="https://engineering.grab.com/feed.xml" target="_blank">
      <i class="fa fa-rss fa-lg"></i>
    </a>
  </li>
</ul>

        <div>
          <script src="//platform.linkedin.com/in.js" type="text/javascript"> lang: en_US</script>
          <script type="IN/FollowCompany" data-id="5382086" data-counter="right"></script>
        </div>        
        <br>
      </div>
      <div class="col-sm-6 col-xs-12 hiring-section">
        <h2 class="footer-heading">Join Us</h2>
        <p class="text">
          Want to join us in our mission to revolutionize transportation?
        </p>
        <a class="btn" href="https://grab.careers" target="_blank">View open positions</a>

      </div>
    </div>
    
  <!-- Google Tag Manager -->
  <script>
    (function (w, d, s, l, i) {
      w[l] = w[l] || [];
      w[l].push({
        'gtm.start': new Date().getTime(),
        event: 'gtm.js'
      });
      var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s),
        dl = l != 'dataLayer' ? '&l=' + l : '';
      j.async = true;
      j.src =
        'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
      f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', 'GTM-T3CT72T');
  </script>
  <!-- End Google Tag Manager -->

  <!-- Old script 
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'GTM-T3CT72T', 'auto');
    ga('send', 'pageview');
  </script> -->
<!-- End of olf script -->


  </body>
</html>
